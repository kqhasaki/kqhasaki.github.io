<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.fabc4999cbaa710b382c.css" data-identity="gatsby-global-css">.modal-wrapper{align-items:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:rgba(0,0,0,.6);bottom:0;display:flex;justify-content:center;left:0;position:fixed;right:0;top:0;z-index:1000}.modal-content-wrapper::-webkit-scrollbar{width:0}.modal-content{background:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:1rem;min-width:600px;padding:1.5rem;position:relative;width:50vw}.modal-content-wrapper{max-height:70vh;min-height:50vh;overflow-y:auto;width:100%}.modal-closer{cursor:pointer;font-size:1.2rem;position:absolute;right:.8rem;top:.8rem}.modal-closer:hover{color:var(--blue)}@media (max-width:900px){.modal-content{min-width:90%;width:90%}}.post-card-img{background-color:var(--background-color);border-radius:12px;bottom:0;box-shadow:0 0 6px rgba(0,0,0,.15);height:200px;left:50%;-o-object-fit:cover;object-fit:cover;position:absolute;-webkit-transform:translate(-50%) rotate(-8deg);transform:translate(-50%) rotate(-8deg);transition:.2s;width:300px}.img-line{height:120px;margin-bottom:2rem;position:relative}.post-card{align-items:center;border:1px solid var(--card-background-border-color);border-radius:1.5rem;cursor:pointer;display:flex;flex-direction:column;justify-content:center;margin:140px auto 0;max-width:45rem;padding:1.5rem 2rem;transition:.2s}.post-card:hover{box-shadow:0 0 1rem var(--card-box-shadow)}.post-card:active{box-shadow:0 0 1.5rem var(--blue)}.post-card:hover .post-card-img{-webkit-transform:translate(-50%) rotate(0deg);transform:translate(-50%) rotate(0deg)}.post-card h2:after{background:var(--blue);content:"";display:block;height:2px;margin-left:auto;margin-right:auto;margin-top:10px;width:60px}.post-card-meta{background-color:var(--card-background-color);border:1px solid var(--card-background-border-color);border-radius:.5rem;font-size:.9rem;font-weight:300;margin:1rem 0 0;padding:.5rem 1rem}@media (max-width:500px){.post-card{padding:1.5rem .8rem}}.item-list{align-items:center;border-left:3px solid var(--blue);display:flex;flex-direction:column;justify-content:center;margin:0 auto 0 1rem}.item-list .item{margin:0;padding:1rem;position:relative;width:100%}.item:before{background-color:var(--blue);border-radius:50%;content:"";height:.8rem;left:-.5rem;position:absolute;top:2rem;transition:.2s;width:.8rem}.item:hover:before{-webkit-transform:scale(1.2);transform:scale(1.2)}.item-list .item-label{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:15px;font-weight:400}.item-list .item-content{padding-top:.5rem}.homepage-title{font-weight:700;margin:2rem 0 1rem}.item a{transition:.3s}.item a:hover{color:var(--font-color-highlight)}.messager{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:.5rem;box-shadow:0 0 .8rem var(--card-box-shadow);left:0;margin-left:auto;margin-right:auto;max-width:200px;padding:.5rem 1rem;position:fixed;right:0;text-align:center;top:1rem;-webkit-transform:scale(.2);transform:scale(.2);transition:.2s;z-index:999}.avatar{align-items:center;display:flex;flex-direction:row;height:8rem;justify-content:center}.avatar>img{border-radius:50%;box-shadow:0 0 4px rgba(0,0,0,.1);max-height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center center;object-position:center center;opacity:1;padding:.5rem;transition:none 0s ease 0s}.footer{border-top:1px solid var(--card-background-border-color);color:var(--font-color);display:flex;flex-direction:row;font-size:13px;justify-content:space-evenly;margin-top:10rem;padding:2rem 0 8rem;position:relative;-webkit-user-select:none;-ms-user-select:none;user-select:none}.footer .wrapper{align-items:flex-start;display:flex;flex-direction:column;font-family:sans-serif;padding-left:.5rem;padding-right:1rem;width:50%}h3,ul{width:100%}h3{color:var(--font-color);margin-bottom:8px}.footer p{line-height:1.2rem;margin:0;padding:.5rem 0}.footer span{color:var(--font-color);cursor:pointer;margin-right:12px}.wrapper li{padding:4px 0}.footer span:hover{color:var(--font-color-highlight)}@media (max-width:600px){.footer{flex-direction:column}.footer .wrapper{margin-bottom:1rem;width:100%}}:root{--deckgo-highlight-code-font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}@media (prefers-color-scheme:dark){body{--blue:#02bbff;--background-color:#202124;--background-color-transparent:rgba(0,0,0,.9);--font-color:#bdc1c6;--font-color-header:#eaeaea;--font-color-highlight:#efefef;--btn-color:#333;--card-background-color:#222;--quote-background-color:#242424;--font-color-quote:#bdcbdc;--card-background-border-color:#2a2a2a;--card-box-shadow:#333;--code-font-color:#c678dd;--code-background-color:rgba(0,0,0,.1);--code-border-color:rgba(0,0,0,.02);--code-block-background:rgba(0,0,0,.1);--navigator-hover-color:hsla(0,0%,100%,.1);--navigator-border-color:#222;--table-border-color:#303030}}@media (prefers-color-scheme:light){body{--blue:#02bbff;--background-color:#fff;--background-color-transparent:hsla(0,0%,100%,.9);--font-color:#3c4043;--font-color-header:#3c4043;--btn-color:#fff;--card-background-color:#efefef;--card-background-border-color:#efefef;--quote-background-color:#eaf8ff;--font-color-highlight:#000;--font-color-quote:#4e7182;--card-box-shadow:rgba(0,0,0,.1);--code-font-color:#444;--code-background-color:rgba(255,229,100,.2);--code-border-color:rgba(255,229,100,.2);--code-block-background:#313131;--navigator-hover-color:rgba(0,0,0,.08);--navigator-border-color:#ddd;--table-border-color:#ededed}}.dark{--blue:#02bbff;--background-color:#202124;--background-color-transparent:rgba(0,0,0,.9);--font-color:#bdc1c6;--font-color-header:#eaeaea;--font-color-highlight:#efefef;--btn-color:#333;--card-background-color:#222;--quote-background-color:#242424;--font-color-quote:#bdcbdc;--card-background-border-color:#2a2a2a;--card-box-shadow:#333;--code-font-color:#c678dd;--code-background-color:rgba(0,0,0,.1);--code-border-color:rgba(0,0,0,.02);--code-block-background:rgba(0,0,0,.1);--navigator-hover-color:hsla(0,0%,100%,.1);--navigator-border-color:#222;--table-border-color:#303030}.light{--blue:#02bbff;--background-color:#fff;--background-color-transparent:hsla(0,0%,100%,.9);--font-color:#3c4043;--font-color-header:#3c4043;--btn-color:#fff;--card-background-color:#efefef;--card-background-border-color:#efefef;--quote-background-color:#eaf8ff;--font-color-highlight:#000;--font-color-quote:#4e7182;--card-box-shadow:rgba(0,0,0,.1);--code-font-color:#444;--code-background-color:rgba(255,229,100,.2);--code-border-color:rgba(255,229,100,.2);--code-block-background:#313131;--navigator-hover-color:rgba(0,0,0,.08);--navigator-border-color:#ddd;--table-border-color:#ededed}body,html{background-color:var(--background-color);color:var(--font-color);font-family:Arial,Helvetica,sans-serif}a{color:inherit;text-decoration:none}*{-webkit-tap-highlight-color:rgba(0,0,0,0);border:none;box-sizing:border-box;list-style-type:none;margin:0;padding:0}ol{margin:.7rem 0}ol li{list-style-type:decimal;margin:.6rem 0 .6rem 2rem}p{-webkit-margin-before:1em;-webkit-margin-after:1em;-webkit-margin-start:0;-webkit-margin-end:0;display:block;line-height:1.7;margin-block-end:1em;margin-block-start:1em;margin-bottom:.7rem;margin-inline-end:0;margin-inline-start:0;margin-top:.7rem}::selection{background-color:var(--blue);color:#fff}body{word-wrap:break-word;font-kerning:normal;margin:0;padding:0}header{align-items:center;display:flex;flex-direction:row;justify-content:space-around;padding-bottom:0}header>.route-link{margin:0 1rem}header img{box-shadow:0 0 .2rem rgba(0,0,0,.5)}.base-wrapper{margin-left:auto;margin-right:auto;max-width:1080px;min-height:100%;padding:2.625rem 1.3125rem;width:60%}.nav-link{align-items:center;color:var(--font-color);cursor:pointer;display:flex;flex-direction:column;font-size:2.4rem;justify-content:center;margin:0 1rem;min-width:3rem}.nav-link>img{border-radius:50%;height:2.2rem;-webkit-transform:scale(1.2);transform:scale(1.2)}.nav-link:hover{color:var(--blue);text-decoration:none}.nav-link:hover .link-label{-webkit-transform:scaleY(1);transform:scaleY(1)}.nav-link .link-label{bottom:-24px;display:block;font-size:.9rem;padding-top:6px;text-align:center;-webkit-transform:scaleY(0);transform:scaleY(0);transition:.2s;width:8rem}.link-active{color:var(--blue)}.article-body .article-title{font-size:2.2rem;font-weight:700;margin-bottom:2rem;text-align:center}.article-body strong{color:var(--font-color-highlight)}.article-meta{font-size:.9rem;margin:1rem auto 1.5rem;text-align:center}.article-meta>span{background-color:var(--card-background-color);border-radius:.5rem;font-weight:lighter;padding:.5rem 1rem}.article-body h1,h2,h3{cursor:pointer}.article-body p{font-size:17px;margin-bottom:1.2rem;margin-top:1.2rem}.article-body h1{color:var(--font-color-header);font-size:2rem;font-weight:700;margin-bottom:1.8rem;margin-top:3.5rem}.article-body h1 code{font-size:2rem}.article-body h2{color:var(--font-color-header);font-size:1.6rem;font-weight:700;margin-bottom:1rem;margin-top:2.5rem}.article-body h2 code{font-size:1.2rem}.article-body h3{color:var(--font-color-header);font-size:1.4rem;font-weight:700;line-height:1.8;margin-bottom:1rem;margin-top:1.8rem}.article-body h3 code{font-size:1.2rem;font-weight:700}.article-body h4{color:var(--font-color-header);font-weight:500;margin-bottom:1rem;margin-top:1.5rem}.article-body h4 code{font-size:1rem}.article-body h1:first-child{border-radius:.5rem}.article-body h1:not(:first-child):before{margin-bottom:.5rem}.article-body h1:not(:first-child):before,.article-body h2:before{background:var(--blue);content:"";display:block;height:2px;width:70px}.article-body h2:before{margin-bottom:.3rem}.article-body code{background-color:var(--code-background-color);border:1px solid var(--code-border-color);border-radius:4px;color:var(--code-font-color);font-family:Menlo,Monaco,Consolas,monospace;font-size:15px;margin:0 2px;padding:1px 4px}.article-body blockquote{background-color:var(--quote-background-color);border-left:2px solid var(--blue);border-radius:0 .5rem .5rem 0;color:var(--font-color-quote);margin-top:1rem;padding:1rem}.article-body blockquote code{color:var(--font-color-highlight)}.article-body .article-cover{border-radius:16px;box-shadow:0 0 1px rgba(0,0,0,.1);margin:18px auto 20px;width:80%}.article-body .article-cover,.article-body img{display:block;min-width:330px;-o-object-fit:cover;object-fit:cover}.article-body img{border-radius:12px;margin:18px auto;width:85%}.article-body ul{margin:.7rem 0}.article-body ul li{list-style-type:disc;margin:.6rem 0 .6rem 2rem}.article-body a{color:#189fff}a:hover{text-decoration:underline}.article-body a:after{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMSIgaGVpZ2h0PSIxMSIgY2xhc3M9InByZWZpeF9faWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZmlsbD0iIzE4OWZmZiIgZD0iTTkyNC40MDIgMTAyMy4wNjhILjY4Vjk5LjM0NUg0NjIuNTR2OTguOTFIOTkuNTk3VjkyNC4xNWg3MjUuODk2VjU2MS4yMDdoOTguOTF6Ii8+PHBhdGggZmlsbD0iIzE4OWZmZiIgZD0ibTkzMC44MDUgMjIuOTc3IDY5Ljk2NiA2OS45NjYtNDUzLjQ5MyA0NTMuNDkyLTY5Ljk2NS02OS45MDF6Ii8+PHBhdGggZmlsbD0iIzE4OWZmZiIgZD0iTTEwMjIuNDY0IDMwNC4wM2gtOTguOTE3Vjk5LjM0NUg3MDkuMjMxVi40MjhoMzEzLjIzM3oiLz48L3N2Zz4=);padding-left:2px}.article-body table{word-wrap:normal;border-collapse:collapse;table-layout:fixed;width:100%}th{background-color:rgba(0,0,0,.06);text-align:center}td{background-color:hsla(0,0%,100%,.01);font-weight:300}table,td,th{border:1px solid var(--table-border-color);overflow:auto;padding:.5rem}.theme-changer{border-radius:50%;bottom:1rem;cursor:pointer;position:fixed;right:1rem}.theme-changer img{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:50%;height:30px;padding:6px;width:30px}deckgo-highlight-code{background-color:var(--code-block-background);border-radius:.5rem;box-shadow:none!important;cursor:pointer;font-size:14px;margin-top:1rem;position:relative;-webkit-user-select:none;-ms-user-select:none;user-select:none}@media (min-width:900px){deckgo-highlight-code:after{content:"åŒå‡»å¤åˆ¶";font-size:11px;height:2rem;opacity:0;position:absolute;right:1rem;text-align:center;top:1rem;transition:.4s;width:4rem}deckgo-highlight-code:hover:after{opacity:1}}@media (max-width:900px){.base-wrapper{margin-left:auto;margin-right:auto;min-height:100%;padding:2.625rem 1rem;width:100%}}.progresser{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:50%;color:var(--font-color);cursor:pointer;font-family:Courier New,Courier,monospace;font-size:13px;font-weight:lighter;height:30px;line-height:29px;position:fixed;right:1rem;text-align:center;top:1rem;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:30px;z-index:999}.progresser:after{background-color:var(--quote-background-color);border-radius:50%;content:"";opacity:0;transition:.2s}.progresser:after,.progresser:hover:after{bottom:0;left:0;position:absolute;right:0;top:0}.progresser:hover:after{content:"up";opacity:1}.table-of-content{background-color:var(--background-color);border-left:1px solid var(--card-background-border-color);font-size:16px;height:100%;overflow-y:auto;padding:2.5rem 2rem 2.5rem 1.2rem;position:fixed;right:0;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:20%}@media (max-width:900px){.table-of-content{display:none}}.table-of-content::-webkit-scrollbar{display:none}.table-of-content p{cursor:pointer;margin:0;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.table-of-content .topHeader{color:var(--blue)!important}.table-of-content p:hover{color:var(--blue)}p.header-level-h1{font-weight:500;margin-top:.8rem}p.header-level-h2{font-size:15px;margin-top:.4rem;padding-left:1rem}p.header-level-h3{font-size:15px;margin-top:.2rem;padding-left:2rem}.article-navigator{background-color:var(--background-color);border-right:1px solid var(--card-background-border-color);font-size:16px;height:100%;left:0;overflow-y:auto;padding:2.5rem 1.2rem 2.5rem 2rem;position:fixed;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:20%;z-index:999}.article-navigator .article-navigator-toggler{cursor:pointer;font-size:1.3rem;height:2rem;line-height:2rem;position:absolute;right:0;top:1rem;visibility:hidden;width:2rem}.article-navigator .article-navigator-toggler:hover{color:var(--blue)}@media (max-width:900px){.article-navigator{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background-color:var(--background-color-transparent);border:none;display:none;height:100%;left:0;padding:0;width:100vw}.article-navigator h4{font-size:1.2rem!important;margin-top:1rem!important;padding-left:1rem;padding-right:1rem}.article-navigator p{border-bottom:1px solid var(--navigator-border-color);font-size:1rem!important;line-height:2.8rem!important;padding-left:2rem!important;padding-right:2rem!important;transition:background .3s}.article-navigator p:hover{background:var(--navigator-hover-color)}.navigator-switch{display:block}.article-navigator .article-navigator-toggler{visibility:visible}}.article-navigator h4{font-size:16px;margin-bottom:.5rem;margin-top:1rem}.article-navigator h4:first-child{margin-top:0}.navigator-switch{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:50%;color:var(--font-color);cursor:pointer;display:none;font-size:.8rem;height:30px;left:1rem;line-height:29px;position:fixed;text-align:center;top:1rem;width:30px;z-index:999}.article-navigator p{cursor:pointer;font-size:15px;margin:0;overflow-x:hidden;padding-left:.5rem;text-overflow:ellipsis;white-space:nowrap;width:100%}.article-navigator p:hover,.highlighted-navigator-item{color:var(--blue)}</style><meta name="generator" content="Gatsby 4.4.0"/><link rel="icon" href="/favicon-32x32.png?v=955b34d699199a783b1a23f58b90c7ba" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=955b34d699199a783b1a23f58b90c7ba"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=955b34d699199a783b1a23f58b90c7ba"/><link as="script" rel="preload" href="/webpack-runtime-7b8a381ab1cc3c6a4c63.js"/><link as="script" rel="preload" href="/framework-f27b074ecebec0f1dbc4.js"/><link as="script" rel="preload" href="/app-482b53f1cff3eb5f0e6d.js"/><link as="script" rel="preload" href="/cb1608f2-001f1ae553ac1c271243.js"/><link as="script" rel="preload" href="/a9a7754c-992c6b2080a7db331a45.js"/><link as="script" rel="preload" href="/commons-711a425d0badd3d91470.js"/><link as="script" rel="preload" href="/component---src-pages-articles-mdx-slug-js-af982b891e4b6138fb23.js"/><link as="fetch" rel="preload" href="/page-data/articles/redbook-series/redbook-chapter20/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2757060725.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3605573801.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="base-wrapper"><title>Louis K - Software Engineer</title><header><a class="nav-link" href="/nonTech/"><span role="img" aria-label="read" class="anticon anticon-read"><svg viewBox="64 64 896 896" focusable="false" data-icon="read" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"></path></svg></span><span class="link-label">æ‚è°ˆæ–‡ç« </span></a><a class="nav-link" href="/"><span role="img" aria-label="desktop" class="anticon anticon-desktop"><svg viewBox="64 64 896 896" focusable="false" data-icon="desktop" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 140H96c-17.7 0-32 14.3-32 32v496c0 17.7 14.3 32 32 32h380v112H304c-8.8 0-16 7.2-16 16v48c0 4.4 3.6 8 8 8h432c4.4 0 8-3.6 8-8v-48c0-8.8-7.2-16-16-16H548V700h380c17.7 0 32-14.3 32-32V172c0-17.7-14.3-32-32-32zm-40 488H136V212h752v416z"></path></svg></span><span class="link-label">æŠ€æœ¯æ–‡ç« </span></a><div class="nav-link"><img alt="avatar" src="/static/avatar-427bcc9e4a03334af5649168991c08f0.png"/><span class="link-label">å…³äºä½œè€…</span></div></header><main><div class="progresser">0</div><div class="article-body"><h1 class="article-title">çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåï¼‰JavaScript API</h1><p class="article-meta"><span><span role="img" aria-label="field-time" class="anticon anticon-field-time"><svg viewBox="64 64 896 896" focusable="false" data-icon="field-time" width="1em" height="1em" fill="currentColor" aria-hidden="true"><defs><style></style></defs><path d="M945 412H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h256c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM811 548H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h122c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM477.3 322.5H434c-6.2 0-11.2 5-11.2 11.2v248c0 3.6 1.7 6.9 4.6 9l148.9 108.6c5 3.6 12 2.6 15.6-2.4l25.7-35.1v-.1c3.6-5 2.5-12-2.5-15.6l-126.7-91.6V333.7c.1-6.2-5-11.2-11.1-11.2z"></path><path d="M804.8 673.9H747c-5.6 0-10.9 2.9-13.9 7.7a321 321 0 01-44.5 55.7 317.17 317.17 0 01-101.3 68.3c-39.3 16.6-81 25-124 25-43.1 0-84.8-8.4-124-25-37.9-16-72-39-101.3-68.3s-52.3-63.4-68.3-101.3c-16.6-39.2-25-80.9-25-124 0-43.1 8.4-84.7 25-124 16-37.9 39-72 68.3-101.3 29.3-29.3 63.4-52.3 101.3-68.3 39.2-16.6 81-25 124-25 43.1 0 84.8 8.4 124 25 37.9 16 72 39 101.3 68.3a321 321 0 0144.5 55.7c3 4.8 8.3 7.7 13.9 7.7h57.8c6.9 0 11.3-7.2 8.2-13.3-65.2-129.7-197.4-214-345-215.7-216.1-2.7-395.6 174.2-396 390.1C71.6 727.5 246.9 903 463.2 903c149.5 0 283.9-84.6 349.8-215.8a9.18 9.18 0 00-8.2-13.3z"></path></svg></span> <!-- -->2022-03-10<!-- --> | <span role="img" aria-label="read" class="anticon anticon-read"><svg viewBox="64 64 896 896" focusable="false" data-icon="read" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"></path></svg></span> <!-- -->14400<!-- -->words <!-- -->52<!-- -->min</span></p><img class="article-cover" src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0xwpwnc30j20e80e8glq.jpg" alt="https://tva1.sinaimg.cn/large/e6c9d24egy1h0xwpwnc30j20e80e8glq.jpg"/><p>éšç€ Web æµè§ˆå™¨èƒ½åŠ›çš„å¢åŠ ï¼Œå…¶å¤æ‚æ€§ä¹Ÿåœ¨è¿…é€Ÿå¢åŠ ã€‚ä»å¾ˆå¤šæ–¹é¢æ¥çœ‹ï¼Œç°ä»£ Web æµè§ˆå™¨å·²ç»æˆä¸ºæ„å»ºäºè¯¸å¤šè§„èŒƒä¹‹ä¸Šã€é›†ä¸åŒ API äºä¸€èº«çš„â€œç‘å£«å†›åˆ€â€ã€‚æµè§ˆå™¨è§„èŒƒçš„ç”Ÿæ€åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯æ··ä¹±è€Œæ— åºçš„ã€‚ä¸€äº›è§„èŒƒå¦‚ HTML5ï¼Œå®šä¹‰äº†ä¸€æ‰¹å¢å¼ºå·²æœ‰æ ‡å‡†çš„ API å’Œæµè§ˆå™¨ç‰¹æ€§ã€‚è€Œå¦ä¸€äº›è§„èŒƒå¦‚ Web Cryptography API å’Œ Notifications APIï¼Œåªä¸ºä¸€ä¸ªç‰¹æ€§å®šä¹‰äº†ä¸€ä¸ª APIã€‚ä¸åŒæµè§ˆå™¨å®ç°è¿™äº›æ–° API çš„æƒ…å†µä¹Ÿä¸åŒï¼Œæœ‰çš„ä¼šå®ç°å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œæœ‰çš„åˆ™å¹²è„†å°šæœªå®ç°ã€‚</p><p>æœ€ç»ˆï¼Œæ˜¯å¦ä½¿ç”¨è¿™äº›æ¯”è¾ƒæ–°çš„ API è¿˜æ˜¯è¦çœ‹é¡¹ç›®æ˜¯æ”¯æŒæ›´å¤šæµè§ˆå™¨ï¼Œè¿˜æ˜¯è¦é‡‡ç”¨æ›´å¤šç°ä»£ç‰¹æ€§ã€‚æœ‰äº› API å¯ä»¥ä½¿ç”¨è…»å­è„šæœ¬ï¼ˆpolyfillï¼‰æ¥æ¨¡æ‹Ÿï¼Œä½†æ˜¯è…»å­è„šæœ¬é€šå¸¸ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œæ­¤å¤–ä¹Ÿä¼šå¢åŠ ç½‘ç«™ JavaScript ä»£ç çš„ä½“ç§¯ã€‚</p><p>Web API çš„æ•°é‡ä¹‹å¤šä»¤äººéš¾ä»¥ç½®ä¿¡ã€‚æœ¬ç« è¦ä»‹ç»çš„ API ä»…é™äºä¸å¤§å¤šæ•°å¼€å‘è€…æœ‰å…³ã€å·²ç»å¾—åˆ°å¤šä¸ªæµè§ˆå™¨æ”¯æŒçš„éƒ¨åˆ†ã€‚</p><h1>Atomics å’Œ<code>SharedArrayBuffer</code></h1><p>å¤šä¸ªä¸Šä¸‹æ–‡è®¿é—®<code>SharedArrayBuffer</code>æ—¶ï¼Œå¦‚æœåŒæ—¶å¯¹ç¼“å†²åŒºæ‰§è¡Œæ“ä½œï¼Œå°±å¯èƒ½å‡ºç°èµ„æºäº‰ç”¨é—®é¢˜ã€‚Atomics API é€šè¿‡å¼ºåˆ¶åŒä¸€æ—¶åˆ»åªèƒ½å¯¹ç¼“å†²åŒºæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œå¯ä»¥è®©å¤šä¸ªä¸Šä¸‹æ–‡å®‰å…¨åœ°è¯»å†™ä¸€ä¸ª<code>SharedArrayBuffer</code>ã€‚Atomics API æ˜¯ ES2017 ä¸­å®šä¹‰çš„ã€‚</p><p>ä»”ç»†ç ”ç©¶ä¼šå‘ç° Atomics API éå¸¸åƒä¸€ä¸ªç®€åŒ–ç‰ˆçš„æŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰ï¼Œè¿™å¹¶éæ„å¤–ã€‚åŸå­æ“ä½œçš„æœ¬è´¨ä¼šæ’æ–¥æ“ä½œç³»ç»Ÿæˆ–è®¡ç®—æœºç¡¬ä»¶é€šå¸¸ä¼šè‡ªåŠ¨æ‰§è¡Œçš„ä¼˜åŒ–ï¼ˆä¾‹å¦‚æŒ‡ä»¤é‡æ–°æ’åºï¼‰ã€‚åŸå­æ“ä½œä¹Ÿè®©å¹¶å‘è®¿é—®å†…å­˜å˜å¾—ä¸å¯èƒ½ï¼Œå¦‚æœåº”ç”¨ä¸å½“å°±å¯èƒ½å¯¼è‡´ç¨‹åºæ‰§è¡Œå˜æ…¢ã€‚å› æ­¤ï¼ŒAtomics API çš„è®¾è®¡åˆè¡·æ˜¯åœ¨æœ€å°‘ä½†å¾ˆç¨³å®šçš„åŸå­è¡Œä¸ºåŸºç¡€ä¹‹ä¸Šï¼Œæ„å»ºå¤æ‚çš„å¤šçº¿ç¨‹ JavaScript ç¨‹åºã€‚</p><h2><code>SharedArrayBuffer</code></h2><p><code>SharedArrayBuffer</code>å’Œ<code>ArrayBuffer</code>å…·æœ‰åŒæ ·çš„ APIã€‚äºŒè€…çš„ä¸»è¦åŒºåˆ«æ˜¯<code>ArrayBuffer</code>å¿…é¡»åœ¨ä¸åŒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¹‹é—´åˆ‡æ¢ï¼Œ<code>SharedArrayBuffer</code>åˆ™å¯ä»¥è¢«ä»»æ„å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åŒæ—¶ä½¿ç”¨ã€‚</p><p>åœ¨å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡é—´å…±äº«å†…å­˜æ„å‘³ç€å¹¶å‘çº¿ç¨‹æ“ä½œæˆä¸ºäº†å¯èƒ½ã€‚ä¼ ç»Ÿ JavaScript æ“ä½œå¯¹äºå¹¶å‘å†…å­˜è®¿é—®å¯¼è‡´çš„èµ„æºäº‰ç”¨æ²¡æœ‰æä¾›ä¿æŠ¤ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº† 4 ä¸ªä¸“ç”¨å·¥ä½œçº¿ç¨‹è®¿é—®åŒä¸€ä¸ª<code>SharedArrayBuffer</code>å¯¼è‡´çš„èµ„æºäº‰ç”¨é—®é¢˜ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const workerScript = `
	self.onmessage = ({data}) =&gt; {
		const view = new Unit32Array(data)
		// æ‰§è¡Œ1000ï¼Œ000æ¬¡åŠ æ“ä½œ
		for (let i = 0; i &lt; 1e6; i++) {
			// çº¿ç¨‹ä¸åŠ å®‰å…¨æ“ä½œä¼šå¯¼è‡´èµ„æºäº‰ç”¨
			view[0] += 1
		}
		self.postMessage(null)
	}
`

const workerScriptBlobUrl = URL.createObjectURL(new Blob([workerScript]))

// åˆ›å»ºå®¹é‡ä¸º4çš„å·¥ä½œçº¿ç¨‹æ± 
const workers = []
for (let i = 0; i &lt; 4; i++) {
  workers.push(new Worker(workerScriptBlobUrl))
}
// åœ¨æœ€åä¸€ä¸ªå·¥ä½œçº¿ç¨‹å®Œæˆåæ‰“å°å‡ºæœ€ç»ˆå€¼
let responseCount = 0
for (const worker of workers) {
  worker.onmessage = () =&gt; {
    if (++responseCount === workers.length) {
      console.log(`Final buffer value: ${view[0]}`)
    }
  }
}

// åˆå§‹åŒ–SharedArrayBuffer
const sharedArrayBuffer = new SharedArrayBuffer(4)
const view = new Unit32Array(sharedArrayBuffer)
view[0] = 1

// æŠŠSharedArrayBufferå‘é€åˆ°æ¯ä¸ªå·¥ä½œçº¿ç¨‹
for (const worker of workers) {
  worker.postMessage(sharedArrayBuffer)
}

// æœŸå¾…çš„ç»“æœä¸º4000001ï¼Œç»“æœæ˜¯ä¸ç¬¦åˆçš„
// Final buffer value: 2145106</code>
        </deckgo-highlight-code><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAtomics API åº”è¿è€Œç”Ÿã€‚Atomics API å¯ä»¥ä¿è¯<code>SharedArrayBuffer</code>ä¸Šçš„ JavaScript æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h2>åŸå­æ“ä½œåŸºç¡€</h2><p>ä»»ä½•å…¨å±€ä¸Šä¸‹æ–‡ä¸­éƒ½æœ‰<code>Atomics</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸Šæš´éœ²äº†ç”¨äºæ‰§è¡Œçº¿ç¨‹å®‰å…¨æ“ä½œçš„ä¸€å¥—é™æ€æ–¹æ³•ï¼Œå…¶ä¸­å¤šæ•°æ–¹æ³•ä»¥ä¸€ä¸ª<code>TypedArray</code>å®ä¾‹ï¼ˆä¸€ä¸ª<code>SharedArrayBuffer</code>çš„å¼•ç”¨ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä»¥ç›¸å…³æ“ä½œæ•°ä½œä¸ºåç»­å‚æ•°ã€‚</p><h3>ç®—æœ¯åŠä½æ“ä½œæ–¹æ³•</h3><p>Atomics API æä¾›äº†ä¸€å¥—ç®€å•çš„æ–¹æ³•ç”¨ä»¥æ‰§è¡Œå°±åœ°ä¿®æ”¹æ“ä½œã€‚åœ¨ ECMA è§„èŒƒä¸­ï¼Œè¿™äº›æ–¹æ³•è¢«å®šä¹‰ä¸º<code>AtomicReadModifyWrite</code>æ“ä½œã€‚åœ¨åº•å±‚ï¼Œè¿™äº›æ–¹æ³•éƒ½ä¼šä»<code>SharedArrayBuffer</code>ä¸­æŸä¸ªä½ç½®è¯»å–å€¼ï¼Œç„¶åæ‰§è¡Œç®—æœ¯æˆ–ä½æ“ä½œï¼Œæœ€åå†æŠŠè®¡ç®—ç»“æœå†™å›ç›¸åŒçš„ä½ç½®ã€‚è¿™äº›æ“ä½œçš„åŸå­æœ¬è´¨æ„å‘³ç€ä¸Šè¿°è¯»å–ã€ä¿®æ”¹ã€å†™å›æ“ä½œä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ã€‚</p><p>ä¸‹é¢ä»£ç æ¼”ç¤ºäº†æ‰€æœ‰ç®—æœ¯æ–¹æ³•ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">// åˆ›å»ºå¤§å°ä¸º1çš„ç¼“å†²åŒº
const sharedArrayBuffer = new SharedArrayBuffer(1)

// åŸºäºç¼“å†²åˆ›å»ºUnit8Array
const typedArray = new Unit8Array(sharedArrayBuffer)

// æ‰€æœ‰ArrayBufferå…¨éƒ½åˆå§‹åŒ–ä¸º0
console.log(typedArray) // Unit8Array[0]

const index = 0
const increment = 5

// å¯¹ç´¢å¼•0å¤„çš„å€¼æ‰§è¡ŒåŸå­åŠ 5
Atomics.add(typedArray, index, increment)

console.log(typedArray) // Unit8Array[5]

// å¯¹ç´¢å¼•0å¤„çš„å€¼æ‰§è¡ŒåŸå­å‡5
Atomics.sub(typedArray, index, increment)

console.log(typedArray) // Unit8Array[0]</code>
        </deckgo-highlight-code><p>ä¸‹é¢ä»£ç æ¼”ç¤ºäº†æ‰€æœ‰ä½æ–¹æ³•ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const sharedArrayBuffer = new SharedArrayBuffer(1)

const typedArray = new Unit8Array(sharedArrayBuffer)

console.log(typedArray) // Unit8Array[0]

const index = 0

// å¯¹ç´¢å¼•0å¤„çš„å€¼æ‰§è¡ŒåŸå­æˆ–0b1111
Atomics.or(typedArray, index, 0b1111)

console.log(typedArray) // Unit8Array[15]

// å¯¹ç´¢å¼•0å¤„çš„å€¼æ‰§è¡ŒåŸå­ä¸0b1111
Atomics.and(typedArray, index, 0b1111)

console.log(typedArray) // Unit8Array[12]

// å¯¹ç´¢å¼•0å¤„çš„å€¼æ‰§è¡ŒåŸå­å¼‚æˆ–0b1111
Atomics.xor(typedArray, index, 0b1111)

console.log(typedArray) // Unit8Array[3]</code>
        </deckgo-highlight-code><h3>åŸå­è¯»/å†™</h3><p>æµè§ˆå™¨çš„ JavaScript ç¼–è¯‘å™¨å’Œ CPU æ¶æ„æœ¬èº«éƒ½æœ‰æƒé™é‡æ’æŒ‡ä»¤ä»¥æå‡æ‰§è¡Œæ•ˆç‡ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒJavaScript çš„å•çº¿ç¨‹ç¯å¢ƒæ˜¯éšæ—¶å¯ä»¥è¿›è¡Œè¿™ç§ä¼˜åŒ–çš„ã€‚ä½†å¤šçº¿ç¨‹ç•™ä¸‹çš„æŒ‡ä»¤é‡æ’å¯èƒ½å¯¼è‡´èµ„æºäº‰ç”¨ï¼Œè€Œä¸”æéš¾æ‹é”™ã€‚</p><p>Atomics é€šè¿‡ä¸¤ç§ä¸»è¦æ–¹å¼è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><ul><li>æ‰€æœ‰åŸå­æŒ‡ä»¤ç›¸äº’ä¹‹é—´çš„é¡ºåºæ°¸è¿œä¸ä¼šé‡æ’</li><li>ä½¿ç”¨åŸå­è¯»æˆ–è€…åŸå­å†™ä¿è¯æ‰€æœ‰æŒ‡ä»¤ï¼ˆåŒ…æ‹¬åŸå­å’ŒéåŸå­æŒ‡ä»¤ï¼‰éƒ½ä¸ä¼šç›¸å¯¹åŸå­è¯»/å†™é‡æ–°æ’åºã€‚è¿™æ„å‘³ç€ä½äºåŸå­è¯»/å†™ä¹‹å‰çš„æ‰€æœ‰æŒ‡ä»¤ä¼šåœ¨åŸå­è¯»/å†™å‘ç”Ÿå‰å®Œæˆï¼Œè€Œä½äºåŸå­è¯»/å†™ä¹‹åçš„æ‰€æœ‰æŒ‡ä»¤ä¼šåœ¨åŸå­è¯»/å†™å®Œæˆåæ‰ä¼šå¼€å§‹ã€‚</li></ul><p>é™¤äº†è¯»å†™ç¼“å†²åŒºçš„å€¼ï¼Œ<code>Atomics.load()</code>å’Œ<code>Atomics.store()</code>è¿˜å¯ä»¥æ„å»ºâ€œä»£ç å›´æ â€ã€‚JavaScript å¼•æ“ä¿è¯éåŸå­æŒ‡ä»¤å¯ä»¥ç›¸å¯¹äº<code>load()</code>æˆ–<code>store()</code>æœ¬åœ°é‡æ’ã€‚ä½†è¿™ä¸ªé‡æ’ä¸ä¼šä¾µçŠ¯åŸå­è¯»/å†™çš„è¾¹ç•Œã€‚</p><h3>åŸå­äº¤æ¢</h3><p>ä¸ºäº†ä¿è¯è¿ç»­ã€ä¸é—´æ–­çš„å…ˆè¯»åå†™ï¼ŒAtomics API æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼š <code>exchange()</code>å’Œ<code>compareExchange()</code>ã€‚<code>Atomics.exchange()</code>æ‰§è¡Œç®€å•çš„äº¤æ¢ï¼Œä»¥ä¿è¯å…¶ä»–çº¿ç¨‹ä¸ä¼šä¸­æ–­å€¼çš„äº¤æ¢ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const sharedArrayBuffer = new SharedArrayBuffer(4)
const view = new Unit32Array(sharedArrayBuffer)

Atomics.store(view, 0, 3)

console.log(Atomics.exchange(view, 0, 4)) // 3

console.log(Atomics.load(view, 0)) // 4</code>
        </deckgo-highlight-code><p>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½<strong>åªå¸Œæœ›</strong>åœ¨ä¸Šæ¬¡è¯»å–æŸä¸ªå€¼ä¹‹åæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¯¥å€¼çš„æƒ…å†µä¸‹æ‰å¯¹å…±äº«ç¼“å†²åŒºæ‰§è¡Œå†™æ“ä½œã€‚å¦‚æœè¿™ä¸ªå€¼æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±å¯ä»¥å®‰å…¨åœ°å†™å…¥æ›´æ–°åçš„å€¼ï¼›å¦‚æœè¿™ä¸ªå€¼è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæ‰§è¡Œå†™æ“ä½œå°†ä¼šç ´åå…¶ä»–çº¿ç¨‹è®¡ç®—çš„å€¼ã€‚å¯¹äºè¿™ç§ä»»åŠ¡ï¼ŒAtomics API æä¾›äº†<code>compareExchange()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åªåœ¨ç›®æ ‡ç´¢å¼•å¤„çš„å€¼å’Œé¢„æœŸå€¼åŒ¹é…æ—¶æ‰ä¼šæ‰§è¡Œå†™æ“ä½œã€‚</p><h3>åŸå­ Futex æ“ä½œä¸æ·é”</h3><p>å¦‚æœæ²¡æœ‰æŸç§é”æœºåˆ¶ï¼Œå¤šçº¿ç¨‹ç¨‹åºå°±æ— æ³•æ”¯æŒå¤æ‚éœ€æ±‚ã€‚ä¸ºæ­¤ï¼ŒAtomics API æä¾›äº†æ¨¡ä»¿ Linux Futexï¼ˆå¿«é€Ÿç”¨æˆ·ç©ºé—´äº’æ–¥é‡ï¼Œfast user-space mutexï¼‰çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æœ¬èº«è™½ç„¶éå¸¸ç®€å•ï¼Œä½†æ˜¯å¯ä»¥ä½œä¸ºæ›´å¤æ‚çš„é”æœºåˆ¶çš„åŸºæœ¬ç»„ä»¶ã€‚</p><h1>è·¨ä¸Šä¸‹æ–‡æ¶ˆæ¯</h1><p><strong>è·¨æ–‡æ¡£æ¶ˆæ¯</strong>ï¼Œæœ‰æ—¶å€™ç®€ç§°ä¸º XDMï¼ˆcross-document messaging)ï¼Œæ˜¯ä¸€ç§åœ¨ä¸åŒæ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå¦‚ä¸åŒå·¥ä½œè€…çº¿ç¨‹æˆ–ä¸åŒæºçš„é¡µé¢ï¼‰é—´ä¼ é€’ä¿¡æ¯çš„èƒ½åŠ›ã€‚ä¾‹å¦‚<code>www.wrox.com</code>ä¸Šçš„é¡µé¢æƒ³è¦ä¸åŒ…å«åœ¨å†…åµŒçª—æ ¼ä¸­<code>p2p.wrox.com</code>ä¸Šé¢çš„é¡µé¢é€šä¿¡ã€‚åœ¨ XDM ä¹‹å‰ï¼Œè¦ä»¥å®‰å…¨æ–¹å¼å®ç°è¿™ç§é€šä¿¡éœ€è¦åšå¾ˆå¤šå·¥ä½œã€‚XDM ä»¥å®‰å…¨æ˜“ç”¨çš„æ–¹å¼è§„èŒƒåŒ–äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><blockquote><p>è·¨ä¸Šä¸‹æ–‡æ¶ˆæ¯ç”¨äºçª—å£ä¹‹é—´æˆ–è€…å·¥ä½œçº¿ç¨‹ä¹‹é—´é€šä¿¡ã€‚</p></blockquote><p>XDM çš„æ ¸å¿ƒæ˜¯<code>postMessage()</code>æ–¹æ³•ã€‚é™¤äº† XDMï¼Œè¿™ä¸ªæ–¹æ³•åè¿˜åœ¨ HTML5 ä¸­å¾ˆå¤šåœ°æ–¹ç”¨åˆ°è¿‡ï¼Œä½†ç›®çš„éƒ½æ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯æŠŠæ•°æ®ä¼ é€åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚</p><p><code>postMessage()</code>æ–¹æ³•æ¥æ”¶ 3 ä¸ªå‚æ•°ï¼šæ¶ˆæ¯ã€è¡¨ç¤ºç›®æ ‡æ¥æ”¶æºçš„å­—ç¬¦ä¸²å’Œå¯é€‰çš„å¯ä¼ è¾“å¯¹è±¡çš„æ•°ç»„ï¼ˆåªä¸å·¥ä½œçº¿ç¨‹ç›¸å…³ï¼‰ã€‚ç¬¬äºŒä¸ªå‚æ•°å¯¹äºå®‰å…¨éå¸¸é‡è¦ï¼Œå…¶å¯ä»¥é™åˆ¶æµè§ˆå™¨äº¤ä»˜æ•°æ®çš„ç›®æ ‡ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const iframeWindow = document.getElementById(&#x27;myframe&#x27;).contentWindow

iframeWindow.postMessage(&#x27;A secret&#x27;, &#x27;http://www.wrox.com&#x27;)</code>
        </deckgo-highlight-code><p>æœ€åä¸€è¡Œä»£ç å°è¯•å‘å†…åµŒçª—æ ¼ä¸­å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œä¸”æŒ‡å®šäº†æºå¿…é¡»æ˜¯<code>&quot;http://www.wrox.com&quot;</code>ã€‚å¦‚æœæºåŒ¹é…ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šäº¤ä»˜åˆ°å†…åµŒçª—æ ¼ï¼›å¦åˆ™ï¼Œ<code>postMessage()</code>ä»€ä¹ˆä¹Ÿä¸åšã€‚è¿™ä¸ªé™åˆ¶å¯ä»¥ä¿æŠ¤ä¿¡æ¯ä¸ä¼šå› ä¸ºåœ°å€æ”¹å˜è€Œæ³„æ¼ã€‚å¦‚æœä¸æƒ³çŸ¥é™åˆ¶æ¥æ”¶ç›®æ ‡ï¼Œåˆ™å¯ä»¥ç»™<code>postMessage()</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ <code>&quot;*&quot;</code>ï¼Œä½†ä¸æ¨èè¿™ä¹ˆåšã€‚</p><p>æ¥æ”¶åˆ° XDM æ¶ˆæ¯åï¼Œ<code>window</code>å¯¹è±¡ä¸Šè§¦å‘<code>message</code>äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶æ˜¯å¼‚æ­¥è§¦å‘çš„ï¼Œå› æ­¤ä»æ¶ˆæ¯å‘å‡ºåˆ°æ¥æ”¶åˆ°æ¶ˆæ¯ï¼ˆæ¥æ”¶çª—å£è§¦å‘<code>message</code>äº‹ä»¶ï¼‰å¯èƒ½æœ‰å»¶è¿Ÿã€‚ä¼ ç»™<code>onmessage</code>äº‹ä»¶å¤„ç†ç¨‹åºçš„<code>event</code>å¯¹è±¡åŒ…å«ä»¥ä¸‹ 3 æ–¹æ³•é‡è¦ä¿¡æ¯ï¼š</p><ul><li><code>data</code> ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™<code>postMessage()</code>çš„å­—ç¬¦ä¸²æ•°æ®</li><li><code>origin</code> å‘é€æ¶ˆæ¯çš„æ–‡æ¡£æºï¼Œä¾‹å¦‚<code>&quot;http://ww.wrox.com&quot;</code></li><li><code>source</code> å‘é€æ¶ˆæ¯çš„æ–‡æ¡£ä¸­<code>window</code>å¯¹è±¡çš„ä»£ç†ã€‚è¿™ä¸ªä»£ç†å¯¹è±¡ä¸»è¦ç”¨äºåœ¨å‘é€ä¸€æ¡æ¶ˆæ¯çš„çª—å£ä¸­æ‰§è¡Œ<code>postMessage()</code>æ–¹æ³•ã€‚å¦‚æœå‘é€çª—å£æœ‰ç›¸åŒçš„æºï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡åº”è¯¥å°±æ˜¯<code>window</code>å¯¹è±¡ã€‚</li></ul><p>æ¥æ”¶æ¶ˆæ¯ä¹‹åéªŒè¯å‘é€çª—å£çš„æºæ˜¯éå¸¸é‡è¦çš„ã€‚ä¸<code>postMessage()</code>çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä¿è¯æ•°æ®ä¸å›æ„å¤–åœ°ä¼ ç»™æœªçŸ¥é¡µé¢ä¸€æ ·ã€‚åœ¨<code>onmessage</code>äº‹ä»¶å¤„ç†ç¨‹åºä¸­æ£€æŸ¥å‘é€çª—å£çš„æºå¯ä»¥ä¿è¯æ•°æ®æ¥è‡ªæ­£ç¡®çš„åœ°æ–¹ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>event.source</code>æ˜¯æŸä¸ª<code>window</code>å¯¹è±¡çš„ä»£ç†ï¼Œè€Œéå®é™…çš„<code>window</code>å¯¹è±¡ã€‚å› æ­¤ä¸èƒ½é€šè¿‡å®ƒè®¿é—®æ‰€æœ‰çª—å£ä¸‹çš„ä¿¡æ¯ã€‚æœ€å¥½åªä½¿ç”¨<code>postMessage()</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ°¸è¿œå­˜åœ¨ä¸”å¯ä»¥è°ƒç”¨ã€‚</p><p>åœ¨é€šè¿‡å†…åµŒçª—æ ¼åŠ è½½ä¸åŒçš„åŸŸæ—¶ï¼Œä½¿ç”¨ XDM æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚è¿™ç§æ–¹æ³•åœ¨æ··æ­<code>mashup</code>å’Œç¤¾äº¤åº”ç”¨ä¸­éå¸¸å¸¸ç”¨ã€‚é€šè¿‡ä½¿ç”¨ XDM ä¸å†…åµŒçª—æ ¼ä¸­çš„ç½‘é¡µé€šä¿¡ï¼Œå¯ä»¥ä¿è¯åŒ…å«é¡µé¢çš„å®‰å…¨ã€‚XDM ä¹Ÿå¯ä»¥ç”¨äºåŒæºé¡µé¢ä¹‹é—´çš„é€šä¿¡ã€‚</p><h1>Encodding API</h1><p>Encoding API ä¸»è¦ç”¨äºå®ç°å­—ç¬¦ä¸²ä¸å®šå‹æ•°ç»„ä¹‹é—´çš„è½¬æ¢ã€‚è§„èŒƒæ–°å¢äº† 4 ä¸ªç”¨äºæ‰§è¡Œè½¬æ¢çš„å…¨å±€ç±»ï¼š<code>TextEncoder</code>ã€<code>TextEncoderStream</code>ã€<code>TextDecoder</code>å’Œ<code>TextDecoderStream</code>ã€‚</p><blockquote><p>ç›¸æ¯”äº<strong>æ‰¹é‡ï¼ˆbulkï¼‰</strong>çš„ç¼–è§£ç ï¼Œå¯¹<strong>æµï¼ˆstreamï¼‰</strong>ç¼–è§£ç çš„æ”¯æŒå¾ˆæœ‰é™ã€‚</p></blockquote><h2>æ–‡æœ¬ç¼–ç </h2><p>Encoding API æä¾›äº†ä¸¤ç§å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå®šå‹æ•°ç»„äºŒè¿›åˆ¶æ ¼å¼çš„æ–¹æ³•ï¼šæ‰¹é‡ç¼–ç å’Œæµç¼–ç ã€‚æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå®šå‹æ•°ç»„æ—¶ï¼Œç¼–ç å™¨å§‹ç»ˆä½¿ç”¨ UTF-8ã€‚</p><h3>æ‰¹é‡ç¼–ç </h3><p>æ‰€è°“<strong>æ‰¹é‡</strong>ï¼ŒæŒ‡çš„æ˜¯ JavaScript å¼•æ“ä¼šåŒæ­¥ç¼–ç æ•´ä¸ªå­—ç¬¦ä¸²ã€‚å¯¹äºéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œå¯èƒ½ä¼šèŠ±è¾ƒé•¿æ—¶é—´ã€‚æ‰¹é‡ç¼–ç æ˜¯é€šè¿‡<code>TextEncoder</code>çš„å®ä¾‹å®Œæˆçš„ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()</code>
        </deckgo-highlight-code><p>è¿™ä¸ªå®ä¾‹ä¸Šæœ‰ä¸€ä¸ª<code>encode()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶ä»¥<code>Unit8Array</code>æ ¼å¼è¿”å›æ¯ä¸ªå­—ç¬¦çš„ UTF-8 ç¼–ç ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()
const decodedText = &#x27;foo&#x27;
const encodedText = textEncoder.encode(decodedText)

console.log(encodedText) // Unit8Array(3) [102, 111, 111]</code>
        </deckgo-highlight-code><p>ç¼–ç å™¨æ˜¯ç”¨äºå¤„ç†å­—ç¬¦çš„ï¼Œæœ‰äº›å­—ç¬¦ï¼ˆä¾‹å¦‚è¡¨æƒ…ç¬¦å·ï¼‰åœ¨æœ€ç»ˆè¿”å›çš„æ•°ç»„ä¸­å¯èƒ½ä¼šå æ®å¤šä¸ªç´¢å¼•ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()
const decodedText = &#x27;â˜º&#x27;
const encodedText = textEncoder.encode(decodedText)

console.log(encodedText) // Unit8Array(3) [226, 152, 186]</code>
        </deckgo-highlight-code><p>ç¼–ç å™¨å®ä¾‹è¿˜æœ‰ä¸€ä¸ª<code>encodeInto()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å’Œç›®æ ‡<code>Unit8Array</code>ï¼Œè¿”å›ä¸€ä¸ªå­—å…¸ï¼Œè¯¥å­—å…¸åŒ…å«<code>read</code>å’Œ<code>written</code>å±æ€§ï¼Œåˆ†åˆ«è¡¨ç¤ºæˆåŠŸä»æºå­—ç¬¦ä¸²è¯»å–äº†å¤šå°‘å­—ç¬¦å’Œå‘ç›®æ ‡æ•°ç»„å†™å…¥äº†å¤šå°‘å­—ç¬¦ã€‚å¦‚æœå®šå‹æ•°ç»„çš„ç©ºé—´ä¸å¤Ÿï¼Œç¼–ç å°±ä¼šæå‰ç»ˆæ­¢ï¼Œè¿”å›çš„å­—å…¸ä¼šä½“ç°è¿™ä¸ªç»“æœã€‚</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()
const fooArr = new Unit8Array(3)
const barArr = new Unit8Array(2)
const fooResult = textEncoder.encodeInto(&#x27;foo&#x27;, fooArr)
const barResult = textEncoder.encodeInto(&#x27;bar&#x27;, barArr)

console.log(foArr) // Unit8Array(3) [102, 111, 111]
console.log(fooResult) // { read: 3, written: 3 }
console.log(barArr) // Unit8Array(2) [98, 97]
console.log(barResult) // { read: 2, written: 2 }</code>
        </deckgo-highlight-code><p><code>encode()</code>è¦æ±‚åˆ†é…ä¸€ä¸ªæ–°çš„<code>Unit8Array</code>ï¼Œ<code>encodeInto()</code>åˆ™ä¸è¦ã€‚å¯¹äºè¿½æ±‚æ€§èƒ½çš„åº”ç”¨ï¼Œè¿™ä¸ªå·®åˆ«å¯èƒ½ä¼šå¸¦æ¥æ˜¾è‘—ä¸åŒã€‚</p><blockquote><p>æ–‡æœ¬ç¼–ç ä¼šå§‹ç»ˆä½¿ç”¨ UTF-8 æ ¼å¼ï¼Œè€Œä¸”å¿…é¡»å†™å…¥<code>Unit8Array</code>å®ä¾‹ã€‚ä½¿ç”¨å…¶ä»–ç±»å‹æ•°ç»„ä¼šå¯¼è‡´<code>encodeInto()</code>æŠ›å‡ºé”™è¯¯ã€‚</p></blockquote><h3>æµç¼–ç </h3><p><code>TextEncoderStream</code>å…¶å®å°±æ˜¯<code>TransformStream</code>å½¢å¼çš„<code>TextEncoder</code>ã€‚å°†è§£ç åçš„æ–‡æœ¬æµé€šè¿‡ç®¡é“è¾“å…¥æµç¼–ç å™¨ä¼šå¾—åˆ°ç¼–ç åæ–‡æœ¬å—çš„æµï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">async function* chars() {
  const decodeText = &#x27;foo&#x27;
  for (const char of decodeText) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, char))
  }
}

const decodedTextStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of chars()) {
      controller.enqueue(chunk)
    }

    controller.close()
  },
})

const encodedTextStream = decodedTextStream.pipeThrough(new TextEncoderStream())

const readableStreamDefaultReader = encodeTextStream.getReader()(
  async function () {
    while (true) {
      const { done, value } = await readableStreamDefaultReader.read()
      if (done) {
        break
      } else {
        console.log(value)
      }
    }
  }
)()

// Unit8Array [102]
// Unit8Array [111]
// Unit8Array [111]</code>
        </deckgo-highlight-code><h2>æ–‡æœ¬è§£ç </h2><p>Encoding API æä¾›äº†ä¸¤ç§å°†å®šå‹æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ–¹å¼ï¼šæ‰¹é‡è§£ç å’Œæµè§£ç ã€‚ä¸ç¼–ç å™¨ç±»ä¸åŒï¼Œåœ¨å°†å®šå‹æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè§£ç å™¨æ”¯æŒéå¸¸å¤šçš„å­—ç¬¦ä¸²ç¼–ç ã€‚é»˜è®¤å­—ç¬¦ç¼–ç æ ¼å¼æ˜¯ UTF-8ã€‚</p><h3>æ‰¹é‡è§£ç </h3><p>æ‰€è°“<strong>æ‰¹é‡</strong>ï¼ŒæŒ‡çš„æ˜¯ JavaScript å¼•æ“ä¼šåŒæ­¥è§£ç æ•´ä¸ªå­—ç¬¦ä¸²ã€‚å¯¹äºéå¸¸é•¿çš„å­—ç¬¦ä¸²ï¼Œå¯èƒ½ä¼šèŠ±è¾ƒé•¿æ—¶é—´ã€‚æ‰¹é‡è§£ç æ˜¯é€šè¿‡<code>TextDecoder</code>çš„å®ä¾‹å®Œæˆçš„ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()</code>
        </deckgo-highlight-code><p>è¿™ä¸ªå®ä¾‹ä¸Šæœ‰ä¸€ä¸ª<code>decode()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå®šå‹æ•°ç»„å‚æ•°ï¼Œè¿”å›è§£ç åçš„å­—ç¬¦ä¸²ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()
const encodedText = Uint8Array.of(102, 111, 111)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // foo</code>
        </deckgo-highlight-code><p>è§£ç å™¨ä¸å…³å¿ƒä¼ å…¥çš„æ˜¯å“ªç§å®šå‹æ•°ç»„ï¼Œå®ƒåªä¼šä¸“å¿ƒè§£ç æ•´ä¸ªäºŒè¿›åˆ¶è¡¨ç¤ºã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåªåŒ…å« 8 ä½å­—ç¬¦çš„ 32 ä½å€¼è¢«è§£ç ä¸º UTF-8 æ ¼å¼ï¼Œè§£ç å¾—åˆ°çš„å­—ç¬¦ä¸²ä¸­å¡«å……äº†ç©ºæ ¼ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()

const encodedText = Uint32Array.of(102, 111, 111)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // &#x27;foo&#x27;</code>
        </deckgo-highlight-code><p>è§£ç å™¨æ˜¯ç”¨äºå¤„ç†å®šå‹æ•°ç»„ä¸­åˆ†æ•£åœ¨å¤šä¸ªç´¢å¼•ä¸Šçš„å­—ç¬¦çš„ï¼ŒåŒ…æ‹¬è¡¨æƒ…ç¬¦å·ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()

const encodedText = Uint8Array.of(240, 159, 152, 138)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // &#x27;ğŸ˜Š&#x27;</code>
        </deckgo-highlight-code><p>å’Œ<code>TextEncoder</code>ä¸åŒï¼Œ<code>TextDecoder</code>å¯ä»¥å…¼å®¹å¾ˆå¤šå­—ç¬¦ç¼–ç ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­å°±ä½¿ç”¨äº† UTF-16 è€Œéé»˜è®¤çš„ UTF-8:</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder(&#x27;utf-16&#x27;)

const encodedText = Uint16Array.of(102, 111, 111)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // &#x27;foo&#x27;</code>
        </deckgo-highlight-code><h3>æµè§£ç </h3><p><code>TextDecoderStream</code>å…¶å®å°±æ˜¯<code>TransformStream</code>å½¢å¼çš„<code>TextDecoder</code>ã€‚å°†ç¼–ç åçš„æ–‡æœ¬æµé€šè¿‡ç®¡é“è¾“å…¥æµè§£ç å™¨ä¼šå¾—åˆ°è§£ç åçš„æ–‡æœ¬å—çš„æµï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">async function* chars() {
  const encodedText = [102, 111, 111].map(x =&gt; Uint8Array.of(x))
  for (const char of encodedText) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, char))
  }
}

const encodedTextStream = new ReadableStream({
  async start(controller) {
    for await (const chunk of chars()) {
      controller.enqueue(chunk)
    }

    controller.close()
  },
})

const decodedTextStream = encodedTextStream.pipeThrough(new TextDecoderStream())
const readableStreamDefaultReader = decodedTextStream.getReader()(
  async function () {
    while (true) {
      const { done, value } = await readableStreamDefaultReader.read()

      if (done) {
        break
      } else {
        console.log(value)
      }
    }
  }
)()

// f
// o
// o</code>
        </deckgo-highlight-code><p>æ–‡æœ¬è§£ç å™¨æµèƒ½å¤Ÿè¯†åˆ«å¯èƒ½åˆ†æ•£åœ¨ä¸åŒå—ä¸Šçš„ä»£ç†å¯¹ã€‚è§£ç å™¨æµä¼šä¿æŒå—ç‰‡æ®µç›´åˆ°å–å¾—å®Œæ•´çš„å­—ç¬¦ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæµè§£ç å™¨åœ¨è§£ç æµå¹¶è¾“å‡ºå­—ç¬¦ä¹‹å‰ä¼šç­‰å¾…ä¼ å…¥ 4 ä¸ªå—ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">async function* chars() {
  const encodedText = [240, 159, 152, 138].map(x =&gt; Uint8Array.of(x))

  for (const char of encodedText) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, char))
  }
}

const encodedTextStream = new ReadableStream({
  async start(controller) {
    for await (const chunk of chars()) {
      controller.enqueue(chunk)
    }
    controller.close()
  },
})

const decodedTextStream = encodedTextStream.pipeThrough(new TextDecoderStream())

const readableStreamDefaultReader = decodeTextStream.getReader()(
  async function () {
    while (true) {
      const { done, value } = await readableStreamDefaultReader.read()

      if (done) {
        break
      } else {
        console.log(value)
      }
    }
  }
)()

// &#x27;ğŸ˜Š&#x27;</code>
        </deckgo-highlight-code><p>æ–‡æœ¬è§£ç å™¨æµç»å¸¸ä¸<code>fetch()</code>ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå“åº”ä½“å¯ä»¥ä½œä¸º<code>ReadableStream</code>æ¥å¤„ç†ã€‚ä¾‹å¦‚ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const response = await fetch(url)
const stream = response.body.pipeThrough(new TextDecoderStream())
const decodedStream = stream.getReader()

for await (const decodedChunk of decodedStream) {
  console.log(decodedChunk)
}</code>
        </deckgo-highlight-code><h1>File API ä¸ Blob API</h1><p>Web åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªä¸»è¦ç—›ç‚¹æ˜¯æ— æ³•æ“ä½œç”¨æˆ·è®¡ç®—æœºä¸Šçš„æ–‡ä»¶ã€‚2000 å¹´ä¹‹å‰ï¼Œå¤„ç†æ–‡ä»¶çš„å”¯ä¸€æ–¹å¼æ˜¯æŠŠ<code>&lt;input type=&quot;file&quot;&gt;</code>æ”¾åˆ°ä¸€ä¸ªè¡¨å•é‡Œï¼Œä»…æ­¤è€Œå·²ã€‚File API ä¸ Blob API æ˜¯ä¸ºäº†è®© Web å¼€å‘è€…èƒ½ä»¥å®‰å…¨çš„æ–¹å¼è®¿é—®å®¢æˆ·ç«¯æœºå™¨ä¸Šçš„æ–‡ä»¶ï¼Œä»è€Œæ›´å¥½åœ°ä¸è¿™äº›æ–‡ä»¶äº¤äº’è€Œè®¾è®¡çš„ã€‚</p><h2><code>File</code>ç±»å‹</h2><p><strong>File API ä»ç„¶ä»¥è¡¨å•ä¸­çš„æ–‡ä»¶è¾“å…¥å­—æ®µä¸ºåŸºç¡€</strong>ï¼Œä½†æ˜¯å¢åŠ äº†ç›´æ¥è®¿é—®æ–‡ä»¶ä¿¡æ¯çš„èƒ½åŠ›ã€‚HTML5 åœ¨ DOM ä¸Šä¸ºè¾“å…¥å…ƒç´ æ·»åŠ äº†<code>files</code>é›†åˆã€‚å½“ç”¨æˆ·åœ¨æ–‡ä»¶å­—æ®µä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œè¿™ä¸ª<code>file</code>é›†åˆä¸­ä¼šåŒ…å«ä¸€ç»„<code>File</code>å¯¹è±¡ï¼Œè¡¨ç¤ºè¢«é€‰ä¸­çš„æ–‡ä»¶ã€‚æ¯ä¸ª<code>File</code>å¯¹è±¡éƒ½æœ‰ä¸€äº›<strong>åªè¯»</strong>å±æ€§ã€‚</p><ul><li><code>name</code>ï¼šæœ¬åœ°ç³»ç»Ÿä¸­çš„æ–‡ä»¶å</li><li><code>size</code>ï¼šä»¥å­—èŠ‚è®¡ç®—çš„æ–‡ä»¶å¤§å°</li><li><code>type</code>ï¼šåŒ…å«æ–‡ä»¶ MIME ç±»å‹çš„å­—ç¬¦ä¸²</li><li><code>lastModifiedDate</code>ï¼šè¡¨ç¤ºæ–‡ä»¶æœ€åä¿®æ”¹äº‹ä»¶çš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå±æ€§ç›®å‰åªæœ‰ Chrome å®ç°äº†ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œé€šè¿‡ç›‘å¬<code>change</code>äº‹ä»¶ç„¶åéå†<code>files</code>é›†åˆå¯ä»¥å–å¾—æ¯ä¸ªé€‰ä¸­æ–‡ä»¶çš„ä¿¡æ¯ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const fileList = document.getElementById(&#x27;files-list&#x27;)

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const files = event.target.files
  let i = 0
  while (i &lt; files.length) {
    const f = files[i]
    console.log(`${f.name}, ${f.type}, ${f.size} bytes`)
    i++
  }
})</code>
        </deckgo-highlight-code><p>è¿™ä¸ªä¾‹å­ç®€å•å°†æ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ä»…å°±è¿™ä¸ªèƒ½åŠ›è€Œè¨€ï¼ŒWeb åº”ç”¨å·²ç»æ¯”æ²¡æœ‰ File API ä¹‹å‰è¿ˆè¿›äº†ä¸€å¤§æ­¥ã€‚ä¸è¿‡ï¼ŒFile API è¿˜æä¾›äº†<code>FileReader</code>ç±»å‹ï¼Œè®©æˆ‘ä»¬å¯ä»¥å®é™…ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</p><h2><code>FileReader</code>ç±»å‹</h2><p><code>FileReader</code>ç±»å‹è¡¨ç¤ºä¸€ç§å¼‚æ­¥æ–‡ä»¶è¯»å–æœºåˆ¶ã€‚å¯ä»¥æŠŠ<code>FileReader</code>æƒ³è±¡æˆç±»ä¼¼äº<code>XMLHttpRequest</code>ï¼Œåªä¸è¿‡æ˜¯ç”¨äºä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä»æœåŠ¡å™¨è¯»å–æ•°æ®ã€‚<code>FileReader</code>ç±»å‹æä¾›äº†å‡ ä¸ªè¯»å–æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ã€‚</p><ul><li><code>readAsText(file, encoding)</code>ï¼šä»æ–‡ä»¶ä¸­è¯»å–çº¯æ–‡æœ¬å†…å®¹å¹¶ä¿å­˜åœ¨<code>result</code>å±æ€§ä¸­ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºç¼–ç ï¼Œæ˜¯å¯é€‰çš„ã€‚</li><li><code>readAsDataURL(file)</code>ï¼šè¯»å–æ–‡ä»¶å¹¶å°†å†…å®¹çš„æ•°æ® URI ä¿å­˜åœ¨<code>result</code>å±æ€§ä¸­ã€‚</li><li><code>readAsBinaryString(file)</code>ï¼šè¯»å–æ–‡ä»¶å¹¶å°†æ¯ä¸ªå­—ç¬¦çš„äºŒè¿›åˆ¶æ•°æ®ä¿å­˜åœ¨<code>result</code>å±æ€§ä¸­ã€‚</li><li><code>readAsArrayBuffer(file)</code>ï¼šè¯»å–æ–‡ä»¶å¹¶å°†æ–‡ä»¶å†…å®¹ä»¥<code>ArrayBuffer</code>å½¢å¼ä¿å­˜åœ¨<code>result</code>å±æ€§ã€‚</li></ul><p>è¿™äº›è¯»å–æ•°æ®çš„æ–¹æ³•ä¸ºå¤„ç†æ–‡ä»¶æ•°æ®æä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†å‘ç”¨æˆ·æ˜¾ç¤ºå›¾ç‰‡ï¼Œå¯ä»¥å°†å›¾ç‰‡æ•°æ®è¯»å–ä¸º URIï¼Œè€Œä¸ºäº†è§£ææ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å°†æ–‡ä»¶è¯»å–ä¸ºæ–‡æœ¬ã€‚</p><p>å› ä¸ºè¿™äº›è¯»å–æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æ¯ä¸ª<code>FileReader</code>ä¼šå‘å¸ƒå‡ ä¸ªäº‹ä»¶ï¼Œå…¶ä¸­ 3 ä¸ªæœ€æœ‰ç”¨çš„äº‹ä»¶æ˜¯<code>progress</code>ã€<code>error</code>å’Œ<code>load</code>ï¼Œåˆ†åˆ«è¡¨ç¤ºè¿˜æœ‰æ›´å¤šæ•°æ®ã€å‘ç”Ÿäº†é”™è¯¯å’Œè¯»å–å®Œæˆã€‚</p><p><code>progress</code>äº‹ä»¶æ¯ 50 æ¯«ç§’å°±ä¼šè§¦å‘ä¸€æ¬¡ï¼Œå’Œ XHR çš„<code>progress</code>äº‹ä»¶å…·æœ‰ç›¸åŒçš„ä¿¡æ¯ï¼š<code>lengthComputable</code>ã€<code>loaded</code>å’Œ<code>total</code>ã€‚æ­¤å¤–ï¼Œåœ¨<code>progress</code>äº‹ä»¶ä¸­å¯ä»¥è¯»å–<code>FileReader</code>çš„<code>result</code>å±æ€§ï¼Œå³ä½¿å…¶ä¸­å°šæœªåŒ…å«å…¨éƒ¨æ•°æ®ã€‚</p><p><code>error</code>äº‹ä»¶ä¼šåœ¨ç”±äºæŸç§åŸå› æ— æ³•è¯»å–æ–‡ä»¶æ—¶è§¦å‘ã€‚è§¦å‘<code>error</code>äº‹ä»¶æ—¶ï¼Œ<code>FileReader</code>çš„<code>error</code>å±æ€§ä¼šåŒ…å«é”™è¯¯ä¿¡æ¯ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåªåŒ…å«ä¸€ä¸ªå±æ€§ï¼š<code>code</code>ã€‚è¿™ä¸ªé”™è¯¯ç çš„å€¼å¯èƒ½æ˜¯ 1ï¼ˆæœªæ‰¾åˆ°æ–‡ä»¶ï¼‰ã€2ï¼ˆå®‰å…¨é”™è¯¯ï¼‰ã€3ï¼ˆè¯»å–è¢«ä¸­æ–­ï¼‰ã€4ï¼ˆæ–‡ä»¶ä¸å¯è¯»ï¼‰æˆ– 5ï¼ˆç¼–ç é”™è¯¯ï¼‰ã€‚</p><p><code>load</code>äº‹ä»¶ä¼šåœ¨æ–‡ä»¶åŠ è½½æˆåŠŸåè§¦å‘ã€‚å¦‚æœ<code>error</code>äº‹ä»¶è¢«è§¦å‘ï¼Œåˆ™ä¸ä¼šå†è§¦å‘<code>load</code>äº‹ä»¶ã€‚</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const filesList = document.getElementById(&#x27;files-list&#x27;)

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  const progress = document.getElementById(&#x27;progress&#x27;)
  const files = event.target.files
  const type = &#x27;default&#x27;
  const reader = new FileReader()

  if (/image/.test(files[0].type)) {
    reader.readAsDataURL(files[0])
    type = &#x27;image&#x27;
  } else {
    reader.readAsText(files[0])
    type = &#x27;text&#x27;
  }

  reader.onerror = function () {
    output.innerHTML = &#x27;Could not read file, error code is &#x27; + reader.error.code
  }

  reader.onprogress = function (event) {
    if (event.lengthComputable) {
      progress.innerHTML = `${event.loaded}/${event.total}`
    }
  }

  reader.onload = function () {
    let html = &#x27;&#x27;

    switch (type) {
      case &#x27;image&#x27;:
        html = `&lt;img src=&quot;${reader.result}&quot;&gt;`
        break
      case &#x27;text&#x27;:
        html = reader.result
        break
    }
    output.innerHTML = html
  }
})</code>
        </deckgo-highlight-code><p>ä»¥ä¸Šä»£ç ä»è¡¨å•å­—æ®µä¸­è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹æ˜¾ç¤ºåœ¨äº†ç½‘é¡µä¸Šã€‚å¦‚æœæ–‡ä»¶çš„ MIME ç±»å‹è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œé‚£ä¹ˆå°±å°†å…¶è¯»å–åä¿å­˜ä¸ºæ•°æ® URLï¼Œåœ¨<code>load</code>äº‹ä»¶è§¦å‘æ—¶å°†æ•°æ® URI ä½œä¸ºå›¾ç‰‡æ’å…¥é¡µé¢ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸æ˜¯å›¾ç‰‡ï¼Œåˆ™è¯»å–åå°†å…¶ä¿å­˜ä¸ºæ–‡æœ¬å¹¶åŸæ ·è¾“å‡ºåˆ°ç½‘é¡µä¸Šã€‚<code>progress</code>äº‹ä»¶ç”¨äºè·Ÿè¸ªå’Œæ˜¾ç¤ºè¯»å–æ–‡ä»¶çš„è¿›åº¦ï¼Œè€Œ<code>error</code>äº‹ä»¶ç”¨äºç›‘æ§é”™è¯¯ã€‚</p><p>å¦‚æœæƒ³æå‰ç»“æŸæ–‡ä»¶è¯»å–ï¼Œåˆ™å¯ä»¥åœ¨è¿‡ç¨‹ä¸­è°ƒç”¨<code>abort()</code>æ–¹æ³•ï¼Œä»è€Œè§¦å‘<code>abort</code>äº‹ä»¶ã€‚åœ¨<code>load</code>ã€<code>error</code>å’Œ<code>abort</code>äº‹ä»¶è§¦å‘åï¼Œè¿˜ä¼šè§¦å‘<code>loadend</code>äº‹ä»¶ã€‚<code>loadend</code>äº‹ä»¶è¡¨ç¤ºåœ¨ä¸Šè¿° 3 ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¯»å–æ“ä½œéƒ½å·²ç»“æŸã€‚<code>readAsText()</code>å’Œ<code>readAsDataURL()</code>æ–¹æ³•å·²ç»å¾—åˆ°äº†æ‰€æœ‰ä¸»æµæµè§ˆå™¨æ”¯æŒã€‚</p><h2><code>FileReaderSync</code>ç±»å‹</h2><p>é¡¾åæ€ä¹‰ï¼Œ<code>FileReaderSync</code>ç±»å‹å°±æ˜¯<code>FileReader</code>çš„<strong>åŒæ­¥ç‰ˆæœ¬</strong>ã€‚è¿™ä¸ªç±»å‹æ‹¥æœ‰ä¸<code>FileReader</code>ç›¸åŒçš„æ–¹æ³•ï¼Œåªæœ‰åœ¨æ•´ä¸ªæ–‡ä»¶éƒ½åŠ è½½åˆ°å†…å­˜ä¹‹åæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚<code>FileReaderSync</code>åªåœ¨å·¥ä½œçº¿ç¨‹ä¸­å¯ç”¨ï¼Œå› ä¸ºå¦‚æœè¯»å–æ•´ä¸ªæ–‡ä»¶è€—æ—¶å¤ªé•¿åˆ™ä¼šå½±å“å…¨å±€ã€‚</p><p>å‡è®¾é€šè¿‡<code>postMessage()</code>å‘å·¥ä½œçº¿ç¨‹å‘é€äº†ä¸€ä¸ª<code>File</code>å¯¹è±¡ã€‚ä»¥ä¸‹ä»£ç ä¼šè®©å·¥ä½œçº¿ç¨‹åŒæ­¥å°†æ–‡ä»¶è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç„¶åå°†æ–‡ä»¶çš„æ•°æ® URL å‘é€å›æ¥ã€‚</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">// worker.js

self.onmessage = messageEvent =&gt; {
  const syncReader = new FileReaderSync()
  console.log(syncReader) // FileReaderSync {}

  // è¯»å–æ–‡ä»¶æ—¶é˜»å¡å·¥ä½œçº¿ç¨‹
  const result = syncReader.readAsDataURL(messageEvent.data)

  // PDFæ–‡ä»¶çš„ç¤ºä¾‹å“åº”
  console.log(result) // data:application/pdf;base64,....

  // æŠŠURLå‘å›å»
  self.postMessage(result)
}</code>
        </deckgo-highlight-code><h2><code>Blob</code>ä¸éƒ¨åˆ†è¯»å–</h2><p>æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦è¯»å–éƒ¨åˆ†æ–‡ä»¶è€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶ã€‚ä¸ºæ­¤ï¼Œ<code>File</code>å¯¹è±¡æä¾›äº†ä¸€ä¸ªåä¸º<code>slice()</code>çš„æ–¹æ³•ã€‚<code>slice()</code>æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šèµ·å§‹å­—èŠ‚å’Œè¦è¯»å–çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª<code>Blob</code>å®ä¾‹ï¼Œè€Œ<code>Blob</code>å®é™…ä¸Šæ˜¯<code>File</code>çš„åŸºç±»ã€‚</p><p>Blob è¡¨ç¤º<strong>äºŒè¿›åˆ¶å¤§å¯¹è±¡</strong>(binary large object)ï¼Œæ˜¯ JavaScript å¯¹ä¸å¯ä¿®æ”¹äºŒè¿›åˆ¶æ•°æ®çš„å°è£…ç±»å‹ã€‚åŒ…å«å­—ç¬¦ä¸²çš„æ•°ç»„ã€<code>ArrayBuffers</code>ã€<code>ArrayBufferViews</code>ï¼Œç”šè‡³å…¶ä»–<code>Blob</code>éƒ½å¯ä»¥ç”¨æ¥åˆ›å»º blobã€‚<code>Blob</code>æ„é€ å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ª<code>options</code>å‚æ•°ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å®š MIME ç±»å‹ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">console.log(new Blob([&#x27;foo&#x27;]))
// Blob {size: 3, type: &#x27;&#x27;}

console.log(new Blob([&#x27;{&quot;a&quot;, &quot;b&quot;}&#x27;], { type: &#x27;application/json&#x27; }))
// {size: 10, type: &quot;application/json&quot;}

console.log(new Blob([&#x27;&lt;p&gt;Foo&lt;/p&gt;&#x27;, &#x27;&lt;p&gt;Bar&lt;/p&gt;&#x27;], { type: &#x27;text/html&#x27; }))
// {size: 20, type: &#x27;text/html&#x27;}</code>
        </deckgo-highlight-code><p><code>Blob</code>å¯¹è±¡æœ‰ä¸€ä¸ª<code>size</code>å±æ€§å’Œä¸€ä¸ª<code>type</code>å±æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>slice()</code>æ–¹æ³•ç”¨äºè¿›ä¸€æ­¥åˆ‡åˆ†æ•°æ®ã€‚å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨<code>FileReader</code>ä»<code>Blob</code>ä¸­è¯»å–æ•°æ®ã€‚ä¸‹é¢çš„ä¾‹å­åªä¼šè¯»å–æ–‡ä»¶çš„å‰ 32 å­—èŠ‚ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const fileList = document.getElementById(&#x27;files-list&#x27;)

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  const progress = document.getElementById(&#x27;progress&#x27;)
  const files = event.target.files
  const reader = new FileReader()
  const blob = blobSlice(files[0], 0, 32)

  if (blob) {
    reader.readAsText(blob)

    reader.onerror = function () {
      output.innerHTML =
        &#x27;Could not read file, error code is &#x27; + reader.error.code
    }

    reader.onload = function () {
      output.innerHTML = reader.result
    }
  } else {
    console.log(&#x27;You browser does not support slice()&#x27;)
  }
})</code>
        </deckgo-highlight-code><p>åªè¯»å–éƒ¨åˆ†æ–‡ä»¶å¯ä»¥èŠ‚çœæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åªéœ€è¦æ•°æ®ç‰¹å®šéƒ¨åˆ†ä¾‹å¦‚æ–‡ä»¶å¤´éƒ¨ã€‚</p><h2>å¯¹è±¡ URL å’Œ<code>Blob</code></h2><p>å¯¹è±¡ URL æœ‰æ—¶å€™ä¹Ÿç§°ä¸º Blob URLï¼Œæ˜¯æŒ‡å¼•ç”¨å­˜å‚¨åœ¨<code>File</code>æˆ–<code>Blob</code>ä¸­æ•°æ®çš„ URLã€‚å¯¹è±¡ URL çš„ä¼˜ç‚¹æ˜¯ä¸ç”¨æŠŠæ–‡ä»¶å†…å®¹è¯»å–åˆ° JavaScript ä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡ä»¶ã€‚åªè¦åœ¨é€‚å½“ä½ç½®æä¾›å¯¹è±¡ URL å³å¯ã€‚è¦åˆ›å»ºå¯¹è±¡ URLï¼Œå¯ä»¥ä½¿ç”¨<code>window.URL.createObjectURL()</code>æ–¹æ³•å¹¶ä¼ å…¥<code>File</code>æˆ–<code>Blob</code>å¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°è¿”å›çš„å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­åœ°å€çš„å­—ç¬¦ä¸²ã€‚å› ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ URLï¼Œæ‰€ä»¥å¯ä»¥åœ¨ DOM ä¸­ç›´æ¥ä½¿ç”¨ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä½¿ç”¨å¯¹è±¡ URL åœ¨é¡µé¢ä¸­æ˜¾ç¤ºäº†ä¸€å¼ å›¾ç‰‡ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const filesList = document.getElementById(&#x27;files-list&#x27;)

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  const progress = document.getElementById(&#x27;progress&#x27;)
  const files = event.target.files
  const reader = new FileReader()
  const url = window.URL.createObjectURL(files[0])

  if (url) {
    if (/image/.test(files[0].type)) {
      output.innerHTML = `&lt;img src=&quot;${url}&quot;}&gt;`
    } else {
      output.innerHTML = &#x27;Not an image.&#x27;
    }
  } else {
    output.innerHTML = `Your browser doesn&#x27;t support object URLs.`
  }
})</code>
        </deckgo-highlight-code><p>å¦‚æœæŠŠå¯¹è±¡ URL ç›´æ¥æ”¾åˆ°<code>&lt;img&gt;</code>æ ‡ç­¾ï¼Œå°±ä¸è¦æŠŠæ•°æ®é¢„å…ˆè¯»å–åˆ° JavaScript ä¸­äº†ã€‚<code>&lt;img&gt;</code>æ ‡ç­¾å¯ä»¥ç›´æ¥ä»ç›¸åº”çš„å†…å­˜ä½ç½®æŠŠæ•°æ®è¯»å–åˆ°é¡µé¢ä¸Šã€‚</p><p>ä½¿ç”¨å®Œæ•°æ®åï¼Œæœ€å¥½èƒ½é‡Šæ”¾ä¸ä¹‹å…³è”çš„å†…å­˜ã€‚åªè¦å¯¹è±¡ URL åœ¨ä½¿ç”¨ä¸­ï¼Œå°±ä¸èƒ½é‡Šæ”¾å†…å­˜ã€‚å¦‚æœæƒ³è¡¨æ˜ä¸å†ä½¿ç”¨æŸä¸ªå¯¹è±¡ URLï¼Œåˆ™å¯ä»¥å°†å…¶ä¼ ç»™<code>window.URL.revokeObjectURL()</code>ã€‚é¡µé¢å¸è½½æ—¶ï¼Œæ‰€æœ‰å¯¹è±¡ URL å ç”¨çš„å†…å­˜éƒ½ä¼šè¢«é‡Šæ”¾ã€‚ä¸è¿‡ï¼Œæœ€å¥½åœ¨ä¸ä½¿ç”¨æ—¶å°±ä¼šç«‹å³é‡Šæ”¾å†…å­˜ï¼Œä»¥ä¾¿å°½å¯èƒ½ä¿æŒé¡µé¢å ç”¨æœ€å°‘èµ„æºã€‚</p><h2>è¯»å–æ‹–æ”¾æ–‡ä»¶</h2><p>ç»„åˆä½¿ç”¨ HTML5 æ‹–æ”¾ API å’Œ File API å¯ä»¥åˆ›å»ºè¯»å–æ–‡ä»¶ä¿¡æ¯çš„æœ‰è¶£åŠŸèƒ½ã€‚åœ¨é¡µé¢ä¸Šåˆ›å»ºæ”¾ç½®ç›®æ ‡åï¼Œå¯ä»¥ä»æ¡Œé¢ä¸ŠæŠŠæ–‡ä»¶æ‹–åŠ¨å¹¶æ”¾åˆ°æ”¾ç½®ç›®æ ‡ã€‚è¿™æ ·ä¼šåƒæ‹–æ”¾å›¾ç‰‡æˆ–é“¾æ¥ä¸€æ ·è§¦å‘<code>drop</code>äº‹ä»¶ã€‚è¢«æ”¾ç½®çš„æ–‡ä»¶å¯ä»¥é€šè¿‡äº‹ä»¶çš„<code>event.dataTransfer.files</code>å±æ€§è¯»å–åˆ°ï¼Œè¿™ä¸ªå±æ€§ä¿å­˜ç€ä¸€ç»„<code>File</code>å¯¹è±¡ï¼Œå°±åƒæ–‡æœ¬è¾“å…¥å­—æ®µä¸€æ ·ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¼šæŠŠæ‹–æ”¾åˆ°é¡µé¢æ”¾ç½®ç›®æ ‡ä¸Šçš„æ–‡ä»¶ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const droptarget = document.getElementById(&#x27;droptarget&#x27;)

function handleEvent(event) {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  let files, i, len
  event.preventDefault()

  if (event.type === &#x27;drop&#x27;) {
    files = event.dataTransfer.files
    i = 0
    len = files.length
    while (i &lt; len) {
      info += `${files[i].name} (${files[i].type}), ${files[i].size} bytes&lt;br&gt;`
      i++
    }

    output.innerHTML = info
  }
}

droptarget.addEventListener(&#x27;dragenter&#x27;, handleEvent)
droptarget.addEventListener(&#x27;dragover&#x27;, handleEvent)
droptarget.addEventListener(&#x27;drop&#x27;, handleEvent)</code>
        </deckgo-highlight-code><p>ä¸åé¢è¦ä»‹ç»çš„æ‹–æ”¾ä¾‹å­ä¸€æ ·ï¼Œå¿…é¡»å–æ¶ˆ<code>dragenter</code>ã€<code>dragover</code>å’Œ<code>drop</code>çš„é»˜è®¤è¡Œä¸ºã€‚åœ¨<code>drop</code>äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œå¯ä»¥é€šè¿‡<code>event.dataTransfer.files</code>è¯»å–åˆ°æ–‡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥è·å–æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚</p><h1>åª’ä½“å…ƒç´ </h1><p>éšç€åµŒå…¥éŸ³é¢‘å’Œè§†é¢‘å…ƒç´ åœ¨ Web åº”ç”¨ä¸Šçš„æµè¡Œï¼Œå¤§å¤šæ•°å†…å®¹æä¾›å•†ä¼šå¼ºè¿«ä½¿ç”¨ Flash ä»¥ä¾¿è¾¾åˆ°æœ€ä½³çš„è·¨æµè§ˆå™¨å…¼å®¹æ€§ã€‚HTML5 æ–°å¢äº†ä¸¤ä¸ªä¸åª’ä½“ç›¸å…³çš„å…ƒç´ ï¼Œå³<code>&lt;audio&gt;</code>å’Œ<code>&lt;video&gt;</code>ï¼Œä»è€Œä¸ºæµè§ˆå™¨æä¾›äº†åµŒå…¥éŸ³é¢‘å’Œè§†é¢‘çš„ç»Ÿä¸€è§£å†³æ–¹æ¡ˆã€‚</p><p>è¿™ä¸¤ä¸ªå…ƒç´ æ—¢æ”¯æŒ Web å¼€å‘è€…åœ¨é¡µé¢ä¸­åµŒå…¥åª’ä½“æ–‡ä»¶ï¼Œä¹Ÿæ”¯æŒ JavaScript å®ç°å¯¹åª’ä½“çš„è‡ªå®šä¹‰æ§åˆ¶ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„ç”¨æ³•ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;!-- åµŒå…¥è§†é¢‘ --&gt;
&lt;video src=&quot;conference.mpg&quot; id=&quot;myVideo&quot;&gt;Video player not available.&lt;/video&gt;
&lt;!-- åµŒå…¥éŸ³é¢‘ --&gt;
&lt;audio src=&quot;song.mp3&quot; id=&quot;myAudio&quot;&gt;Audio player not available.&lt;/audio&gt;</code>
        </deckgo-highlight-code><p>æ¯ä¸ªå…ƒç´ è‡³å°‘è¦æ±‚æœ‰ä¸€ä¸ª<code>src</code>å±æ€§ï¼Œä»¥è¡¨ç¤ºè¦åŠ è½½çš„åª’ä½“æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šè¡¨ç¤ºè§†é¢‘æ’­æ”¾å™¨å¤§å°çš„<code>width</code>å’Œ<code>height</code>å±æ€§ï¼Œä»¥åŠåœ¨è§†å±åŠ è½½æœŸé—´æ˜¾ç¤ºå›¾ç‰‡ URI çš„<code>poster</code>å±æ€§ã€‚å¦å¤–ï¼Œ<code>controls</code>å±æ€§å¦‚æœå­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºæµè§ˆå™¨åº”è¯¥æ˜¾ç¤ºæ’­æ”¾ç•Œé¢ï¼Œè®©ç”¨æˆ·å¯ä»¥ç›´æ¥æ§åˆ¶åª’ä½“ã€‚<strong>å¼€å§‹å’Œç»“æŸæ ‡ç­¾ä¹‹é—´çš„å†…å®¹æ˜¯åœ¨åª’ä½“æ’­æ”¾å™¨ä¸å¯ç”¨æ—¶æ˜¾ç¤ºçš„æ›¿ä»£å†…å®¹</strong>ã€‚</p><p>ç”±äºæµè§ˆå™¨æ”¯æŒçš„åª’ä½“æ ¼å¼ä¸åŒï¼Œå› æ­¤å¯ä»¥æŒ‡å®šå¤šä¸ªä¸åŒçš„åª’ä½“æºã€‚ä¸ºæ­¤éœ€è¦ä»å…ƒç´ ä¸­åˆ é™¤<code>src</code>å±æ€§ï¼Œä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª<code>&lt;source&gt;</code>å…ƒç´ ä»£æ›¿ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;!-- åµŒå…¥è§†é¢‘ --&gt;
&lt;video id=&quot;myVideo&quot;&gt;
  &lt;source src=&quot;conference.webm&quot; type=&quot;video/webm; codecs=&#x27;vp8, vorbis&#x27;&quot; /&gt;
  &lt;source src=&quot;conference.ogv&quot; type=&quot;video/ogg; codecs=&#x27;theora, vorbis&#x27;&quot; /&gt;
  &lt;source src=&quot;conference.mpg&quot; /&gt;
  Video Player not available.
&lt;/video&gt;

&lt;!-- åµŒå…¥éŸ³é¢‘ --&gt;
&lt;audio id=&quot;myAudio&quot;&gt;
  &lt;source src=&quot;song.ogg&quot; type=&quot;audio/ogg&quot; /&gt;
  &lt;source src=&quot;song.mp3&quot; type=&quot;audio/mpeg&quot; /&gt;
  Audio Player not available.
&lt;/audio&gt;</code>
        </deckgo-highlight-code><p>è®¨è®ºä¸åŒéŸ³é¢‘å’Œè§†é¢‘çš„ç¼–è§£ç å™¨è¶…å‡ºäº†æœ¬ä¹¦èŒƒå›´ï¼Œä½†æµè§ˆå™¨æ”¯æŒçš„ç¼–è§£ç å™¨ç¡®å®å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› æ­¤æŒ‡å®šå¤šä¸ªæºæ–‡ä»¶é€šå¸¸æ˜¯å¿…é¡»çš„ã€‚</p><h2>å±æ€§</h2><p><code>&lt;video&gt;</code>å’Œ<code>&lt;audio&gt;</code>å…ƒç´ æä¾›äº†ç¨³å¥çš„ JavaScript æ¥å£ã€‚è¿™ä¸¤ä¸ªå…ƒç´ æœ‰å¾ˆå¤šå…±æœ‰å±æ€§ï¼Œå¯ä»¥ç”¨äºç¡®å®šåª’ä½“çš„å½“å‰çŠ¶æ€ã€‚</p><h2>äº‹ä»¶</h2><p>é™¤äº†æœ‰å¾ˆå¤šå±æ€§ï¼Œåª’ä½“å…ƒç´ è¿˜æœ‰å¾ˆå¤šäº‹ä»¶ã€‚è¿™äº›äº‹ä»¶ä¼šç›‘æ§ç”±äºåª’ä½“å›æ”¾æˆ–ç”¨æˆ·äº¤äº’å¯¼è‡´çš„ä¸åŒå±æ€§çš„å˜åŒ–ã€‚è¿™äº›äº‹ä»¶è¢«è®¾è®¡å¾—å°½å¯èƒ½å…·ä½“ï¼Œä»¥ä¾¿ Web å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨è¾ƒå°‘çš„ HTML å’Œ JavaScript åˆ›å»ºè‡ªå®šä¹‰çš„éŸ³é¢‘/è§†é¢‘æ’­æ”¾å™¨ï¼ˆè€Œä¸æ˜¯åˆ›å»ºæ–° Flash å½±ç‰‡ï¼‰ã€‚</p><h2>è‡ªå®šä¹‰åª’ä½“æ’­æ”¾å™¨</h2><p>ä½¿ç”¨<code>&lt;audio&gt;</code>å’Œ<code>&lt;video&gt;</code>çš„<code>play()</code>å’Œ<code>pause()</code>æ–¹æ³•ï¼Œå¯ä»¥æ‰‹åŠ¨æ§åˆ¶åª’ä½“æ–‡ä»¶çš„æ’­æ”¾ã€‚ç»¼åˆä½¿ç”¨å±æ€§ã€äº‹ä»¶å’Œè¿™äº›æ–¹æ³•ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºè‡ªå®šä¹‰çš„åª’ä½“æ’­æ”¾å™¨ã€‚ä¾‹å¦‚ä¸‹é¢ä¾‹å­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;div class=&quot;mediaplayer&quot;&gt;
  &lt;div class=&quot;video&quot;&gt;
    &lt;video
      id=&quot;player&quot;
      src=&quot;movie.mov&quot;
      poster=&quot;mymovie.jpg&quot;
      width=&quot;300&quot;
      height=&quot;200&quot;
    &gt;
      Video player not available.
    &lt;/video&gt;
  &lt;/div&gt;
  &lt;div class=&quot;controls&quot;&gt;
    &lt;input type=&quot;button&quot; value=&quot;Play&quot; id=&quot;video-btn&quot; /&gt;
    &lt;span id=&quot;curtime&quot;&gt;0&lt;/span&gt;/&lt;span id=&quot;duration&quot;&gt;0&lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;</code>
        </deckgo-highlight-code><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const player = document.getElementById(&#x27;player&#x27;)
const btn = document.getElementById(&#x27;video-btn&#x27;)
const curtime = document.getElementById(&#x27;curtime&#x27;)
const duration = document.getElementById(&#x27;duration&#x27;)

duration.innerHTML = player.duration

btn.addEventListener(&#x27;click&#x27;, event =&gt; {
  if (player.paused) {
    player.play()
    btn.value = &#x27;Pause&#x27;
  } else {
    player.pause()
    btn.value = &#x27;Play&#x27;
  }
})

setInterval(() =&gt; {
  curTime.innerHTML = player.currentTime
}, 250)</code>
        </deckgo-highlight-code><p>è¿™é‡Œçš„ JavaScript ä»£ç ç®€å•åœ°ä¸ºæŒ‰é’®æ·»åŠ äº†äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¯ä»¥æ ¹æ®å½“å‰çŠ¶æ€æ’­æ”¾å’Œæš‚åœè§†é¢‘ã€‚æ­¤å¤–ï¼Œè¿˜ç»™<code>&lt;video&gt;</code>å…ƒç´ çš„<code>load</code>äº‹ä»¶æ·»åŠ äº†äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä»¥ä¾¿æ˜¾ç¤ºè§†é¢‘çš„æ—¶é•¿ã€‚æœ€åé‡å¤çš„è®¡æ—¶å™¨ç”¨äºæ›´æ–°å½“å‰æ—¶é—´ã€‚é€šè¿‡ç›‘å¬æ›´å¤šäº‹ä»¶ä»¥åŠä½¿ç”¨æ›´å¤šå±æ€§ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•è¿™ä¸ªè‡ªå®šä¹‰çš„è§†é¢‘æ’­æ”¾å™¨ã€‚åŒæ ·çš„ä»£ç ä¹Ÿå¯ä»¥ç”¨äº<code>&lt;audio&gt;</code>å…ƒç´ ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„éŸ³é¢‘æ’­æ”¾å™¨ã€‚</p><h2>æ£€æµ‹ç¼–è§£ç å™¨</h2><p>å¦‚å‰æ‰€è¿°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ<code>&lt;video&gt;</code>å’Œ<code>&lt;audio&gt;</code>çš„æ‰€æœ‰ç¼–è§£ç å™¨ï¼Œè¿™é€šå¸¸æ„å‘³ç€å¿…é¡»æä¾›å¤šä¸ªåª’ä½“æºã€‚ä¸ºæ­¤ï¼Œä¹Ÿæœ‰ JavaScript API å¯ä»¥ç”¨æ¥æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒç»™å®šæ ¼å¼å’Œç¼–è§£ç å™¨ã€‚è¿™ä¸¤ä¸ªåª’ä½“å…ƒç´ éƒ½æœ‰ä¸€ä¸ªåä¸º<code>canPlayType()</code>çš„æ–¹æ³•ï¼Œæ”¹æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ ¼å¼/ç¼–è§£ç å™¨å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼š<code>&quot;probably&quot;</code>ã€<code>&quot;maybe&quot;</code>æˆ–<code>&quot;&quot;</code>ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå…¶ä¸­ç©ºå­—ç¬¦ä¸²å°±æ˜¯å‡å€¼ï¼Œæ„å‘³ç€å¯ä»¥åœ¨<code>if</code>è¯­å¥ä¸­åƒè¿™æ ·ä½¿ç”¨<code>canPlayType()</code>:</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">if (audio.canPlayType(&#x27;audio/mpeg&#x27;)) {
  // æ‰§è¡ŒæŸäº›æ“ä½œ
}</code>
        </deckgo-highlight-code><p><code>&quot;probably&quot;</code>å’Œ<code>&quot;maybe&quot;</code>éƒ½æ˜¯çœŸå€¼ï¼Œåœ¨<code>if</code>è¯­å¥çš„ä¸Šä¸‹æ–‡ä¸­å¯ä»¥è½¬å‹ä¸º<code>true</code>ã€‚</p><p>åœ¨åªç»™<code>canPlayType()</code>æä¾›ä¸€ä¸ª MIME ç±»å‹çš„æƒ…å†µä¸‹ï¼Œæœ€å¯èƒ½è¿”å›çš„å€¼æ˜¯<code>&quot;maybe&quot;</code>å’Œç©ºå­—ç¬¦ä¸²ã€‚è¿™æ˜¯å› ä¸ºæ–‡ä»¶å®é™…ä¸Šåªæ˜¯ä¸€ä¸ªåŒ…è£…éŸ³é¢‘å’Œè§†é¢‘æ•°æ®çš„å®¹å™¨ï¼Œè€ŒçœŸæ­£å†³å®šæ–‡ä»¶æ˜¯å¦å¯ä»¥æ’­æ”¾çš„æ˜¯ç¼–ç ã€‚åœ¨åŒæ—¶æä¾› MIME ç±»å‹å’Œç¼–è§£ç å™¨çš„æƒ…å†µä¸‹ï¼Œè¿”å›å€¼çš„å¯èƒ½æ€§ä¼šæé«˜åˆ°<code>probably</code>ã€‚</p><h2>éŸ³é¢‘ç±»å‹</h2><p><code>&lt;audio&gt;</code>å…ƒç´ è¿˜æœ‰ä¸€ä¸ªåä¸º<code>Audio</code>çš„åŸç”Ÿ JavaScript æ„é€ å‡½æ•°ï¼Œæ”¯æŒåœ¨ä»»ä½•æ—¶å€™æ’­æ”¾éŸ³é¢‘ã€‚<code>Audio</code>ç±»å‹å’Œ<code>Image</code>ç±»ä¼¼ï¼Œéƒ½æ˜¯ DOM å…ƒç´ çš„å¯¹ç­‰ä½“ï¼Œåªæ˜¯ä¸éœ€æ’å…¥æ–‡æ¡£å³å¯å·¥ä½œã€‚è¦é€šè¿‡<code>Audio</code>æ’­æ”¾éŸ³é¢‘ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹å¹¶ä¼ å…¥éŸ³é¢‘æºæ–‡ä»¶ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const audio = new Audio(&#x27;sound.mp3&#x27;)
EventUtil.addHandler(audio, &#x27;canplaythrough&#x27;, function (event) {
  audio.play()
})</code>
        </deckgo-highlight-code><p>åˆ›å»º<code>Audio</code>çš„æ–°å®ä¾‹å°±ä¼šä¸‹è½½æŒ‡å®šçš„æ–‡ä»¶ã€‚ä¸‹è½½å®Œæ¯•ä¹‹åï¼Œå¯ä»¥è°ƒç”¨<code>play()</code>æ¥æ’­æ”¾éŸ³é¢‘ã€‚åœ¨ iOS ä¸­è°ƒç”¨<code>play()</code>æ–¹æ³•ä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯·æ±‚ç”¨æˆ·æˆæƒæ’­æ”¾å£°éŸ³ã€‚ä¸ºäº†è¿ç»­æ’­æ”¾ï¼Œå¿…é¡»åœ¨<code>onfinish</code>äº‹ä»¶å¤„ç†ç¨‹åºä¸­ç«‹å³è°ƒç”¨<code>play()</code>ã€‚</p><h1>åŸç”Ÿæ‹–æ”¾</h1><p>IE4 æœ€æ—©åœ¨ç½‘é¡µä¸­ä¸º JavaScript å¼•å…¥äº†å¯¹æ‹–æ”¾åŠŸèƒ½çš„æ”¯æŒã€‚å½“æ—¶ï¼Œç½‘é¡µä¸­åªæœ‰ä¸¤æ ·ä¸œè¥¿å¯ä»¥è§¦å‘æ‹–æ”¾ï¼šå›¾ç‰‡å’Œæ–‡æœ¬ã€‚æ‹–åŠ¨å›¾ç‰‡å°±æ˜¯ç®€å•åœ°åœ¨å›¾ç‰‡ä¸ŠæŒ‰ä½é¼ æ ‡ä¸æ”¾ç„¶åç§»åŠ¨é¼ æ ‡ã€‚è€Œå¯¹äºæ–‡æœ¬ï¼Œå¿…é¡»å…ˆé€‰ä¸­ï¼Œç„¶åå†ä»¥åŒæ ·çš„æ–¹å¼æ‹–åŠ¨ã€‚åœ¨ IE4 ä¸­å”¯ä¸€æœ‰æ•ˆçš„æ”¾ç½®ç›®æ ‡æ˜¯æ–‡æœ¬æ¡†ã€‚IE5 æ‰©å±•äº†æ‹–æ”¾èƒ½åŠ›ï¼Œæ·»åŠ äº†æ–°çš„äº‹ä»¶ï¼Œè®©ç½‘é¡µä¸­å‡ ä¹ä¸€åˆ‡éƒ½å¯ä»¥æˆä¸ºæ”¾ç½®ç›®æ ‡ã€‚IE5.5 åˆè¿›ä¸€æ­¥ï¼Œå…è®¸å‡ ä¹ä¸€åˆ‡éƒ½å¯ä»¥æ‹–åŠ¨ï¼ˆIE6 ä¹Ÿæ”¯æŒï¼‰ã€‚<strong>HTML5 åœ¨ IE çš„æ‹–æ”¾å®ç°åŸºç¡€ä¸Šæ ‡å‡†åŒ–äº†æ‹–æ”¾åŠŸèƒ½ã€‚</strong>æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ ¹æ® HTML5 è§„èŒƒå®ç°äº†åŸç”Ÿçš„æ‹–æ”¾ã€‚</p><p>å…³äºæ‹–æ”¾æœ€æœ‰æ„æ€çš„å¯èƒ½å°±æ˜¯å¯ä»¥è·¨çª—æ ¼ã€è·¨æµè§ˆå™¨å®¹å™¨ï¼Œæœ‰æ—¶å€™ç”šè‡³å¯ä»¥è·¨åº”ç”¨ç¨‹åºæ‹–åŠ¨å…ƒç´ ã€‚æµè§ˆå™¨å¯¹æ‹–æ”¾çš„æ”¯æŒå¯ä»¥è®©æˆ‘ä»¬å®ç°è¿™äº›åŠŸèƒ½ã€‚</p><h2>æ‹–æ”¾äº‹ä»¶</h2><p>æ‹–æ”¾äº‹ä»¶å‡ ä¹å¯ä»¥è®©å¼€å‘è€…æ§åˆ¶æ‹–æ”¾æ“ä½œçš„æ–¹æ–¹é¢é¢ã€‚å…³é”®çš„éƒ¨åˆ†æ˜¯ç¡®å®šæ¯ä¸ªäº‹ä»¶æ˜¯åœ¨å“ªé‡Œè§¦å‘çš„ã€‚æœ‰çš„äº‹ä»¶åœ¨è¢«æ‹–æ”¾å…ƒç´ ä¸Šè§¦å‘ï¼Œæœ‰çš„äº‹ä»¶åˆ™åœ¨æ”¾ç½®ç›®æ ‡ä¸Šè§¦å‘ã€‚åœ¨æŸä¸ªå…ƒç´ è¢«æ‹–åŠ¨æ—¶ï¼Œä¼šï¼ˆæŒ‰é¡ºåºï¼‰è§¦å‘ä»¥ä¸‹äº‹ä»¶ï¼š</p><ul><li><code>dragstart</code></li><li><code>drag</code></li><li><code>dragend</code></li></ul><p>åœ¨æŒ‰ä½é¼ æ ‡é”®ä¸æ”¾å¹¶å¼€å§‹ç§»åŠ¨é¼ æ ‡çš„é‚£ä¸€åˆ»ï¼Œè¢«æ‹–åŠ¨å…ƒç´ ä¸Šè§¦å‘<code>dragstart</code>äº‹ä»¶ã€‚æ­¤æ—¶å…‰æ ‡ä¼šå˜æˆéæ”¾ç½®ç¬¦å·ï¼Œè¡¨ç¤ºå…ƒç´ ä¸èƒ½æ”¾åˆ°è‡ªèº«ä¸Šã€‚æ‹–åŠ¨å¼€å§‹æ—¶ï¼Œå¯ä»¥åœ¨<code>ondragstart</code>äº‹ä»¶å¤„ç†ç¨‹åºä¸­é€šè¿‡ JavaScript æ‰§è¡ŒæŸäº›æ“ä½œã€‚</p><p><code>dragstart</code>äº‹ä»¶è§¦å‘åï¼Œåªè¦ç›®æ ‡è¿˜è¢«æ‹–åŠ¨å°±ä¼šæŒç»­è§¦å‘<code>drag</code>äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶ç±»ä¼¼äº<code>mousemove</code>ï¼Œå³éšç€é¼ æ ‡ç§»åŠ¨è€Œä¸æ–­è§¦å‘ã€‚å½“æ‹–åŠ¨åœæ­¢æ—¶ï¼ˆæŠŠå…ƒç´ æ”¾åˆ°æœ‰æ•ˆæˆ–æ— æ•ˆçš„æ”¾ç½®ç›®æ ‡ä¸Šï¼‰ï¼Œä¼šè§¦å‘<code>dragend</code>äº‹ä»¶ã€‚</p><p>æ‰€æœ‰è¿™ 3 ä¸ªäº‹ä»¶çš„ç›®æ ‡éƒ½æ˜¯è¢«æ‹–åŠ¨çš„å…ƒç´ ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨åœ¨æ‹–åŠ¨å¼€å§‹åä¸ä¼šæ”¹å˜è¢«æ‹–åŠ¨å…ƒç´ çš„å¤–è§‚ï¼Œå› æ­¤æ˜¯å¦æ”¹å˜å¤–è§‚ç”±ä½ æ¥å†³å®šã€‚ä¸è¿‡ï¼Œå¤§å¤šæ•°æµè§ˆå™¨æ­¤æ—¶ä¼šåˆ›å»ºå…ƒç´ çš„ä¸€ä¸ªåŠé€æ˜å‰¯æœ¬ï¼Œå§‹ç»ˆè·Ÿéšåœ¨å…‰æ ‡ä¸‹æ–¹ã€‚åœ¨æŠŠå…ƒç´ æ‹–åŠ¨åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„æ”¾ç½®ç›®æ ‡ä¸Šï¼Œä¼šä¾æ¬¡è§¦å‘ä»¥ä¸‹äº‹ä»¶ï¼š</p><ul><li><code>dragenter</code></li><li><code>dragover</code></li><li><code>dragleave</code>æˆ–è€…<code>drop</code></li></ul><p>åªè¦ä¸€æŠŠå…ƒç´ æ‹–åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ä¸Šï¼Œ<code>dragenter</code>äº‹ä»¶ï¼ˆç±»ä¼¼äº<code>mouseover</code>äº‹ä»¶ï¼‰å°±ä¼šè§¦å‘ã€‚<code>dragenter</code>äº‹ä»¶è§¦å‘ä¹‹åï¼Œä¼šç«‹å³è§¦å‘<code>dragover</code>äº‹ä»¶ï¼Œå¹¶ä¸”å…ƒç´ åœ¨æ”¾ç½®ç›®æ ‡èŒƒå›´å†…è¢«æ‹–åŠ¨æœŸé—´æ­¤äº‹ä»¶ä¼šæŒç»­è§¦å‘ã€‚å½“å…ƒç´ è¢«æ‹–åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ä¹‹å¤–æ—¶ï¼Œ<code>dragover</code>äº‹ä»¶åœæ­¢è§¦å‘ï¼Œ<code>dragleave</code>äº‹ä»¶è§¦å‘ï¼ˆç±»ä¼¼äº<code>mouseout</code>äº‹ä»¶ï¼‰ã€‚å¦‚æœè¢«æ‹–åŠ¨å…ƒç´ è¢«æ”¾åˆ°äº†ç›®æ ‡ä¸Šï¼Œåˆ™ä¼šè§¦å‘<code>drop</code>äº‹ä»¶è€Œä¸æ˜¯<code>dragleave</code>äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶çš„ç›®çš„æ˜¯æ”¾ç½®ç›®æ ‡å…ƒç´ ã€‚</p><h2>è‡ªå®šä¹‰æ”¾ç½®ç›®æ ‡</h2><p>åœ¨æŠŠæŸä¸ªå…ƒç´ æ‹–åŠ¨åˆ°æ— æ•ˆæ”¾ç½®ç›®æ ‡ä¸Šæ—¶ï¼Œä¼šçœ‹åˆ°ä¸€ä¸ªç‰¹æ®Šå…‰æ ‡è¡¨ç¤ºä¸èƒ½æ”¾ä¸‹ã€‚å³ä½¿æ‰€æœ‰å…ƒç´ éƒ½æ”¯æŒæ”¾ç½®ç›®æ ‡äº‹ä»¶ï¼Œè¿™äº›å…ƒç´ é»˜è®¤æ˜¯ä¸å…è®¸æ”¾ç½®çš„ã€‚å¦‚æœæŠŠå…ƒç´ æ‹–åŠ¨åˆ°ä¸å…è®¸æ”¾ç½®çš„ç›®æ ‡ä¸Šï¼Œæ— è®ºç”¨æˆ·åŠ¨ä½œæ˜¯ä»€ä¹ˆéƒ½ä¸ä¼šè§¦å‘<code>drop</code>äº‹ä»¶ã€‚ä¸è¿‡ï¼Œé€šè¿‡è¦†ç›–<code>dragenter</code>å’Œ<code>dragover</code>äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥æŠŠä»»ä½•å…ƒç´ è½¬æ¢ä¸ºæœ‰æ•ˆçš„æ”¾ç½®ç›®æ ‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ª ID ä¸º<code>&quot;droptarget&quot;</code>çš„<code>&lt;div&gt;</code>å…ƒç´ ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªæ”¾ç½®ç›®æ ‡ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const droptarget = document.getElementById(&#x27;droptarget&#x27;)

droptarget.addEventListener(&#x27;dragover&#x27;, event =&gt; {
  event.preventDefault()
})

droptarget.addEventListener(&#x27;dragenter&#x27;, event =&gt; {
  event.preventDefault()
})</code>
        </deckgo-highlight-code><p>æ‰§è¡Œä¸Šé¢çš„ä»£ç åï¼ŒæŠŠå…ƒç´ æ‹–åŠ¨åˆ°è¿™ä¸ª<code>&lt;div&gt;</code>ä¸Šåº”è¯¥å¯ä»¥çœ‹åˆ°å…‰æ ‡å˜æˆäº†å…è®¸æ”¾ç½®çš„æ ·å­ã€‚å¦å¤–ï¼Œ<code>drop</code>äº‹ä»¶ä¹Ÿä¼šè§¦å‘ã€‚</p><p>åœ¨ Firefox ä¸­ï¼Œæ”¾ç½®äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¼èˆªåˆ°æ”¾åœ¨æ”¾ç½®ç›®æ ‡ä¸Šçš„ URLã€‚è¿™æ„å‘³ç€æŠŠå›¾ç‰‡æ‹–åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ä¸Šå¯¼è‡´é¡µé¢å¯¼èˆªåˆ°å›¾ç‰‡æ–‡ä»¶ï¼ŒæŠŠæ–‡æœ¬æ‹–åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ä¸Šä¼šå¯¼è‡´æ— æ•ˆ URL é”™è¯¯ã€‚ä¸ºé˜»æ­¢è¿™ä¸ªè¡Œä¸ºï¼Œåœ¨ Firefox ä¸­å¿…é¡»å–æ¶ˆ<code>drop</code>äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">droptarget.addEventListener(&#x27;drop&#x27;, event =&gt; {
  event.preventDefault()
})</code>
        </deckgo-highlight-code><h2><code>dataTransfer</code>å¯¹è±¡</h2><p>é™¤éæ•°æ®å—å½±å“ï¼Œå¦åˆ™ç®€å•çš„æ‹–æ”¾å¹¶æ²¡æœ‰å®é™…æ„ä¹‰ã€‚ä¸ºå®ç°æ‹–åŠ¨æ“ä½œä¸­çš„æ•°æ®ä¼ è¾“ï¼ŒIE5 åœ¨<code>event</code>å¯¹è±¡ä¸Šæš´éœ²äº†<code>dataTransfer</code>å¯¹è±¡ï¼Œç”¨äºä»è¢«æ‹–åŠ¨å…ƒç´ å‘æ”¾ç½®ç›®æ ‡ä¼ é€’å­—ç¬¦ä¸²æ•°æ®ã€‚å› ä¸ºè¿™ä¸ªå¯¹è±¡æ˜¯<code>event</code>çš„å±æ€§ï¼Œæ‰€ä»¥åœ¨æ‹–æ”¾äº‹ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åºå¤–éƒ¨æ— æ³•è®¿é—®<code>dataTransfer</code>ã€‚åœ¨äº‹ä»¶å¤„ç†ç¨‹åºå†…éƒ¨ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å®ç°æ‹–æ”¾åŠŸèƒ½ã€‚<code>dataTransfer</code>å¯¹è±¡çš„æ ‡å‡†åŒ–ç°åœ¨å·²ç»çº³å…¥äº† HTML5 è‰æ¡ˆã€‚</p><p><code>dataTransfer</code>å¯¹è±¡æœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š<code>getData()</code>å’Œ<code>setData()</code>ã€‚é¡¾åæ€ä¹‰ï¼Œ<code>getData()</code>ç”¨æ¥è·å–<code>setData()</code>å­˜å‚¨çš„å€¼ã€‚<code>setData()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä»¥åŠ<code>getData()</code>çš„å”¯ä¸€å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦è®¾ç½®çš„æ•°æ®ç±»å‹ï¼š<code>&quot;text&quot;</code>æˆ–<code>&quot;URL&quot;</code>ã€‚</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">event.dataTransfer.setData(&#x27;text&#x27;, &#x27;some text&#x27;)
const text = event.dataTransfer.getData(&#x27;text&#x27;)

event.dataTransfer.setData(&#x27;URL&#x27;, &#x27;http://www.wrox.com&#x27;)
const url = event.dataTransfer.getData(&#x27;URL&#x27;)</code>
        </deckgo-highlight-code><p>è™½ç„¶è¿™ä¸¤ç§æ•°æ®ç±»å‹æ˜¯ IE æœ€åˆå¼•å…¥çš„ï¼Œä½† HTML5 å·²ç»å°†å…¶æ‰©å±•ä¸ºå…è®¸ä»»ä½• MIME ç±»å‹ã€‚ä¸ºå‘åå…¼å®¹ï¼ŒHTML5 è¿˜ä¼šç»§ç»­æ”¯æŒ<code>&quot;text&quot;</code>å’Œ<code>&quot;URL&quot;</code>ï¼Œä½†æ˜¯å®ƒä»¬ä¼šåˆ†åˆ«æ˜ å°„åˆ°<code>&quot;text/plain&quot;</code>å’Œ<code>&quot;text/uri-list&quot;</code>ã€‚</p><p><code>dataTransfer</code>å¯¹è±¡å®é™…ä¸Šå¯ä»¥åŒ…å«æ¯ç§ MIME ç±»å‹çš„ä¸€ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åŒæ—¶ä¿å­˜æ–‡æœ¬å’Œ URLï¼Œä¸¤è€…ä¸ä¼šç›¸äº’è¦†ç›–ã€‚å­˜å‚¨åœ¨<code>dataTransfer</code>å¯¹è±¡ä¸­çš„æ•°æ®åªèƒ½åœ¨æ”¾ç½®äº‹ä»¶ä¸­è¯»å–ã€‚å¦‚æœæ²¡æœ‰åœ¨<code>ondrop</code>äº‹ä»¶å¤„ç†ç¨‹åºä¸­å–å¾—è¿™äº›æ•°æ®ï¼Œ<code>dataTransfer</code>å¯¹è±¡å°±ä¼šè¢«é”€æ¯ï¼Œæ•°æ®ä¹Ÿä¼šä¸¢å¤±ã€‚</p><p>åœ¨ä»æ–‡æœ¬æ¡†æ‹–åŠ¨å›¾ç‰‡æ—¶ï¼Œæµè§ˆå™¨ä¼šè°ƒç”¨<code>setData()</code>å¹¶æŠŠ URL å­˜å‚¨èµ·æ¥ã€‚å½“æ•°æ®è¢«æ”¾ç½®åœ¨ç›®æ ‡ä¸Šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>getData()</code>è·å–è¿™äº›æ•°æ®ã€‚å½“ç„¶ï¼Œå¯ä»¥åœ¨<code>dragstart</code>äº‹ä»¶ä¸­æ‰‹åŠ¨è°ƒç”¨<code>setData()</code>å­˜å‚¨è‡ªå®šä¹‰æ•°æ®ï¼Œä»¥ä¾¿å°†æ¥ä½¿ç”¨ã€‚</p><p>ä½œä¸ºæ–‡æœ¬çš„æ•°æ®å’Œä½œä¸º URL çš„æ•°æ®æœ‰ä¸€ä¸ªåŒºåˆ«ã€‚å½“æŠŠæ•°æ®ä½œä¸ºæ–‡æœ¬å­˜å‚¨æ—¶ï¼Œæ•°æ®ä¸ä¼šè¢«ç‰¹æ®Šå¯¹å¾…ã€‚è€Œå½“æŠŠæ•°æ®ä½œä¸º URL å­˜å‚¨ï¼Œæ•°æ®ä¼šè¢«ä½œä¸ºç½‘é¡µä¸­çš„ä¸€ä¸ªé“¾æ¥ï¼Œæ„å‘³ç€å¦‚æœæŠŠå®ƒæ”¾åˆ°å¦ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œæµè§ˆå™¨ä¼šå¯¼èˆªåˆ°è¯¥ URLã€‚</p><h2><code>dropEffect</code>å’Œ<code>effectAllowed</code></h2><p><code>dataTransfer</code>å¯¹è±¡ä¸ä»…å¯ä»¥ç”¨äºå®ç°ç®€å•çš„æ•°æ®ä¼ è¾“ï¼Œè¿˜å¯ä»¥ç”¨äºç¡®å®šèƒ½å¤Ÿå¯¹è¢«æ‹–åŠ¨å…ƒç´ å’Œæ”¾ç½®ç›®æ ‡æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚ä¸ºæ­¤å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå±æ€§ï¼š<code>dropEffect</code>å’Œ<code>effectAllowed</code>ã€‚</p><p><code>dropEffect</code>å±æ€§å¯ä»¥å‘Šè¯‰æµè§ˆå™¨å…è®¸å“ªç§æ”¾ç½®è¡Œä¸ºã€‚è¿™ä¸ªå±æ€§æœ‰ä»¥ä¸‹ 4 ç§å¯èƒ½çš„å€¼ã€‚</p><ul><li><code>&quot;none&quot;</code>ï¼šè¢«æ‹–åŠ¨å…ƒç´ ä¸èƒ½æ”¾åˆ°è¿™é‡Œã€‚è¿™æ˜¯é™¤æ–‡æœ¬æ¡†ä¹‹å¤–æ‰€æœ‰å…ƒç´ çš„é»˜è®¤å€¼ã€‚</li><li><code>&quot;move&quot;</code>ï¼šè¢«æ‹–åŠ¨å…ƒç´ åº”è¯¥ç§»åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ã€‚</li><li><code>&quot;copy&quot;</code>ï¼šè¢«æ‹–åŠ¨å…ƒç´ åº”è¯¥å¤åˆ¶åˆ°æ”¾ç½®ç›®æ ‡ã€‚</li><li><code>&quot;link&quot;</code>ï¼šè¡¨ç¤ºæ”¾ç½®ç›®æ ‡ä¼šå¯¼èˆªåˆ°è¢«æ‹–åŠ¨å…ƒç´ ï¼ˆä»…åœ¨å®ƒæ˜¯ URL çš„æƒ…å†µä¸‹ï¼‰ã€‚</li></ul><p>åœ¨æŠŠå…ƒç´ æ‹–åŠ¨åˆ°æ”¾ç½®ç›®æ ‡ä¸Šï¼Œä¸Šè¿°æ¯ç§å€¼éƒ½ä¼šå¯¼è‡´æ˜¾ç¤ºä¸€ç§ä¸åŒçš„å…‰æ ‡ã€‚ä¸è¿‡ï¼Œæ˜¯å¦å¯¼è‡´å…‰æ ‡ç¤ºæ„çš„åŠ¨ä½œè¿˜è¦å–å†³äºå¼€å‘è€…ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ²¡æœ‰ä»£ç å‚ä¸ï¼Œå°±ä¸ä¼šæœ‰ä»€ä¹ˆè‡ªåŠ¨ç§»åŠ¨ã€å¤åˆ¶æˆ–é“¾æ¥ã€‚å”¯ä¸€ä¸ç”¨è€ƒè™‘çš„å°±æ˜¯å…‰æ ‡è‡ªå·±ä¼šå˜ã€‚ä¸ºäº†ä½¿ç”¨<code>dropEffect</code>å±æ€§ï¼Œå¿…é¡»åœ¨æ”¾ç½®ç›®æ ‡çš„<code>ondragenter</code>äº‹ä»¶å¤„ç†ç¨‹åºä¸­è®¾ç½®å®ƒã€‚</p><p>é™¤éåŒæ—¶è®¾ç½®<code>effectAllowed</code>ï¼Œå¦åˆ™<code>dropEffect</code>å±æ€§ä¹Ÿæ²¡æœ‰ç”¨ã€‚<code>effectAllowed</code>å±æ€§è¡¨ç¤ºå¯¹è¢«æ‹–åŠ¨å…ƒç´ æ˜¯å¦å…è®¸<code>dropEffect</code>ã€‚</p><h2>å¯æ‹–åŠ¨èƒ½åŠ›</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå›¾ç‰‡ã€é“¾æ¥å’Œæ–‡æœ¬æ˜¯å¯æ‹–åŠ¨çš„ï¼Œè¿™æ„å‘³ç€æ— é¡»é¢å¤–ä»£ç ç”¨æˆ·ä¾¿å¯ä»¥æ‹–åŠ¨å®ƒä»¬ã€‚æ–‡æœ¬åªæœ‰åœ¨è¢«é€‰ä¸­åæ‰å¯ä»¥æ‹–åŠ¨ï¼Œè€Œå›¾ç‰‡å’Œé“¾æ¥åœ¨ä»»æ„æ—¶å€™éƒ½æ˜¯å¯ä»¥æ‹–åŠ¨çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è®©å…¶ä»–å…ƒç´ å˜å¾—å¯æ‹–åŠ¨ã€‚HTML5 åœ¨æ‰€æœ‰ HTML å…ƒç´ ä¸Šè§„å®šäº†ä¸€ä¸ª<code>draggable</code>å±æ€§ï¼Œè¡¨ç¤ºå…ƒç´ æ˜¯å¦å¯ä»¥æ‹–åŠ¨ã€‚å›¾ç‰‡å’Œé“¾æ¥çš„<code>draggable</code>å±æ€§è‡ªåŠ¨è¢«è®¾ç½®ä¸º<code>true</code>ï¼Œè€Œå…¶ä»–æ‰€æœ‰æ­¤å±æ€§çš„é»˜è®¤å€¼ä¸º<code>false</code>ã€‚å¦‚æœæƒ³è®©å…¶ä»–å…ƒç´ å¯ä»¥æ‹–åŠ¨ï¼Œæˆ–è€…ä¸å…è®¸å›¾ç‰‡å’Œé“¾æ¥è¢«æ‹–åŠ¨ï¼Œéƒ½å¯ä»¥è®¾ç½®è¿™ä¸ªå±æ€§ã€‚ä¾‹å¦‚ï¼š</p><deckgo-highlight-code language="html" theme="one-dark">
          <code slot="code">&lt;!-- ç¦æ­¢æ‹–åŠ¨å›¾ç‰‡ --&gt;
&lt;img src=&quot;simle.gif&quot; draggable=&quot;false&quot; alt=&quot;Smiley face&quot; /&gt;
&lt;!-- è®©å…ƒç´ å¯ä»¥æ‹–åŠ¨ --&gt;
&lt;div draggable=&quot;true&quot;&gt;...&lt;/div&gt;</code>
        </deckgo-highlight-code><h2>å…¶ä»–æˆå‘˜</h2><p>HTML5 è§„èŒƒè¿˜ä¸º<code>dataTransfer</code>å¯¹è±¡å®šä¹‰äº†ä¸‹åˆ—æ–¹æ³•ã€‚</p><ul><li><code>addElement(element)</code>ï¼šä¸ºæ‹–åŠ¨æ“ä½œæ·»åŠ å…ƒç´ ã€‚è¿™çº¯ç²¹æ˜¯ä¸ºäº†ä¼ è¾“æ•°æ®ï¼Œä¸ä¼šå½±å“æ‹–åŠ¨æ“ä½œçš„å¤–è§‚ã€‚åœ¨æœ¬ä¹¦å†™ä½œæ—¶ï¼Œè¿˜æ²¡æœ‰æµè§ˆå™¨å®ç°è¿™ä¸ªæ–¹æ³•ã€‚</li><li><code>clearData(format)</code>ï¼šæ¸…é™¤ä»¥ç‰¹å®šæ ¼å¼å­˜å‚¨çš„æ•°æ®ã€‚</li><li><code>setDragImage(element, x, y)</code>ï¼šå…è®¸æŒ‡å®šæ‹–åŠ¨å‘ç”Ÿæ—¶æ˜¾ç¤ºåœ¨å…‰æ ‡ä¸‹é¢çš„å›¾ç‰‡ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ 3 ä¸ªå‚æ•°ï¼šè¦æ˜¾ç¤ºçš„ HTML å…ƒç´ ä»¥åŠå…‰æ ‡ä½ç½®çš„å›¾ç‰‡ä¸Šçš„ x å’Œ y åæ ‡ã€‚è¿™é‡Œçš„ HTML å…ƒç´ å¯ä»¥æ—¶ä¸€å¼ å›¾ç‰‡ï¼Œæ­¤æ—¶æ˜¾ç¤ºå›¾ç‰‡ï¼›ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä»»ä½•å…ƒç´ ï¼Œæ­¤æ—¶æ˜¾ç¤ºæ¸²æŸ“åçš„å…ƒç´ ã€‚</li><li><code>types</code>ï¼šå½“å‰å­˜å‚¨çš„æ•°æ®ç±»å‹åˆ—è¡¨ã€‚è¿™ä¸ªé›†åˆç±»ä¼¼æ•°ç»„ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼ä¿å­˜æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚<code>&quot;text&quot;</code>ã€‚</li></ul><h1>Page Visibility API</h1><p>Web å¼€å‘ä¸­ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜æ˜¯å¼€å‘è€…ä¸çŸ¥é“ç”¨æˆ·ä»€ä¹ˆæ—¶å€™çœŸæ­£åœ¨ä½¿ç”¨é¡µé¢ã€‚å¦‚æœé¡µé¢è¢«æœ€å°åŒ–æˆ–éšè—åœ¨å…¶ä»–æ ‡ç­¾é¡µçš„åé¢ï¼Œé‚£ä¹ˆè½®è¯¢æœåŠ¡å™¨æˆ–æ›´æ–°åŠ¨ç”»ç­‰åŠŸèƒ½å¯èƒ½å°±æ²¡å¿…è¦äº†ã€‚Page Visibility API æ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›é¡µé¢å¯¹ç”¨æˆ·æ˜¯å¦å¯è§çš„ä¿¡æ¯ã€‚</p><p>è¿™ä¸ª API æœ¬èº«éå¸¸ç®€å•ï¼Œç”± 3 éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><p>é¡µé¢åœ¨åå°æ ‡ç­¾é¡µæˆ–æµè§ˆå™¨ä¸­æœ€å°åŒ–äº†ã€‚</p><ul><li><p>é¡µé¢åœ¨å‰å°æ ‡ç­¾é¡µä¸­ã€‚</p></li><li><p>å®é™…é¡µé¢éšè—äº†ï¼Œä½†å¯¹é¡µé¢çš„é¢„è§ˆæ˜¯å¯è§ã€‚</p></li><li><p>é¡µé¢åœ¨å±å¹•å¤–é¢æ¸²æŸ“ã€‚</p></li></ul></li><li><p><code>visibilitychange</code>äº‹ä»¶ï¼Œè¯¥äº‹ä»¶ä¼šåœ¨æ–‡æ¡£ä¸­ä»éšè—å˜ä¸ºå¯è§ï¼ˆæˆ–åä¹‹ï¼‰æ—¶è§¦å‘ã€‚</p></li><li><p><code>document.hidden</code>å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºé¡µé¢æ˜¯å¦éšè—ã€‚è¿™å¯èƒ½æ„å‘³ç€é¡µé¢åœ¨åå°æ ‡ç­¾é¡µæˆ–æµè§ˆå™¨ä¸­è¢«æœ€å°åŒ–äº†ã€‚è¿™ä¸ªå€¼æ—¶ä¸ºäº†å‘åå…¼å®¹æ‰ç»§ç»­è¢«æµè§ˆå™¨æ”¯æŒçš„ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨<code>document.visibilityState</code>æ£€æµ‹é¡µé¢å¯è§æ€§ã€‚</p></li></ul><p>æƒ³è¦åœ¨é¡µé¢ä»å¯è§å˜ä¸ºéšè—æˆ–ä»éšè—å˜ä¸ºå¯è§æ—¶å¾—åˆ°é€šçŸ¥ï¼Œéœ€è¦ç›‘å¬<code>visibilitychange</code>äº‹ä»¶ã€‚<code>document.visibilityState</code>çš„å€¼æ˜¯ä»¥ä¸‹ä¸‰ä¸ªå­—ç¬¦ä¸²ä¹‹ä¸€ï¼š</p><ul><li><code>&quot;hidden&quot;</code></li><li><code>&quot;visible&quot;</code></li><li><code>&quot;pretender&quot;</code></li></ul><h1>Streams API</h1><p>Streams API æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªç®€å•åˆåŸºç¡€çš„é—®é¢˜è€Œç”Ÿçš„ï¼šWeb åº”ç”¨å¦‚ä½•æ¶ˆè´¹æœ‰åºçš„å°ä¿¡æ¯å—è€Œä¸æ˜¯å¤§å—ä¿¡æ¯ï¼Ÿè¿™ç§èƒ½åŠ›ä¸»è¦æœ‰ä¸¤ç§åº”ç”¨åœºæ™¯ã€‚</p><ul><li>å¤§å—æ•°æ®å¯èƒ½ä¸ä¼šä¸€æ¬¡æ€§éƒ½å¯ç”¨ã€‚ç½‘ç»œè¯·æ±‚æ˜¯ä¸€ä¸ªå…¸å‹ä¾‹å­ã€‚ç½‘ç»œè´Ÿè½½æ˜¯ä»¥è¿ç»­ä¿¡æ¯åŒ…å½¢å¼äº¤ä»˜çš„ï¼Œè€Œæµå¼å¤„ç†å¯ä»¥è®©ç”¨ç”¨åœ¨æ•°æ®ä¸€åˆ°è¾¾å°±èƒ½ä½¿ç”¨ï¼Œè€Œä¸å¿…ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åŠ è½½å®Œæ¯•ã€‚</li><li>å¤§å—æ•°æ®å¯èƒ½éœ€è¦åˆ†å°éƒ¨åˆ†å¤„ç†ã€‚è§†é¢‘å¤„ç†ã€æ•°æ®å‹ç¼©ã€å›¾åƒç¼–ç å’Œ JSON è§£æéƒ½æ˜¯å¯ä»¥åˆ†æˆå°éƒ¨åˆ†è¿›è¡Œå¤„ç†ï¼Œè€Œä¸å¿…ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åœ¨å†…å­˜ä¸­æ—¶å†å¤„ç†çš„ä¾‹å­ã€‚</li></ul><p>åé¢è®¨è®ºç½‘ç»œè¯·æ±‚å’Œè¿œç¨‹èµ„æºæ—¶ä¼šä»‹ç» Streams API åœ¨<code>fetch()</code>ä¸­çš„åº”ç”¨ï¼Œä¸è¿‡ Streams API æœ¬èº«æ˜¯é€šç”¨çš„ã€‚å®ç° Observable æ¥å£çš„ JavaScript åº“å…±äº«äº†å¾ˆå¤šæµçš„åŸºç¡€æ¦‚å¿µã€‚</p><blockquote><p>è™½ç„¶ Fetch API å·²ç»å¾—åˆ°æ‰€æœ‰ä¸»æµæµè§ˆå™¨æ”¯æŒï¼Œä½† Streams API åˆ™æ²¡æœ‰é‚£ä¹ˆå¾—åˆ°æ”¯æŒã€‚</p></blockquote><h2>ç†è§£æµ</h2><p>æåˆ°æµï¼Œå¯ä»¥æŠŠæ•°æ®æƒ³è±¡æˆæŸç§é€šè¿‡ç®¡é“è¾“é€çš„æ¶²ä½“ã€‚JavaScript ä¸­çš„æµå€Ÿç”¨äº†ç®¡é“ç›¸å…³çš„æ¦‚å¿µï¼Œå› ä¸ºåŸç†æ˜¯æƒ³é€šçš„ã€‚æ ¹æ®è§„èŒƒï¼Œâ€œè¿™äº› API å®é™…æ˜¯ä¸ºæ˜ å°„ä½çº§ I/O åŸè¯­è€Œè®¾è®¡ï¼ŒåŒ…æ‹¬é€‚å½“æ—¶å€™å¯¹å­—èŠ‚æµçš„è§„èŒƒåŒ–â€ã€‚Stream API ç›´æ¥è§£å†³çš„é—®é¢˜æ˜¯å¤„ç†ç½‘ç»œè¯·æ±‚å’Œè¯»å†™ç£ç›˜ã€‚</p><p>Stream API å®šä¹‰äº†ä¸‰ç§æµã€‚</p><ul><li><strong>å¯è¯»æµ</strong>ï¼šå¯ä»¥é€šè¿‡æŸä¸ªå…¬å…±æ¥å£è¯»å–æ•°æ®å—çš„æµã€‚æ•°æ®åœ¨å†…éƒ¨ä»åº•å±‚æºè¿›å…¥æµï¼Œç„¶åç”±<strong>æ¶ˆè´¹è€…</strong>è¿›è¡Œå¤„ç†ã€‚</li><li><strong>å¯å†™æµ</strong>ï¼šå¯ä»¥é€šè¿‡æŸä¸ªå…¬å…±æ¥å£å†™å…¥æ•°æ®å—çš„æµã€‚<strong>ç”Ÿäº§è€…</strong>å°†æ•°æ®å†™å…¥æµï¼Œæ•°æ®åœ¨å†…éƒ¨ä¼ å…¥åº•å±‚æ•°æ®æ§½ï¼ˆsinkï¼‰ã€‚</li><li><strong>è½¬æ¢æµ</strong>ï¼šç”±ä¸¤ç§æµç»„æˆï¼Œå¯å†™æµç”¨äºæ¥æ”¶æ•°æ®ï¼ˆå¯å†™ç«¯ï¼‰ï¼Œå¯è¯»æµç”¨äºè¾“å‡ºæ•°æ®ï¼ˆå¯è¯»ç«¯ï¼‰ã€‚è¿™ä¸¤ä¸ªæµä¹‹é—´æ˜¯<strong>è½¬æ¢ç¨‹åº</strong>ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ£€æŸ¥å’Œä¿®æ”¹æµå†…å®¹ã€‚</li></ul><h3>å—ã€å†…éƒ¨é˜Ÿåˆ—å’Œåå‹</h3><p>æµçš„åŸºæœ¬å•ä½æ˜¯<strong>å—</strong>ï¼ˆchunkï¼‰ã€‚å—å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œä½†é€šå¸¸æ˜¯å®šå‹æ•°ç»„ã€‚æ¯ä¸ªå—éƒ½æ˜¯ç¦»æ•£çš„æµç‰‡æ®µï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥å¤„ç†ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå—ä¸æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿä¸ä¸€å®šæŒ‰å›ºå®šé—´éš”åˆ°è¾¾ã€‚åœ¨ç†æƒ³çš„æµå½“ä¸­ï¼Œå—çš„å¤§å°é€šå¸¸è¿‘ä¼¼ç›¸åŒï¼Œåˆ°è¾¾é—´éš”ä¹Ÿè¿‘ä¼¼ç›¸ç­‰ã€‚ä¸è¿‡å¥½çš„æµå®ç°éœ€è¦è€ƒè™‘è¾¹ç•Œæƒ…å†µã€‚</p><p>å‰é¢æåˆ°çš„å„ç§ç±»å‹çš„æµéƒ½æœ‰å…¥å£å’Œå‡ºå£çš„æ¦‚å¿µã€‚æœ‰æ—¶å€™ï¼Œç”±äºæ•°æ®è¿›å‡ºçš„é€Ÿç‡ä¸åŒï¼Œå¯èƒ½ä¼šå‡ºç°ä¸åŒ¹é…çš„æƒ…å†µã€‚ä¸ºæ­¤æµå¹³è¡¡å¯èƒ½å‡ºç°å¦‚ä¸‹ä¸‰ç§æƒ…å½¢ï¼š</p><ul><li>æµå‡ºå£å¤„ç†æ•°æ®çš„é€Ÿåº¦æ¯”å…¥å£æä¾›æ•°æ®çš„é€Ÿåº¦å¿«ã€‚æµå‡ºå£ç»å¸¸ç©ºé—²ï¼ˆå¯èƒ½æ„å‘³ç€æµå…¥å£æ•ˆç‡è¾ƒä½ï¼‰ï¼Œä½†åªä¼šæµªè´¹ä¸€ç‚¹å†…å­˜æˆ–è®¡ç®—èµ„æºï¼Œå› æ­¤è¿™ç§æµçš„ä¸å¹³è¡¡æ˜¯å¯ä»¥æ¥å—çš„ã€‚</li><li>æµå…¥å’Œæµå‡ºå‡è¡¡ï¼Œè¿™æ˜¯ç†æƒ³çŠ¶æ€ã€‚</li><li>æµå…¥å£æä¾›æ•°æ®çš„é€Ÿåº¦æ¯”å‡ºå£å¤„ç†æ•°æ®çš„é€Ÿåº¦å¿«ã€‚è¿™ç§æµä¸å¹³è¡¡æ˜¯å›ºæœ‰çš„é—®é¢˜ã€‚æ­¤æ—¶ä¸€å®šä¼šåœ¨æŸä¸ªåœ°æ–¹å‡ºç°æ•°æ®ç§¯å‹ï¼Œæµå¿…é¡»ç›¸åº”åšå‡ºå¤„ç†ã€‚</li></ul><p><strong>æµä¸å¹³è¡¡</strong>æ˜¯å¸¸è§é—®é¢˜ï¼Œä½†æµä¹Ÿæä¾›äº†è§£å†³è¿™ä¸ªé—®é¢˜çš„å·¥å…·ã€‚æ‰€æœ‰æµéƒ½ä¼šä¸ºè¿›å…¥æµä½†å°šæœªç¦»å¼€æµçš„å—æä¾›ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ã€‚å¯¹äºå‡è¡¡æµï¼Œè¿™ä¸ªå†…éƒ¨é˜Ÿåˆ—ä¸­ä¼šæœ‰é›¶ä¸ªæˆ–å°‘é‡æ’é˜Ÿçš„å—ï¼Œå› ä¸ºæµå‡ºå£å—å‡ºåˆ—çš„é€Ÿåº¦ä¸æµå…¥å£å—å…¥åˆ—çš„é€Ÿåº¦è¿‘ä¼¼ç›¸ç­‰ã€‚è¿™ç§æµçš„å†…éƒ¨é˜Ÿåˆ—æ‰€å ç”¨çš„å†…å­˜ç›¸å¯¹æ¯”è¾ƒå°ã€‚</p><p>å¦‚æœå—å…¥åˆ—é€Ÿåº¦å¿«äºå‡ºåˆ—é€Ÿåº¦ï¼Œåˆ™å†…éƒ¨é˜Ÿåˆ—ä¼šä¸æ–­å¢å¤§ã€‚æµä¸èƒ½å…è®¸å…¶å†…éƒ¨é˜Ÿåˆ—æ— é™å¢å¤§ï¼Œå› æ­¤å®ƒä¼šä½¿ç”¨<strong>åå‹</strong>ï¼ˆbackpressureï¼‰é€šçŸ¥æµå…¥å£åœæ­¢å‘é€æ•°æ®ï¼Œç›´åˆ°é˜Ÿåˆ—å¤§å°é™åˆ°æŸä¸ªæ—¢å®šçš„é˜ˆå€¼ä¹‹ä¸‹ã€‚è¿™ä¸ªé˜ˆå€¼ç”±æ’åˆ—ç­–ç•¥å†³å®šï¼Œè¿™ä¸ªç­–ç•¥å®šä¹‰äº†å†…éƒ¨é˜Ÿåˆ—å¯ä»¥å ç”¨çš„æœ€å¤§å†…å­˜ï¼Œå³<strong>é«˜æ°´ä½çº¿</strong>ï¼ˆhigh water markï¼‰ã€‚</p><h2>å¯è¯»æµ</h2><p>å¯è¯»æµæ˜¯å¯¹åº•å±‚æ•°æ®æºçš„å°è£…ã€‚åº•å±‚æ•°æ®æºå¯ä»¥å°†æ•°æ®å¡«å……åˆ°æµä¸­ï¼Œå…è®¸æ¶ˆè´¹è€…é€šè¿‡æµçš„å…¬å…±æ¥å£è¯»å–æ•°æ®ã€‚</p><h3><code>ReadableStreamDefaultController</code></h3><p>çœ‹ä¸‹é¢çš„ç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒæ¯ 1000 æ¯«ç§’å°±ä¼šç”Ÿæˆä¸€ä¸ªé€’å¢çš„æ•´æ•°ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}</code>
        </deckgo-highlight-code><p>è¿™ä¸ªç”Ÿæˆå™¨çš„å€¼å¯ä»¥é€šè¿‡å¯è¯»æµçš„æ§åˆ¶å™¨ä¼ å…¥å¯è¯»æµã€‚è®¿é—®è¿™ä¸ªæ§åˆ¶å™¨æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åˆ›å»º<code>ReadableStream</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªæ„é€ å‡½æ•°çš„<code>underlyingSource</code>å‚æ•°ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ä¸­å®šä¹‰<code>start()</code>æ–¹æ³•ï¼Œç„¶ååœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨ä½œä¸ºå‚æ•°ä¼ å…¥çš„<code>controller</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ§åˆ¶å™¨å‚æ•°æ˜¯<code>ReadableStreamDefaultController</code>çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const readableStream = new ReadableStream({
  start(controller) {
    console.log(controller) // ReadableStreamDefaultController {}
  },
})</code>
        </deckgo-highlight-code><p>è°ƒç”¨æ§åˆ¶å™¨çš„<code>enqueue()</code>æ–¹æ³•å¯ä»¥æŠŠå€¼ä¼ å…¥æ§åˆ¶å™¨ã€‚æ‰€æœ‰å€¼éƒ½ä¼ å®Œä¹‹åä½¿ç”¨<code>close()</code>å…³é—­æµï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const readableStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of ints()) {
      controller.enqueue(chunk)
    }
    controller.close()
  },
})</code>
        </deckgo-highlight-code><blockquote><p><code>for await ... of</code><strong>è¯­å¥</strong>åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œè¯¥å¾ªç¯éå†å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ä»¥åŠåŒæ­¥å¯è¿­ä»£å¯¹è±¡ï¼ŒåŒ…æ‹¬ï¼šå†…ç½®çš„<code>String</code>ã€<code>Array</code>ï¼Œç±»æ•°ç»„å¯¹è±¡ï¼ˆä¾‹å¦‚<code>arguments</code>æˆ–<code>NodeList</code>ï¼‰ï¼Œ<code>TypedArray</code>ï¼Œ<code>Map</code>ï¼Œ<code>Set</code>å’Œç”¨æˆ·å®šä¹‰çš„å¼‚æ­¥/åŒæ­¥è¿­ä»£å™¨ã€‚å®ƒä½¿ç”¨å¯¹è±¡çš„æ¯ä¸ªä¸åŒå±æ€§çš„å€¼è°ƒç”¨è¦æ‰§è¡Œçš„è¯­å¥æ¥è°ƒç”¨è‡ªå®šä¹‰è¿­ä»£é’©å­ã€‚</p><p>ç±»ä¼¼äº<code>await</code>è¿ç®—ç¬¦ä¸€æ ·ï¼Œè¯¥è¯­å¥åªèƒ½åœ¨ä¸€ä¸ª<code>async function</code>å†…éƒ¨ä½¿ç”¨ã€‚</p></blockquote><h3><code>ReadableStreamDefaultReader</code></h3><p>å‰é¢çš„ä¾‹å­æŠŠ 5 ä¸ªå€¼åŠ å…¥äº†æµçš„é˜Ÿåˆ—ï¼Œä½†æ²¡æœ‰æŠŠå®ƒä»¬ä»é˜Ÿåˆ—ä¸­è¯»å‡ºæ¥ã€‚ä¸ºæ­¤ï¼Œéœ€è¦ä¸€ä¸ª<code>ReadableStreamDefaultReader</code>çš„å®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ä»¥é€šè¿‡æµçš„<code>getReader()</code>æ–¹æ³•è·å–ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¼šè·å¾—æµçš„é”ï¼Œä¿è¯åªæœ‰è¿™ä¸ªè¯»å–å™¨å¯ä»¥ä»æµä¸­è¯»å–å€¼ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const readableStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of ints()) {
      constroller.enqueue(chunk)
    }
    controller.close()
  },
})

console.log(readableStream.locked) // false
const readableStreamDefaultReader = readableStream.getReader()
console.log(readableStream.locked) // true</code>
        </deckgo-highlight-code><p>æ¶ˆè´¹è€…ä½¿ç”¨è¿™ä¸ªè¯»å–å™¨å®ä¾‹çš„<code>read()</code>æ–¹æ³•å¯ä»¥è¯»å‡ºå€¼ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const readableStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of ints()) {
      controller.enqueue(chunk)
    }
    controller.close()
  },
})

console.log(readableStream.locked) // false
const readableStreamDefaultReader = readableStream.getReader()
console.log(readableStream.locked) // true
;(async function () {
  while (true) {
    const { done, value } = await readableStreamDefaultReader.read()
    if (done) {
      break
    } else {
      console.log(value)
    }
  }
})()

// 0
// 1
// 2
// 3
// 4</code>
        </deckgo-highlight-code><h2>å¯å†™æµ</h2><p>å¯å†™æµæ˜¯åº•å±‚æ•°æ®æ§½çš„å°è£…ã€‚åº•å±‚æ•°æ®æ§½å¤„ç†é€šè¿‡çš„æµçš„å…¬å…±æ¥å£å†™å…¥çš„æ•°æ®ã€‚</p><h3>åˆ›å»º<code>WritableStream</code></h3><p>è¿˜æ˜¯ä¸Šé¢çš„ç”Ÿæˆå™¨:</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}</code>
        </deckgo-highlight-code><p>è¿™äº›å€¼é€šè¿‡å¯å†™æµçš„å…¬å…±æ¥å£å¯ä»¥å†™å…¥æµã€‚åœ¨ä¼ ç»™<code>WritableStream</code>æ„é€ å‡½æ•°çš„<code>underlyingSink</code>å‚æ•°ä¸­ï¼Œé€šè¿‡å®ç°<code>write()</code>æ–¹æ³•å¯ä»¥è·å¾—å†™å…¥çš„æ•°æ®ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const readableStream = new WritableStream({
  write(value) {
    console.log(value)
  },
})</code>
        </deckgo-highlight-code><h3><code>WritableStreamDefaultWriter</code></h3><p>è¦æŠŠè·å¾—çš„æ•°æ®å†™å…¥æµï¼Œå¯ä»¥é€šè¿‡æµçš„<code>getWriter()</code>æ–¹æ³•è·å–<code>WritableStreamDefaultWriter</code>çš„å®ä¾‹ã€‚è¿™æ ·ä¼šè·å¾—æµçš„é”ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªå†™å…¥å™¨å¯ä»¥å‘æµä¸­å†™å…¥æ•°æ®ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const writableStream = new WritableStream({
  write(value) {
    console.log(value)
  },
})

console.log(writableStream.locked) // false
const writableStreamDefaultWriter = writableStream.getWriter()
console.log(writableStream.locked) // true</code>
        </deckgo-highlight-code><p>åœ¨å‘æµä¸­å†™å…¥æ•°æ®ä¹‹å‰ï¼Œç”Ÿäº§è€…å¿…é¡»ç¡®ä¿å†™å…¥å™¨å¯ä»¥æ¥æ”¶å€¼ã€‚<code>writableStreamDefaultWriter.ready</code>è¿”å›ä¸€ä¸ªæœŸçº¦ï¼Œæ­¤æœŸçº¦ä¼šåœ¨èƒ½å¤Ÿå‘æµä¸­å†™å…¥æ•°æ®æ—¶è§£å†³ã€‚ç„¶åå°±å¯ä»¥æŠŠå€¼ä¼ ç»™<code>writableStreamDefaultWriter.write()</code>æ–¹æ³•ã€‚å†™å…¥æ•°æ®ä¹‹åï¼Œè°ƒç”¨<code>writableStreamDefaultWriter.close()</code>å°†æµå…³é—­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const writableStream = new WritableStream({
  write(value) {
    console.log(value)
  },
})

console.log(writableStream.locked) // false
const writableStreamDefaultWriter = writableStream.getWriter()
console.log(writableStream.locked) // true
;(async function () {
  for await (let chunk of ints()) {
    await writableStreamDefaultWriter.ready
    writableStreamDeafult.write(chunk)
  }

  writableStreamDefaultWriter.close()
})()</code>
        </deckgo-highlight-code><h2>è½¬æ¢æµ</h2><p>è½¬æ¢æµç”¨æ¥ç»„åˆå¯è¯»æµå’Œå¯å†™æµã€‚æ•°æ®å—åœ¨ä¸¤ä¸ªæµä¹‹é—´çš„è½¬æ¢æ˜¯é€šè¿‡<code>transform()</code>æ–¹æ³•å®Œæˆçš„ã€‚ä¸‹é¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª<code>TransformStream</code>çš„å®ä¾‹ï¼Œé€šè¿‡<code>transform()</code>æ–¹æ³•å°†æ¯ä¸ªå€¼ç¿»å€ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const { writable, readable } = new TransformStream({
  transform(chunk, controller) {
    controller.enqueue(chunk * 2)
  },
})</code>
        </deckgo-highlight-code><p>å‘è½¬æ¢æµçš„ç»„ä»¶æµï¼ˆå¯è¯»æµå’Œå¯å†™æµï¼‰ä¼ å…¥æ•°æ®å’Œä»ä¸­è·å–æ•°æ®ï¼Œä¸æœ¬ç« å‰é¢ä»‹ç»çš„æ–¹æ³•ç›¸åŒï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const { writable, readable } = new TransformStream({
  transform(chunk, controller) {
    controller.enqueue(chunk * 2)
  },
})

const readableStreamDefaultReader = readable.getReader()
const writableStreamDefaultWriter = writable.getWriter()

// æ¶ˆè´¹è€…
;(async function () {
  while (true) {
    const { done, value } = await readableStreamDefaultReader.read()
    if (done) {
      break
    } else {
      console.log(value)
    }
  }
})()
;(async function () {
  for await (let chunk of ints()) {
    await writableStreamDefaultWriter.ready
    writableStreamDefaultWriter.write(chunk)
  }

  writableStreamDefaultWriter.close()
})()</code>
        </deckgo-highlight-code><h2>é€šè¿‡ç®¡é“è¿æ¥æµ</h2><p>æµå¯ä»¥é€šè¿‡ç®¡é“è¿æ¥æˆä¸€ä¸²ã€‚æœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯ä½¿ç”¨<code>pipeThrough()</code>æ–¹æ³•æŠŠ<code>ReadableStream</code>æ¥å…¥<code>TransformStream</code>ã€‚ä»å†…éƒ¨çœ‹ï¼Œ<code>ReadableStream</code>å…ˆæŠŠè‡ªå·±çš„å€¼ä¼ ç»™<code>TransformStream</code>å†…éƒ¨çš„<code>WritableStream</code>ï¼Œç„¶åæ‰§è¡Œè½¬æ¢ï¼Œæ¥ç€è½¬æ¢åçš„å€¼åˆåœ¨æ–°çš„<code>ReadableStream</code>ä¸Šå‡ºç°ã€‚ä¸‹é¢çš„ä¾‹å­å°†ä¸€ä¸ªæ•´æ•°çš„<code>ReadableStream</code>ä¼ å…¥<code>TransformStream</code>ï¼Œ<code>TransformStream</code>å¯¹æ¯ä¸ªå€¼åšåŠ å€å¤„ç†ã€‚</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const integerStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of ints()) {
      controller.enqueue(chunk)
    }
  }

  controller.close()
})

const doublingStream = new TransformStream({
  transform(chunk, controller) {
    controller.enqueue(chunk * 2)
  }
})

// é€šè¿‡ç®¡é“è¿æ¥æµ
const pipedStream = integerStream.pipeThrough(doublingStream)

// ä»è¿æ¥æµçš„è¾“å‡ºè·å¾—è¯»å–å™¨
const pipedStreamDefaultReader = pipedStream.getReader()

// æ¶ˆè´¹è€…
;(async function() {
  while (true) {
    const { done, value } = await pipedStreamDefaultReader.read()

    if (done) {
      break
    } else {
      console.log(value)
    }
  }
})()

// 0
// 2
// 4
// 6
// 8</code>
        </deckgo-highlight-code><p>å¦å¤–ä½¿ç”¨<code>pipeTo()</code>æ–¹æ³•ä¹Ÿå¯ä»¥å°†<code>ReadableStream</code>è¿æ¥åˆ°<code>WritableStream</code>ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸ä½¿ç”¨<code>pipeThrough</code>ç±»ä¼¼ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">async function* ints() {
  for (let i = 0; i &lt; 5; i++) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, i))
  }
}

const integerStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of ints()) {
      controller.enqueue(chunk)
    }
    controller.close()
  },
})

const writableStream = new WritableStream({
  write(value) {
    console.log(value)
  },
})

const pipedStream = integerStream.pipeTo(writableStream)
// 0
// 1
// 2
// 3
// 4</code>
        </deckgo-highlight-code><p>æ³¨æ„ï¼Œè¿™é‡Œçš„ç®¡é“æ“ä½œéšå¼åœ°ä»<code>ReadableStream</code>è·å¾—äº†ä¸€ä¸ªè¯»å–å™¨ï¼Œå¹¶æŠŠäº§ç”Ÿçš„å€¼å¡«å……åˆ°äº†<code>WritableStream</code>ã€‚</p><h1>è®¡æ—¶ API</h1><p>é¡µé¢æ€§èƒ½å§‹ç»ˆæ˜¯å¼€å‘è€…å…³å¿ƒçš„è¯é¢˜ã€‚<code>Performance</code>æ¥å£é€šè¿‡ JavaScript API æš´éœ²äº†æµè§ˆå™¨å†…éƒ¨çš„åº¦é‡æŒ‡æ ‡ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥è®¿é—®è¿™äº›ä¿¡æ¯å¹¶åŸºäºè¿™äº›ä¿¡æ¯å®ç°è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ã€‚è¿™ä¸ªæ¥å£æš´éœ²åœ¨<code>window.performance</code>å¯¹è±¡ä¸Šã€‚æ‰€æœ‰ä¸é¡µé¢ç›¸å…³çš„æŒ‡æ ‡ï¼ŒåŒ…æ‹¬å·²ç»å®šä¹‰å’Œå°†æ¥ä¼šå®šä¹‰çš„ï¼Œéƒ½ä¼šå­˜åœ¨äºè¿™ä¸ªå¯¹è±¡ä¸Šã€‚</p><p><code>Performance</code>æ¥å£ç”±å¤šä¸ª API æ„æˆï¼š</p><ul><li>High Resolution Time API</li><li>Performance Timeline API</li><li>Navigation Timing API</li><li>User Timing API</li><li>Resource Timing API</li><li>Paint Timing API</li></ul><p>æœ‰å…³è¿™äº›è§„èŒƒçš„æ›´å¤šä¿¡æ¯ä»¥åŠæ–°å¢çš„æ€§èƒ½ç›¸å…³è§„èŒƒï¼Œå¯ä»¥å…³æ³¨ W3C æ€§èƒ½å·¥ä½œç»„çš„ GitHub é¡¹ç›®é¡µé¢ã€‚</p><blockquote><p>æµè§ˆå™¨é€šå¸¸æ”¯æŒè¢«åºŸå¼ƒçš„ Level 1 å’Œä½œä¸ºæ›¿ä»£çš„ Level 2ã€‚æœ¬èŠ‚å°½é‡ä»‹ç» Level2 çº§è§„èŒƒã€‚</p></blockquote><h2>High Resolution Time API</h2><p><code>Date.now()</code>æ–¹æ³•åªé€‚ç”¨äºæ—¥æœŸæ—¶é—´ç›¸å…³æ“ä½œï¼Œè€Œä¸”æ˜¯ä¸è¦æ±‚è®¡æ—¶ç²¾åº¦çš„æ“ä½œã€‚åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œå‡½æ•°<code>foo()</code>è°ƒç”¨å‰ååˆ†åˆ«è®°å½•äº†ä¸€ä¸ªæ—¶é—´æˆ³ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const t0 = Date.now()
foo()
const t1 = Date.now()

const duration = t1 - t0

console.log(duration)</code>
        </deckgo-highlight-code><p>è€ƒè™‘å¦‚ä¸‹<code>duration</code>ä¼šåŒ…å«æ„å¤–å€¼çš„æƒ…å†µã€‚</p><ul><li><strong><code>duration</code>æ˜¯ 0</strong>ã€‚<code>Date.now()</code>åªæœ‰æ¯«ç§’çº§ç²¾åº¦ï¼Œå¦‚æœ<code>foo()</code>æ‰§è¡Œé€Ÿåº¦å¤Ÿå¿«ï¼Œä¸¤ä¸ªæ—¶é—´æˆ³çš„å€¼ä¼šç›¸ç­‰ã€‚</li><li><strong><code>duration</code>æ˜¯è´Ÿå€¼æˆ–æå¤§å€¼</strong>ã€‚å¦‚æœåœ¨<code>foo()</code>æ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿåå‡ ç§è¢«å‘åæˆ–å‘å‰è°ƒæ•´äº†ï¼ˆä¾‹å¦‚åˆ‡æ¢åˆ°å¤ä»¤æ—¶ï¼‰ï¼Œåˆ™æ•è·çš„æ—¶é—´æˆ³ä¸ä¼šè€ƒè™‘è¿™ç§æƒ…å†µï¼Œå› æ­¤æ—¶é—´å·®ä¸­ä¼šåŒ…å«è¿™äº›è°ƒæ•´ã€‚</li></ul><p>ä¸ºæ­¤å¿…é¡»ä½¿ç”¨ä¸åŒçš„è®¡æ—¶ API æ¥ç²¾ç¡®ä¸”å‡†ç¡®åœ°åº¦é‡æ—¶é—´çš„æµé€ã€‚High Resolution Time API å®šä¹‰äº†<code>window.performance.now()</code>ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç²¾ç¡®åˆ°å¾®ç§’ï¼ˆè¿”å›å€¼æ²¡æœ‰é™åˆ¶åœ¨ä¸€æ¯«ç§’çš„ç²¾åº¦å†…ï¼Œå®ƒå¸¦æœ‰æµ®ç‚¹æ•°ï¼Œå› æ­¤ç²¾åº¦æœ€é«˜å¯ä»¥è¾¾åˆ°å¾®ç§’çº§ï¼‰çš„æµ®ç‚¹å€¼ã€‚å› æ­¤ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å…ˆåæ•è·çš„æ—¶é—´æˆ³æ›´ä¸å¯èƒ½å‡ºç°æƒ³ç­‰çš„æƒ…å†µã€‚è€Œä¸”è¿™ä¸ªæ–¹æ³•å¯ä»¥ä¿è¯æ—¶é—´æˆ³å•è°ƒé€’å¢ã€‚</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const t0 = performance.now()
const t1 = performance.now()

console.log(t0)
console.log(t1)</code>
        </deckgo-highlight-code><p><code>performance.now()</code>è®¡æ—¶å™¨é‡‡ç”¨<strong>ç›¸å¯¹</strong>åº¦é‡ã€‚è¿™ä¸ªè®¡æ—¶å™¨åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ—¶ä» 0 å¼€å§‹è®¡æ—¶ã€‚ä¾‹å¦‚æ‰“å¼€é¡µé¢æˆ–åˆ›å»ºå·¥ä½œçº¿ç¨‹æ—¶ï¼Œ<code>performance.now()</code>å°±ä¼šä» 0 å¼€å§‹è®¡æ—¶ã€‚ç”±äºè¿™ä¸ªè®¡æ—¶å™¨åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­åˆå§‹åŒ–æ—¶å¯èƒ½å­˜åœ¨æ—¶é—´å·®ï¼Œå› æ­¤ä¸åŒä¸Šä¸‹æ–‡ä¹‹é—´å¦‚æœæ²¡æœ‰å…±äº«å‚ç…§ç‚¹åˆ™ä¸å¯èƒ½ç›´æ¥æ¯”è¾ƒ<code>performance.now()</code>ã€‚<code>performance.timeOrigin</code>å±æ€§è¿”å›è®¡æ—¶å™¨åˆå§‹åŒ–æ—¶å…¨å±€ç³»ç»Ÿæ—¶é’Ÿçš„å€¼ã€‚</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const relativeTimestamp = performance.now()
const absoluteTimestamp = performance.timeOrigin + relativeTimestamp

console.log(relativeTimestamp)
console.log(absoluteTimestamp)</code>
        </deckgo-highlight-code><blockquote><p>é€šè¿‡ä½¿ç”¨<code>performance.now()</code>æµ‹é‡ L1 ç¼“å­˜ä¸ä¸»å­˜çš„å»¶è¿Ÿå·®ï¼Œå¹½çµæ¼æ´å¯ä»¥æ‰§è¡Œç¼“å­˜æ¨æ–­æ”»å‡»ã€‚ä¸ºäº†å¼¥è¡¥è¿™ä¸ªå®‰å…¨æ¼æ´ï¼Œæ‰€æœ‰çš„ä¸»æµæµè§ˆå™¨æœ‰çš„é€‰æ‹©é™ä½<code>performance.now()</code>çš„ç²¾åº¦ï¼Œæœ‰çš„é€‰æ‹©åœ¨æ—¶é—´æˆ³é‡Œé¢æ··å…¥ä¸€äº›éšæœºæ€§ã€‚</p><p>MDN çš„æè¿°ï¼šè¿™ä¸ªæ—¶é—´æˆ³å®é™…ä¸Šå¹¶ä¸æ˜¯é«˜ç²¾åº¦çš„ã€‚ä¸ºäº†é™ä½åƒ<a href="https://spectreattack.com/">Spectre</a>è¿™æ ·çš„å®‰å…¨å¨èƒï¼Œå„ç±»æµè§ˆå™¨å¯¹è¯¥ç±»å‹çš„å€¼åšäº†ä¸åŒç¨‹åº¦ä¸Šçš„å››èˆäº”å…¥å¤„ç†ã€‚ï¼ˆFirefox ä» Firefox 59 å¼€å§‹å››èˆäº”å…¥åˆ° 2 æ¯«ç§’ç²¾åº¦ï¼‰ä¸€äº›æµè§ˆå™¨è¿˜å¯èƒ½å¯¹è¿™ä¸ªå€¼ä½œç¨å¾®çš„éšæœºåŒ–å¤„ç†ã€‚è¿™ä¸ªå€¼çš„ç²¾åº¦åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå†æ¬¡æ”¹å–„ï¼›æµè§ˆå™¨å¼€å‘è€…è¿˜åœ¨è°ƒæŸ¥è¿™äº›æ—¶é—´æµ‹å®šæ”»å‡»å’Œå¦‚ä½•æ›´å¥½çš„ç¼“è§£è¿™äº›æ”»å‡»ã€‚</p></blockquote><h2>Performance Timeline API</h2><p>Performance Timeline API ä½¿ç”¨ä¸€å¥—ç”¨äºåº¦é‡å®¢æˆ·ç«¯å»¶è¿Ÿçš„å·¥å…·æ‰©å±•äº†<code>Performance</code>æ¥å£ã€‚æ€§èƒ½åº¦é‡å°†ä¼šé‡‡ç”¨è®¡ç®—ç»“æŸä¸å¼€å§‹æ—¶é—´å·®çš„å½¢å¼ã€‚è¿™äº›å¼€å§‹å’Œç»“æŸæ—¶é—´ä¼šè¢«è®°å½•ä¸º<code>DOMHighResTimeStamp</code>å€¼ï¼Œè€Œå°è£…è¿™ä¸ªæ—¶é—´æˆ³çš„å¯¹è±¡æ˜¯<code>PerformanceEntry</code>çš„å®ä¾‹ã€‚</p><p>æµè§ˆå™¨ä¼šè‡ªåŠ¨è®°å½•å„ç§<code>PerformanceEntry</code>å¯¹è±¡ï¼Œè€Œä½¿ç”¨<code>performance.mark()</code>ä¹Ÿå¯ä»¥è®°å½•è‡ªå®šä¹‰çš„<code>PerformanceEntry</code>å¯¹è±¡ã€‚åœ¨ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¢«è®°å½•çš„æ‰€æœ‰æ€§èƒ½æ¡ç›®å¯ä»¥é€šè¿‡<code>performance.getEntries()</code>è·å–ã€‚</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">console.log(performance.getEntries())
// [PerformanceNavigationTiming, PerformanceResourceTiming, ... ]</code>
        </deckgo-highlight-code><p>è¿™ä¸ªè¿”å›çš„é›†åˆä»£è¡¨æµè§ˆå™¨çš„<strong>æ€§èƒ½æ—¶é—´çº¿</strong>ã€‚æ¯ä¸ª<code>PerformanceEntry</code>å¯¹è±¡éƒ½æœ‰<code>name</code>ã€<code>entryType</code>ã€<code>startTime</code>å’Œ<code>duration</code>å±æ€§ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const entry = performance.getEntries()[0]

console.log(entry.name)
console.log(entry.entryType)
console.log(entry.startTime)
console.log(entry.duration)</code>
        </deckgo-highlight-code><p>ä¸è¿‡ï¼Œ<code>PerformanceEntry</code>å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ã€‚æ‰€æœ‰è®°å½•æ¡ç›®è™½ç„¶éƒ½ç»§æ‰¿<code>PerformanceEntry</code>ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯å¦‚ä¸‹æŸä¸ªå…·ä½“ç±»çš„å®ä¾‹ï¼š</p><ul><li><code>PerformanceMark</code></li><li><code>PerformanceMeasure</code></li><li><code>PerformanceFrameTiming</code></li><li><code>PerformanceNavigationTiming</code></li><li><code>PerformanceResourceTiming</code></li><li><code>PerformancePaintTiming</code></li></ul><p>ä¸Šé¢æ¯ä¸ªç±»éƒ½ä¼šå¢åŠ å¤§é‡å±æ€§ï¼Œç”¨äºæè¿°ä¸ç›¸åº”æ¡ç›®æœ‰å…³çš„å…ƒæ•°æ®ã€‚æ¯ä¸ªå®ä¾‹çš„<code>name</code>å’Œ<code>entryType</code>å±æ€§ä¼šå› ä¸ºå„è‡ªçš„ç±»ä¸åŒè€Œä¸åŒã€‚</p><h3>User Timing API</h3><p>User Timing API ç”¨äºè®°å½•å’Œåˆ†æè‡ªå®šä¹‰æ€§èƒ½æ¡ç›®ã€‚å¦‚å‰æ‰€è¿°ï¼Œè®°å½•è‡ªå®šä¹‰æ€§èƒ½æ¡ç›®è¦ä½¿ç”¨<code>performance.mark()</code>æ–¹æ³•ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">performance.mark(&#x27;foo&#x27;)

console.log(performance.getEntriesByType(&#x27;mark&#x27;)[0])

// PerformanceMark {
//   name: &#x27;foo&#x27;,
//   entryType: &#x27;mark&#x27;,
//   startTime: 259.88000000334,
//   duration: 0
// }</code>
        </deckgo-highlight-code><p>åœ¨è®¡ç®—å¼€å§‹å‰å’Œç»“æŸåå„è‡ªåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ€§èƒ½æ¡ç›®å¯ä»¥è®¡ç®—æ—¶é—´å·®ã€‚æœ€æ–°çš„æ ‡è®°(mark)ä¼šè¢«æ¨åˆ°<code>getEntriesByType()</code>è¿”å›æ•°ç»„çš„å¼€å§‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">performance.mark(&#x27;foo&#x27;)
for (let i = 0; i &lt; 1e6; i++) {}
performance.mark(&#x27;bar&#x27;)

const [endMark, startMark] = performance.getEntriesByType(&#x27;mark&#x27;)
console.log(startMark.startTime - endMark.startTime) // 1.329999999123213</code>
        </deckgo-highlight-code><p>é™¤äº†è‡ªå®šä¹‰æ€§èƒ½æ¡ç›®ï¼Œè¿˜å¯ä»¥ç”Ÿæˆ<code>PerformanceMeasure</code>ï¼ˆæ€§èƒ½åº¦é‡ï¼‰æ¡ç›®ï¼Œå¯¹åº”ç”±åå­—ä½œä¸ºæ ‡è¯†çš„ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æŒç»­æ—¶é—´ã€‚<code>PerformanceMeasure</code>çš„å®ä¾‹ç”±<code>performance.measure()</code>æ–¹æ³•ç”Ÿæˆï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">performance.mark(&#x27;foo&#x27;)
for (let i = 0; i &lt; 1e6; i++) {}
performance.mark(&#x27;bar&#x27;)

peformance.measure(&#x27;baz&#x27;, &#x27;foo&#x27;, &#x27;bar&#x27;)

const [differenceMark] = performance.getEntriesByType(&#x27;measure&#x27;)

console.log(differenceMark)

// PerformanceMeasure {
//   name: &quot;baz&quot;,
//   entryType: &quot;measure&quot;,
//   startTime: 298.9800000214018,
//   duration: 1.349999976810068
// }</code>
        </deckgo-highlight-code><h3>Navigation Timing API</h3><p>Navigation Timing API æä¾›äº†é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼Œç”¨äºåº¦é‡å½“å‰é¡µé¢åŠ è½½é€Ÿåº¦ã€‚æµè§ˆå™¨ä¼šåœ¨å¯¼èˆªæ—¶é—´å‘ç”Ÿæ—¶è‡ªåŠ¨è®°å½•<code>PerformanceNavigationTiming</code>æ¡ç›®ã€‚è¿™ä¸ªå¯¹è±¡ä¼šæ•è·å¤§é‡æ—¶é—´æˆ³ï¼Œç”¨äºæè¿°é¡µé¢ä½•æ—¶ä»¥åŠå¦‚ä½•åŠ è½½çš„ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­è®¡ç®—äº†<code>loadEventStart</code>å’Œ<code>loadEventEnd</code>æ—¶é—´æˆ³ä¹‹é—´çš„å·®ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const [performanceNavigationTimingEntry] =
  performance.getEntriesByType(&#x27;navigation&#x27;)

console.log(performanceNavigationTimingEntry)

console.log(
  performanceNavigationTimingEntry.loadEventEnd -
    performanceNavigationTimingEntry.loadEventStart
)</code>
        </deckgo-highlight-code><h3>Resource Timing API</h3><p>Resource Timing API æä¾›äº†é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼Œç”¨äºåº¦é‡å½“å‰é¡µé¢åŠ è½½æ—¶è¯·æ±‚èµ„æºçš„é€Ÿåº¦ã€‚æµè§ˆå™¨ä¼šåœ¨åŠ è½½èµ„æºæ—¶è‡ªåŠ¨è®°å½•<code>PerformanceResourceTiming</code>ã€‚è¿™ä¸ªå¯¹è±¡ä¼šæ•è·å¤§é‡æ—¶é—´æˆ³ï¼Œç”¨äºæè¿°èµ„æºåŠ è½½çš„é€Ÿåº¦ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­è®¡ç®—äº†åŠ è½½ä¸€ä¸ªç‰¹å®šèµ„æºèŠ±è´¹çš„æ—¶é—´ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const performanceResourceTimingEntry =
  performance.getEntriesByType(&#x27;resource&#x27;)[0]

console.log(performanceResourceTimingEntry)

console.log(
  performanceResourceTimingEntry.responseEnd -
    performanceResourceTimingEntry.requestStart
)</code>
        </deckgo-highlight-code><p>é€šè¿‡è®¡ç®—å¹¶åˆ†æä¸åŒæ—¶é—´çš„å·®ï¼Œå¯ä»¥æ›´å…¨é¢åœ°å®¡è§†æµè§ˆå™¨åŠ è½½é¡µé¢çš„è¿‡ç¨‹ï¼Œå‘ç°å¯èƒ½å­˜åœ¨çš„æ€§èƒ½ç“¶é¢ˆã€‚</p><h1>Web ç»„ä»¶</h1><p>è¿™é‡Œæ‰€è¯´çš„ Web ç»„ä»¶æŒ‡çš„æ˜¯ä¸€å¥—ç”¨äºå¢å¼º DOM è¡Œä¸ºçš„å·¥å…·ï¼ŒåŒ…æ‹¬å½±å­ DOMã€è‡ªå®šä¹‰å…ƒç´ å’Œ HTML æ¨¡ç‰ˆã€‚è¿™ä¸€å¥—æµè§ˆå™¨ API ç‰¹åˆ«æ··ä¹±ã€‚</p><ul><li>å¹¶æ²¡æœ‰ç»Ÿä¸€çš„â€œWeb Componentsâ€è§„èŒƒï¼šæ¯ä¸ª Web ç»„ä»¶éƒ½åœ¨ä¸€ä¸ªä¸åŒçš„è§„èŒƒä¸­å®šä¹‰ã€‚</li><li>æœ‰äº› Web ç»„ä»¶å¦‚å½±å­ DOM å’Œè‡ªå®šä¹‰å…ƒç´ ï¼Œå·²ç»å‡ºç°äº†å‘åä¸å…¼å®¹çš„ç‰ˆæœ¬é—®é¢˜ã€‚</li><li>æµè§ˆå™¨å®ç°æå…¶ä¸ä¸€è‡´ã€‚</li></ul><p>ç”±äºå­˜åœ¨è¿™äº›é—®é¢˜ï¼Œå› æ­¤ä½¿ç”¨ Web ç»„ä»¶é€šå¸¸è¦å¼•å…¥ä¸€ä¸ª Web ç»„ä»¶åº“ï¼Œä¾‹å¦‚ Polymerã€‚è¿™ç§åº“å¯ä»¥ä½œä¸ºè…»å­è„šæœ¬ï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨ä¸­ç¼ºå¤±çš„ Web ç»„ä»¶ã€‚</p><h2>HTML æ¨¡ç‰ˆ</h2><p>åœ¨ Web ç»„ä»¶ä¹‹å‰ä¸€ç›´ç¼ºå°‘åŸºäº HTML è§£ææ„å»º DOM å­æ ‘ï¼Œç„¶ååœ¨éœ€è¦æ—¶å†æŠŠè¿™ä¸ªå­æ ‘æ¸²æŸ“å‡ºæ¥çš„æœºåˆ¶ã€‚ä¸€ç§é—´æ¥æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>innerHTML</code>æŠŠæ ‡è®°å­—ç¬¦ä¸²è½¬æ¢ä¸º DOM å…ƒç´ ï¼Œä½†è¿™ç§æ–¹å¼å­˜åœ¨ä¸¥é‡çš„å®‰å…¨éšæ‚£ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨<code>document.createElement()</code>æ„å»ºæ¯ä¸ªå…ƒç´ ï¼Œç„¶åé€ä¸ªå°†å…¶æ·»åŠ åˆ°å­¤å„¿è·ŸèŠ‚ç‚¹ï¼ˆä¸æ˜¯æ·»åŠ åˆ° DOMï¼‰ï¼Œä½†è¿™æ ·åšç‰¹åˆ«éº»çƒ¦ï¼Œå®Œå…¨ä¸æ ‡è®°æ— å…³ã€‚</p><p>ç›¸åï¼Œæ›´å¥½çš„æ–¹å¼æ˜¯æå‰åœ¨é¡µé¢ä¸­å†™å‡ºç‰¹æ®Šæ ‡è®°ï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨å°†å…¶è§£æä¸º DOM å­æ ‘ï¼Œä½†è·³è¿‡æ¸²æŸ“ã€‚è¿™æ­£æ˜¯ HTML æ¨¡ç‰ˆçš„æ ¸å¿ƒæ€æƒ³ï¼Œè€Œ<code>&lt;template&gt;</code>æ ‡ç­¾æ­£æ˜¯ä¸ºè¿™ä¸ªç›®çš„è€Œç”Ÿçš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ HTML æ¨¡ç‰ˆçš„ä¾‹å­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;template id=&quot;foo&quot;&gt;
  &lt;p&gt;I&#x27;m inside a template&lt;/p&gt;
&lt;/template&gt;</code>
        </deckgo-highlight-code><h3>ä½¿ç”¨<code>DocumentFragment</code></h3><p>åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“æ—¶ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„æ–‡æœ¬ä¸ä¼šè¢«æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚å› ä¸º<code>&lt;template&gt;</code>çš„å†…å®¹ä¸å±äºæ´»åŠ¨æ–‡æ¡£ï¼Œæ‰€ä»¥<code>document.querySelector()</code>ç­‰ DOM æŸ¥è¯¢æ–¹æ³•ä¸ä¼šå‘ç°å…¶ä¸­çš„<code>&lt;p&gt;</code>æ ‡ç­¾ã€‚è¿™æ˜¯å› ä¸º<code>&lt;p&gt;</code>å­˜åœ¨äºä¸€ä¸ªåŒ…å«åœ¨ HTML æ¨¡æ¿ä¸­çš„<code>DocumentFragment</code>èŠ‚ç‚¹å†…ã€‚</p><p>åœ¨æµè§ˆå™¨ä¸­é€šè¿‡å¼€å‘è€…å·¥å…·æ£€æŸ¥å†…å®¹æ—¶ï¼Œå¯ä»¥çœ‹åˆ°<code>&lt;template&gt;</code>ä¸­çš„<code>DocumentFragment</code>ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;template id=&quot;foo&quot;&gt;
  #document-fragment
  &lt;p&gt;I&#x27;m inside a template&lt;/p&gt;
&lt;/template&gt;</code>
        </deckgo-highlight-code><p>é€šè¿‡<code>&lt;template&gt;</code>å…ƒç´ çš„<code>content</code>å±æ€§å¯ä»¥å–å¾—è¿™ä¸ª<code>DocumentFragment</code>çš„å¼•ç”¨ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">console.log(document.querySelector(&#x27;#foo&#x27;).content) // #document-fragment</code>
        </deckgo-highlight-code><p>æ­¤æ—¶çš„<code>DocumentFragment</code>å°±åƒä¸€ä¸ªå¯¹åº”å­æ ‘çš„æœ€å°åŒ–<code>document</code>å¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼Œ<code>DocumentFragment</code>ä¸Šçš„ DOM åŒ¹é…æ–¹æ³•å¯ä»¥æŸ¥è¯¢å…¶å­æ ‘ä¸­çš„èŠ‚ç‚¹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const fragment = document.querySelector(&#x27;#foo&#x27;).content

console.log(document.querySelector(&#x27;p&#x27;)) // null
console.log(fragment.querySelector(&#x27;p&#x27;)) // &lt;p&gt; ... &lt;p&gt;</code>
        </deckgo-highlight-code><p><code>DocumentFragment</code>ä¹Ÿæ˜¯æ‰¹é‡å‘ HTML ä¸­æ·»åŠ å…ƒç´ çš„é«˜æ•ˆå·¥å…·ã€‚ä¾‹å¦‚æƒ³è¦ä»¥æœ€å¿«çš„æ–¹å¼ç»™æŸä¸ª HTML å…ƒç´ æ·»åŠ å¤šä¸ªå­å…ƒç´ ã€‚å¦‚æœè¿ç»­è°ƒç”¨<code>document.appendChild()</code>ï¼Œåˆ™ä¸è´¹äº‹ï¼Œè¿˜ä¼šå¯¼è‡´å¤šæ¬¡å¸ƒå±€é‡æ‹ã€‚è€Œä½¿ç”¨<code>DocumentFragment</code>å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæœ€å¤šåªä¼šæœ‰ä¸€æ¬¡å¸ƒå±€é‡æ’ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const fragment = new DocumentFragment()

const foo = document.querySelector(&#x27;#foo&#x27;)

// ä¸ºDocumentFragmentæ·»åŠ å­å…ƒç´ ä¸ä¼šå¯¼è‡´å¸ƒå±€é‡æ’
fragment.appendChild(document.createElement(&#x27;p&#x27;))
fragment.appendChild(document.createElement(&#x27;p&#x27;))
fragment.appendChild(document.createElement(&#x27;p&#x27;))

console.log(fragment.children.length) // 3

foo.appendChild(fragment)
console.log(fragment.children.length) // 0
console.log(document.body.innerHTML)</code>
        </deckgo-highlight-code><h3>ä½¿ç”¨<code>&lt;template&gt;</code>æ ‡ç­¾</h3><p>æ³¨æ„åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œ<code>DocumentFragment</code>çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½é«˜æ•ˆåœ°è½¬ç§»åˆ°äº†<code>foo</code>å…ƒç´ ä¸Šï¼Œè½¬ç§»ä¹‹å<code>DocumentFragment</code>å˜ç©ºäº†ã€‚åŒæ ·çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥ä½¿ç”¨<code>&lt;template&gt;</code>æ ‡ç­¾é‡ç°ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const fooElement = document.querySelector(&#x27;#foo&#x27;)
const barTemplate = document.querySelector(&#x27;#bar&#x27;)
const barFragment = barTemplate.content

console.log(document.body.innerHTML)

fooElement.appendChild(barFragment)

console.log(document.body.innerHTML)</code>
        </deckgo-highlight-code><p>å¦‚æœæƒ³è¦å¤åˆ¶æ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨<code>importNode()</code>æ–¹æ³•å…‹éš†<code>DocumentFragment</code>ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const fooElement = document.querySelector(&#x27;#foo&#x27;)
const barTemplate = document.querySelector(&#x27;#bar&#x27;)
const barFragment = barTemplate.content

console.log(document.body.innerHTML)

fooElement.appendChild(document.importNode(barFragment, true))

console.log(document.body.innerHTML)</code>
        </deckgo-highlight-code><h3>æ¨¡æ¿è„šæœ¬</h3><p>è„šæœ¬æ‰§è¡Œå¯ä»¥æ¨è¿Ÿåˆ°å°†<code>DocumentFragment</code>çš„å†…å®¹å®é™…æ·»åŠ åˆ° DOM æ ‘ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const fooElement = document.querySelector(&#x27;#foo&#x27;)
const barTemplate = document.querySelector(&#x27;#bar&#x27;)
const barFragment = barTemplate.content

console.log(&#x27;About to add template&#x27;)
fooElement.appendChild(barFragment)
console.log(&#x27;Added template&#x27;)</code>
        </deckgo-highlight-code><p>å¦‚æœæ–°æ·»åŠ çš„å…ƒç´ éœ€è¦è¿›è¡ŒæŸäº›åˆå§‹åŒ–ï¼Œè¿™ç§å»¶è¿Ÿæ‰§è¡Œæ˜¯æœ‰ç”¨çš„ã€‚</p><h2>å½±å­ DOM</h2><p>æ¦‚å¿µä¸Šè®²ï¼Œå½±å­ DOMï¼ˆshadow DOMï¼‰Web ç»„ä»¶ç›¸å½“ç›´è§‚ï¼Œé€šè¿‡å®ƒå¯ä»¥è®²ä¸€ä¸ªå®Œæ•´çš„ DOM æ ‘ä½œä¸ºèŠ‚ç‚¹æ·»åŠ åˆ°çˆ¶ DOM æ ‘ã€‚è¿™æ ·å¯ä»¥å®ç° DOM å°è£…ï¼Œæ„å‘³ç€ CSS æ ·å¼å’Œ CSS é€‰æ‹©ç¬¦å¯ä»¥é™åˆ¶åœ¨å½±å­ DOM å­æ ‘è€Œä¸æ˜¯æ•´ä¸ªé¡¶çº§ DOM æ ‘ä¸­ã€‚</p><p>å½±å­ DOM ä¸ HTML æ¨¡æ¿å¾ˆç›¸ä¼¼ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ç±»ä¼¼<code>document</code>çš„ç»“æ„ï¼Œå¹¶å…è®¸ä¸é¡¶çº§ DOM æœ‰ä¸€å®šç¨‹åº¦çš„åˆ†ç¦»ã€‚ä¸è¿‡å½±å­ DOM ä¸ HTML æ¨¡æ¿è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸»è¦è¡¨ç°åœ¨å½±å­ DOM çš„å†…å®¹ä¼šå®é™…æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œè€Œ HTML æ¨¡æ¿çš„å†…å®¹ä¸ä¼šã€‚</p><h3>ç†è§£å½±å­ DOM</h3><p>å‡è®¾æœ‰ä»¥ä¸‹ HTML æ ‡è®°ï¼Œå…¶ä¸­åŒ…å«æŸä¸ªç±»ä¼¼çš„ DOM å­æ ‘ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;div&gt;
  &lt;p&gt;Make me red&lt;/p&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;p&gt;Make me blue&lt;/p&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;p&gt;Make me green&lt;/p&gt;
&lt;/div&gt;</code>
        </deckgo-highlight-code><p>ä»å…¶æ–‡æœ¬èŠ‚ç‚¹å¯ä»¥çœ‹å‡ºï¼Œè¿™ 3 ä¸ªå­æ ‘ä¼šåˆ†åˆ«æ¸²æŸ“ä¸ºä¸åŒçš„é¢œè‰²ã€‚å¸¸è§„æƒ…å†µä¸‹ï¼Œä¸ºäº†ç»™æ¯ä¸ªå­æ ‘åº”ç”¨å”¯ä¸€çš„æ ·å¼ï¼Œåˆä¸ä½¿ç”¨<code>style</code>å±æ€§ï¼Œå°±éœ€è¦ç»™æ¯ä¸ªå­æ ‘æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„ç±»åï¼Œç„¶åé€šè¿‡ç›¸åº”çš„é€‰æ‹©ç¬¦ä¸ºå®ƒä»¬æ·»åŠ æ ·å¼ï¼š</p><p>å½“ç„¶è¿™ä¸ªæ–¹æ¡ˆä¸æ˜¯ååˆ†ç†æƒ³ï¼Œå› ä¸ºè¿™è·Ÿåœ¨å…¨å±€å‘½åç©ºé—´ä¸­å®šä¹‰å˜é‡æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚å°½ç®¡çŸ¥é“è¿™äº›æ ·å¼å’Œå…¶ä»–åœ°æ–¹æ— å…³ï¼Œæ‰€æœ‰ CSS æ ·å¼è¿˜æ˜¯åº”ç”¨åˆ°æ•´ä¸ª DOMã€‚ä¸ºæ­¤ï¼Œå°±è¦ä¿æŒ CSS é€‰æ‹©ç¬¦è¶³å¤Ÿç‰¹åˆ«ï¼Œä»¥é˜²æ­¢è¿™äº›æ ·å¼æ¸—é€åˆ°å…¶ä»–åœ°æ–¹ã€‚ä½†è¿™ä¹Ÿä»…æ˜¯ä¸€ä¸ªè¿™ç§çš„åŠæ³•è€Œå·²ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”è¯¥èƒ½å¤ŸæŠŠ CSS é™åˆ¶åœ¨ä½¿ç”¨å®ƒä»¬çš„ DOM ä¸Šï¼šè¿™æ­£æ˜¯å½±å­ DOM æœ€åˆçš„ä½¿ç”¨åœºæ™¯ã€‚</p><h3>åˆ›å»ºå½±å­ DOM</h3><p>è€ƒè™‘åˆ°å®‰å…¨åŠé¿å…å½±å­ DOM å†²çªï¼Œå¹¶éæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥åŒ…å«å½±å­ DOMã€‚å°è¯•ç»™æ— æ•ˆå…ƒç´ æˆ–è€…å·²ç»æœ‰äº†å½±å­ DOM çš„å…ƒç´ æ·»åŠ å½±å­ DOM ä¼šå¯¼è‡´æŠ›å‡ºé”™è¯¯ã€‚å½±å­ DOM æ˜¯é€šè¿‡<code>attachShadow()</code>æ–¹æ³•åˆ›å»ºå¹¶æ·»åŠ ç»™æœ‰æ•ˆ HTML å…ƒç´ çš„ã€‚å®¹çº³å½±å­ DOM çš„å…ƒç´ è¢«ç§°ä¸º<strong>å½±å­å®¿ä¸»</strong>ï¼ˆshadow hostï¼‰ã€‚å½±å­ DOM çš„æ ¹èŠ‚ç‚¹è¢«ç§°ä¸º<strong>å½±å­æ ¹</strong>ï¼ˆshadow rootï¼‰ã€‚</p><p><code>attachShadow()</code>æ–¹æ³•éœ€è¦ä¸€ä¸ª<code>shadowRootInit</code>å¯¹è±¡ï¼Œè¿”å›å½±å­ DOM çš„å®ä¾‹ã€‚<code>shadowRootInit</code>å¯¹è±¡å¿…é¡»åŒ…å«ä¸€ä¸ª<code>mode</code>å±æ€§ï¼Œå€¼ä¸º<code>&quot;open&quot;</code>æˆ–<code>&quot;closed&quot;</code>ã€‚å¯¹<code>&quot;open&quot;</code>å½±å­ DOM çš„å¼•ç”¨å¯ä»¥é€šè¿‡<code>shadowRoot</code>å±æ€§åœ¨ HTML å…ƒç´ ä¸Šè·å¾—ï¼Œè€Œå¯¹<code>&quot;closed&quot;</code>å½±å­ DOM çš„å¼•ç”¨æ— æ³•è¿™æ ·è·å–ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†ä¸åŒ<code>mode</code>çš„åŒºåˆ«ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">document.body.innerHTML = `
  &lt;div id=&quot;foo&quot;&gt;&lt;/div&gt;
  &lt;div id=&quot;bar&quot;&gt;&lt;/div&gt;
`

const foo = document.querySelector(&#x27;#foo&#x27;)
const bar = document.querySelector(&#x27;#bar&#x27;)

const openShadowDOM = foo.attachShadow({ mode: &#x27;open&#x27; })
const closedShadowDOM = bar.attachShadow({ mode: &#x27;closed&#x27; })

console.log(openShadowDOM) // #shadow-root (open)
console.log(closedShadow) // #shadow-root (closed)

console.log(foo.shadowRoot) // #shadow-root (open)
console.log(bar.shadowRoot) // null</code>
        </deckgo-highlight-code><p>ä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦åˆ›å»ºä¿å¯†ï¼ˆclosedï¼‰å½±å­ DOM çš„åœºæ™¯å¾ˆå°‘ã€‚è™½ç„¶è¿™å¯ä»¥é™åˆ¶é€šè¿‡å½±å­å®¿ä¸»è®¿é—®å½±å­ DOMï¼Œä½†æ¶æ„ä»£ç æœ‰å¾ˆå¤šæ–¹æ³•ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œæ¢å¤å¯¹å½±å­ DOM çš„è®¿é—®ã€‚ç®€è¨€ä¹‹ï¼Œ<strong>ä¸èƒ½</strong>ä¸ºäº†å®‰å…¨è€Œåˆ›å»ºä¿å¯†å½±å­ DOMã€‚</p><blockquote><p>å¦‚æœæƒ³ä¿æŠ¤ç‹¬ç«‹çš„ DOM æ ‘ä¸å—æœªä¿¡ä»»ä»£ç å½±å“ï¼Œå½±å­ DOM å¹¶ä¸é€‚åˆè¿™ä¸ªéœ€æ±‚ã€‚å¯¹<code>&lt;iframe&gt;</code>æ–½åŠ çš„è·¨æºé™åˆ¶æ›´å¯é ã€‚</p></blockquote><h3>ä½¿ç”¨å½±å­ DOM</h3><p>å°†å½±å­ DOM æ·»åŠ åˆ°å…ƒç´ åï¼Œå¯ä»¥åƒä½¿ç”¨å¸¸è§„ DOM ä¸€æ ·ä½¿ç”¨å½±å­ DOMã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">for (const color of [&#x27;red&#x27;, &#x27;green&#x27;, &#x27;blue&#x27;]) {
  const div = document.createElement(&#x27;div&#x27;)
  const shadowDOM = div.attachShadow({ mode: &#x27;open&#x27; })

  document.body.appendChild(div)
  shadowDOM.innerHTML = `
    &lt;p&gt;Make me ${color}&lt;/p&gt;
    
    &lt;style&gt;
    p {
      color: ${color}
    }
    &lt;/style&gt;
  `
}</code>
        </deckgo-highlight-code><p>è™½ç„¶è¿™é‡Œä½¿ç”¨ç›¸åŒçš„é€‰æ‹©ç¬¦åº”ç”¨äº† 3 ç§ä¸åŒçš„é¢œè‰²ï¼Œä½†æ¯ä¸ªé€‰æ‹©ç¬¦åªä¼šæŠŠæ ·å¼åº”ç”¨åˆ°å®ƒä»¬æ‰€åœ¨çš„å½±å­ DOM ä¸Šã€‚ä¸ºæ­¤ï¼Œ3 ä¸ª<code>&lt;p&gt;</code>å…ƒç´ ä¼šå‡ºç° 3 ç§ä¸åŒçš„é¢œè‰²ã€‚</p><p>å¯ä»¥è¿™æ ·éªŒè¯è¿™äº›å…ƒç´ åˆ†åˆ«ä½äºå…¶è‡ªå·±çš„å½±å­ DOM ä¸­ï¼š</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">for (const color of [&#x27;red&#x27;, &#x27;green&#x27;, &#x27;blue&#x27;]) {
  const div = document.createElement(&#x27;div&#x27;)
  const shadowDOM = div.attachShadow({ mode: &#x27;open&#x27; })

  document.body.appendChild(div)

  shadowDOM.innerHTML = `
    &lt;p&gt;Make me ${color}&lt;/p&gt;
    
    &lt;style&gt;
    p {
      color: ${color};
    }
    &lt;/style&gt;
  `
}

function countP(node) {
  console.log(node.querySelectorAll(&#x27;p&#x27;).length)
}

countP(document)

for (let element of document.querySelectorAll(&#x27;div&#x27;)) {
  countP(element.shadowRoot)
}</code>
        </deckgo-highlight-code><p>åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·å¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°å½±å­ DOMã€‚ä¾‹å¦‚å‰é¢çš„ä¾‹å­åœ¨æ£€æŸ¥æµè§ˆå™¨çª—å£æ—¶ä¼šæ˜¾ç¤ºæˆå¦‚ä¸‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;body&gt;
  &lt;div&gt;
    #shadow-root (open)
    &lt;p&gt;Make me red!&lt;/p&gt;
    &lt;style&gt;
      p {
        color: &#x27;red&#x27;;
      }
    &lt;/style&gt;
  &lt;/div&gt;

  &lt;div&gt;
    #shadow-root (open)
    &lt;p&gt;Make me green!&lt;/p&gt;
    &lt;style&gt;
      p {
        color: green;
      }
    &lt;/style&gt;
  &lt;/div&gt;

  &lt;div&gt;
    #shadow-root(open)
    &lt;p&gt;Make me blue!&lt;/p&gt;

    &lt;style&gt;
      p {
        color: blue;
      }
    &lt;/style&gt;
  &lt;/div&gt;
&lt;/body&gt;</code>
        </deckgo-highlight-code><p>å½±å­ DOM å¹¶éé“æ¿ä¸€å—ã€‚HTML å…ƒç´ å¯ä»¥åœ¨ DOM æ ‘é—´æ— é™åˆ¶ç§»åŠ¨ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">document.body.innerHTML = `&lt;div&gt;&lt;/div&gt;&lt;p id=&quot;foo&quot;&gt;Move me&lt;/p&gt;`

const divElement = document.querySelector(&#x27;div&#x27;)
const pElement = document.querySelector(&#x27;p&#x27;)

const shadowDOM = divElement.attachShadow({ mode: &#x27;open&#x27; })

// ä»çˆ¶DOMä¸­ç§»é™¤å…ƒç´ 
divElement.parentElement.removeChild(pElement)

// å°†å…ƒç´ æ·»åŠ åˆ°å½±å­DOM
shadowDOM.appendChild(pElement)

// æ£€æŸ¥å…ƒç´ æ˜¯å¦ç§»åŠ¨åˆ°äº†å½±å­DOMä¸­
console.log(shadowDOM.innerHTML) // &lt;p id=&quot;foo&quot;&gt;Move me&lt;/p&gt;</code>
        </deckgo-highlight-code><h3>åˆæˆä¸å½±å­ DOM æ§½ä½</h3><p>å½±å­ DOM æ˜¯ä¸ºè‡ªå®šä¹‰ Web ç»„ä»¶è®¾è®¡çš„ï¼Œä¸ºæ­¤éœ€è¦æ”¯æŒåµŒå¥— DOM ç‰‡æ®µã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼šä½äºå½±å­å®¿ä¸»ä¸­çš„ HTML éœ€è¦ä¸€ç§æœºåˆ¶ä»¥æ¸²æŸ“åˆ°å½±å­ DOM ä¸­å»ï¼Œä½†è¿™äº› HTML åˆä¸å¿…å±äºå½±å­ DOM æ ‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåµŒå¥—å†…å®¹ä¼šéšè—ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œå…¶ä¸­çš„æ–‡æœ¬åœ¨ 100ms åä¼šè¢«éšè—ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">document.body.innerHTML = `
  &lt;div&gt;
    &lt;p&gt;Foo&lt;/p&gt;
  &lt;/div&gt;
`

setTimeout(
  () =&gt; document.querySelector(&#x27;div&#x27;).attachShadow({ mode: &#x27;open&#x27; }),
  1000
)</code>
        </deckgo-highlight-code><p>å½±å­ DOM ä¸€æ—¦æ·»åŠ åˆ°å…ƒç´ ä¸­ï¼Œæµè§ˆå™¨å°±ä¼šèµ‹äºˆå®ƒæœ€é«˜ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆæ¸²æŸ“å®ƒçš„å†…å®¹è€Œä¸æ˜¯åŸæ¥çš„æ–‡æœ¬ã€‚åœ¨è¿™é‡Œä¾‹å­ä¸­ç”±äºå½±å­ DOM æ˜¯ç©ºçš„ï¼Œå› æ­¤<code>&lt;div&gt;</code>åœ¨ 1000ms åä¼šå˜æˆç©ºçš„ã€‚</p><p>ä¸ºäº†æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ï¼Œéœ€è¦ä½¿ç”¨<code>&lt;slot&gt;</code>æ ‡ç­¾æ¥æŒ‡ç¤ºæµè§ˆå™¨åœ¨å“ªé‡Œæ”¾ç½®åŸæ¥çš„ HTMLã€‚ä¸‹é¢çš„ä»£ç ä¿®æ”¹äº†å‰é¢çš„ä¾‹å­ï¼Œè®©å½±å­å®¿ä¸»ä¸­çš„æ–‡æœ¬å‡ºç°åœ¨äº†å½±å­ DOM ä¸­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">document.body.innerHTML = `
  &lt;div id=&quot;foo&quot;&gt;
    &lt;p&gt;Foo&lt;/p&gt;
  &lt;/div&gt;
`

document
  .querySelector(&#x27;div&#x27;)
  .attachShadow({ mode: &#x27;open&#x27; }).innerHTML = `&lt;div id=&quot;bar&quot;&gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/div&gt;`</code>
        </deckgo-highlight-code><p>ç°åœ¨æŠ•å°„è¿›å»çš„å†…å®¹å°±ä¼šåƒè‡ªå·±å­˜åœ¨äºå½±å­ DOM ä¸­ä¸€æ ·ã€‚æ£€æŸ¥é¡µé¢ä¼šå‘ç°åŸæ¥çš„å†…å®¹å®é™…ä¸Šæ›¿ä»£äº†<code>&lt;slot&gt;</code>ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;body&gt;
  &lt;div id=&quot;foo&quot;&gt;
    #shadow-root (open)
    &lt;div id=&quot;bar&quot;&gt;
      &lt;p&gt;Foo&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;</code>
        </deckgo-highlight-code><p>æ³¨æ„ï¼Œè™½ç„¶åœ¨é¡µé¢æ£€æŸ¥çª—å£ä¸­çœ‹åˆ°å†…å®¹åœ¨å½±å­ DOM ä¸­ï¼Œä½†è¿™å®é™…ä¸Šåªæ˜¯ DOM å†…å®¹çš„<strong>æŠ•å°„</strong>ï¼ˆprojection)ã€‚å®é™…çš„å…ƒç´ ä»ç„¶å¤„äºå¤–éƒ¨ DOM ä¸­ã€‚å¦å¤–é™¤äº†é»˜è®¤æ§½ä½ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<strong>å‘½åæ§½ä½</strong>æ¥å®ç°å¤šä¸ªæŠ•å°„ã€‚è¿™æ˜¯é€šè¿‡åŒ¹é…çš„<code>slot/name</code>å±æ€§å¯¹å®ç°çš„ã€‚</p><h3>äº‹ä»¶é‡å®šå‘</h3><p>å¦‚æœå½±å­ DOM ä¸­å‘ç”Ÿäº†æµè§ˆå™¨äº‹ä»¶ï¼ˆä¾‹å¦‚<code>click</code>ï¼‰ï¼Œé‚£ä¹ˆæµè§ˆå™¨éœ€è¦ä¸€ç§æ–¹å¼ä»¥è®©çˆ¶ DOM å¤„ç†äº‹ä»¶ã€‚ä¸è¿‡å®ç°ä¹Ÿéœ€è¦è€ƒè™‘åˆ°å½±å­ DOM çš„è¾¹ç•Œã€‚ä¸ºæ­¤äº‹ä»¶ä¼šé€ƒå‡ºå½±å­ DOM å¹¶ç»è¿‡<strong>äº‹ä»¶é‡å®šå‘</strong>åœ¨å¤–éƒ¨è¢«å¤„ç†ã€‚é€ƒå‡ºåï¼Œäº‹ä»¶å°±å¥½åƒæ˜¯ç”±å½±å­å®¿ä¸»æœ¬èº«è€ŒéçœŸæ­£çš„åŒ…è£…å…ƒç´ è§¦å‘çš„ä¸€æ ·ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">// åˆ›å»ºä¸€ä¸ªå…ƒç´ ä½œä¸ºå½±å­å®¿ä¸»
document.body.innerHTML = `
  &lt;div onclick=&quot;console.log(&#x27;handled outside:&#x27;, event.target)&quot;&gt;&lt;/div&gt;
`

// æ·»åŠ å½±å­DOMå¹¶å‘å…¶ä¸­æ’å…¥HTML
document.querySelector(&#x27;div&#x27;).attachShadow({ mode: &#x27;open&#x27; }).innerHTML = `
  &lt;button onclick=&quot;console.log(&#x27;handled inside:&#x27;, event.target)&quot;&gt;Foo&lt;/button&gt;
`</code>
        </deckgo-highlight-code><p>æ³¨æ„äº‹ä»¶é‡å®šå‘åªä¼šå‘ç”Ÿåœ¨å½±å­ DOM ä¸­å®é™…å­˜åœ¨çš„å…ƒç´ ä¸Šã€‚ä½¿ç”¨<code>&lt;slot&gt;</code>æ ‡ç­¾ä»å¤–éƒ¨æŠ•å°„è¿›æ¥çš„å…ƒç´ ä¸ä¼šå‘ç”Ÿäº‹ä»¶é‡å®šå‘ï¼Œå› ä¸ºä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™äº›å…ƒç´ ä»ç„¶å¤„äºå½±å­ DOM å¤–éƒ¨ã€‚</p><h2>è‡ªå®šä¹‰å…ƒç´ </h2><p>å¦‚æœä½ ä½¿ç”¨ JavaScript æ¡†æ¶ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ç†Ÿæ‚‰è‡ªå®šä¹‰å…ƒç´ çš„æ¦‚å¿µã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰ä¸»æµæ¡†æ¶éƒ½ä»¥æŸç§å½¢å¼æä¾›äº†è¿™ä¸ªç‰¹æ€§ã€‚è‡ªå®šä¹‰å…ƒç´ ä¸º HTML å…ƒç´ å¼•å…¥äº†é¢å‘å¯¹è±¡ç¼–ç¨‹çš„é£æ ¼ã€‚åŸºäºè¿™ç§é£æ ¼ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„ã€å¤æ‚çš„å’Œå¯é‡ç”¨çš„å…ƒç´ ï¼Œè€Œä¸”åªè¦ä½¿ç”¨ç®€å•çš„ HTML æ ‡ç­¾å°±å¯ä»¥åˆ›å»ºç›¸åº”çš„å®ä¾‹ã€‚</p><h3>åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ </h3><p>æµè§ˆå™¨ä¼šå°è¯•æ— æ³•è¯†åˆ«çš„å…ƒç´ æ‰€è°“é€šç”¨å…ƒç´ æ•´åˆè¿› DOMã€‚å½“ç„¶ï¼Œè¿™äº›å…ƒç´ é»˜è®¤ä¹Ÿä¸ä¼šåšä»»ä½•é€šè¿‡ HTML å…ƒç´ ä¸èƒ½åšçš„äº‹ã€‚æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œå…¶ä¸­èƒ¡ä¹±ç¼–çš„ HTML æ ‡ç­¾ä¼šå˜æˆä¸€ä¸ª<code>HTMLElment</code>å®ä¾‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">document.body.innerHTML = `
  &lt;x-foo&gt;I&#x27;m inside a nonsense element.&lt;/x-foo&gt;
`

console.log(document.querySelector(&#x27;x-foo&#x27;) instanceof HTMLElement) // true</code>
        </deckgo-highlight-code><p>è‡ªå®šä¹‰å…ƒç´ åœ¨æ­¤åŸºç¡€ä¸Šæ›´è¿›ä¸€æ­¥ã€‚åˆ©ç”¨è‡ªå®šä¹‰å…ƒç´ ï¼Œå¯ä»¥åœ¨<code>&lt;x-foo&gt;</code>æ ‡ç­¾å‡ºç°æ—¶ä¸ºå®ƒå®šä¹‰å¤æ‚çš„è¡Œä¸ºï¼ŒåŒæ ·ä¹Ÿå¯ä»¥åœ¨ DOM ä¸­å°†å…¶çº³å…¥å…ƒç´ ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚è‡ªå®šä¹‰å…ƒç´ è¦ä½¿ç”¨å…¨å±€å±æ€§<code>customElements</code>ï¼Œè¿™ä¸ªå±æ€§ä¼šè¿”å›<code>CustomElementRegistry</code>å¯¹è±¡ã€‚</p><p>è°ƒç”¨<code>customElements.define()</code>æ–¹æ³•å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ ã€‚ä¸‹é¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰å…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ ç»§æ‰¿<code>HTMLElement</code>ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">class FooElement extends HTMLElement {}
customElements.define(&#x27;x-foo&#x27;, FooElement)

document.body.innerHTML = `
  &lt;x-foo&gt;I&#x27;m inside a nonsense element.&lt;/x-foo&gt;
`

console.log(document.querySelector(&#x27;x-foo&#x27;) instanceof FooElement) // true</code>
        </deckgo-highlight-code><blockquote><p>æ³¨æ„è‡ªå®šä¹‰å…ƒç´ åå¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªä¸åœ¨åç§°å¼€å¤´å’Œæœ«å°¾çš„è¿å­—ç¬¦ï¼Œè€Œä¸”å…ƒç´ æ ‡ç­¾ä¸èƒ½è‡ªå…³é—­ã€‚</p></blockquote><p>è‡ªå®šä¹‰å…ƒç´ çš„å¨åŠ›æºè‡ªç±»å®šä¹‰ã€‚ä¾‹å¦‚å¯ä»¥é€šè¿‡è°ƒç”¨è‡ªå®šä¹‰å…ƒç´ çš„æ„é€ å‡½æ•°æ¥æ§åˆ¶è¿™ä¸ªç±»åœ¨ DOM ä¸­æ¯ä¸ªå®ä¾‹çš„è¡Œä¸ºï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">class FooElement extends HTMLElement {
  constructor() {
    super()
    console.log(&#x27;x-foo&#x27;)
  }
}
customElements.define(&#x27;x-foo&#x27;, FooElement)

document.body.innerHTML = `
  &lt;x-foo&gt;&lt;/x-foo&gt;
  &lt;x-foo&gt;&lt;/x-foo&gt;
`

// x-foo
// x-foo</code>
        </deckgo-highlight-code><blockquote><p>æ³¨æ„åœ¨è‡ªå®šä¹‰å…ƒç´ çš„æ„é€ å‡½æ•°ä¸­å¿…é¡»å§‹ç»ˆè°ƒç”¨<code>super()</code>ã€‚å¦‚æœå…ƒç´ ç»§æ‰¿äº†<code>HTMLElement</code>æˆ–ç›¸ä¼¼ç±»å‹è€Œä¸ä¼šè¦†ç›–æ„é€ å‡½æ•°ï¼Œåˆ™æ²¡æœ‰å¿…è¦è°ƒç”¨<code>super()</code>ï¼Œå› ä¸ºåŸå‹æ„é€ å‡½æ•°é»˜è®¤ä¼šåšè¿™ä»¶äº‹ã€‚å¾ˆå°‘æœ‰åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ è€Œä¸ç»§æ‰¿<code>HTMLElement</code>çš„ã€‚</p></blockquote><p>å¦‚æœè‡ªå®šä¹‰å…ƒç´ ç»§æ‰¿äº†ä¸€ä¸ªå…ƒç´ ç±»ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>is</code>å±æ€§å’Œ<code>extends</code>é€‰é¡¹å°†æ ‡ç­¾æŒ‡å®šä¸ºè¯¥è‡ªå®šä¹‰å…ƒç´ çš„å®ä¾‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">class FooElement extends HTMLDivElement {
  constructor() {
    super()
    console.log(&#x27;x-foo&#x27;)
  }
}
customElements.define(&#x27;x-foo&#x27;, FooElement, { extends: &#x27;div&#x27; })

document.body.innerHTML = `
  &lt;div is=&quot;x-foo&quot;&gt;&lt;/div&gt;
  &lt;div is=&quot;x-foo&quot;&gt;&lt;/div&gt;
`

// x-foo
// x-foo</code>
        </deckgo-highlight-code><h3>æ·»åŠ  Web ç»„ä»¶å†…å®¹</h3><p>å› ä¸ºæ¯æ¬¡å°†è‡ªå®šä¹‰å…ƒç´ æ·»åŠ åˆ° DOM ä¸­éƒ½ä¼šè°ƒç”¨å…¶ç±»æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è‡ªåŠ¨ç»™è‡ªå®šä¹‰å…ƒç´ æ·»åŠ å­ DOM å†…å®¹ã€‚è™½ç„¶ä¸èƒ½åœ¨æ„é€ å‡½æ•°æ·»åŠ å­ DOMï¼ˆä¼šæŠ›å‡º<code>DOMException</code>ï¼‰ï¼Œä½†å¯ä»¥ä¸ºè‡ªå®šä¹‰å…ƒç´ æ·»åŠ å½±å­ DOM å¹¶å°†å†…å®¹æ·»åŠ åˆ°è¿™ä¸ªå½±å­ DOM ä¸­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">class FooElement extends HTMLElement {
  constructor() {
    super()

    this.attachShadow({ mode: &#x27;open&#x27; })

    this.shadowRoot.innerHTML = `
      &lt;p&gt;I&#x27;m inside a custom element!&lt;/p&gt;
    `
  }
}

customElements.define(&#x27;x-foo&#x27;, FooElement)

document.body.innerHTML += `&lt;x-foo&gt;&lt;/x-foo&gt;`

// &lt;body&gt;
// &lt;x-foo&gt;
//   #shadow-root (open)
//     &lt;p&gt;I&#x27;m inside a custom elemnt!&lt;/p&gt;
// &lt;/x-foo&gt;
// &lt;/body&gt;</code>
        </deckgo-highlight-code><p>ä¸ºé¿å…å­—ç¬¦ä¸²æ¨¡ç‰ˆå’Œ<code>innerHTML</code>ä¸å¹²å‡€ï¼Œå¯ä»¥ä½¿ç”¨ HTML æ¨¡æ¿å’Œ<code>document.createElement()</code>é‡æ„è¿™ä¸ªä¾‹å­ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">// åˆå§‹çš„HTML
// &lt;template id=&quot;x-foo-tpl&quot;&gt;
//   &lt;p&gt;I&#x27;m inside a custom element template!&lt;/p&gt;
// &lt;/template&gt;

const template = document.querySelector(&#x27;#x-foo-tpl&#x27;)

class FooElement extends HTMLElement {
  constructor() {
    super()
    this.attachShadow({ mode: &#x27;open&#x27; })
    this.shadowRoot.appendChild(template.content.cloneNode(true))
  }
}

customElements.define(&#x27;x-foo&#x27;, FooElement)
document.body.innerHTML += `&lt;x-foo&gt;&lt;/x-foo&gt;`</code>
        </deckgo-highlight-code><p>è¿™æ ·å¯ä»¥åœ¨è‡ªå®šä¹‰å…ƒç´ ä¸­å®ç°é«˜åº¦çš„ HTML å’Œä»£ç é‡ç”¨ï¼Œä»¥åŠ DOM å°è£…ã€‚ä½¿ç”¨è¿™ç§æ¨¡å¼èƒ½å¤Ÿè‡ªç”±åˆ›å»ºå¯é‡ç”¨çš„ç»„ä»¶è€Œä¸å¿…æ‹…å¿ƒå¤–éƒ¨ CSS æ±¡æŸ“ç»„ä»¶çš„æ ·å¼ã€‚</p><h3>ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h3><p>å¯ä»¥åœ¨è‡ªå®šä¹‰å…ƒç´ çš„ä¸åŒç”Ÿå‘½å‘¨æœŸæ‰§è¡Œä»£ç ã€‚å¸¦æœ‰ç›¸åº”åç§°çš„è‡ªå®šä¹‰å…ƒç´ çš„å®ä¾‹æ–¹æ³•ä¼šåœ¨ä¸åŒç”Ÿå‘½å‘¨æœŸé˜¶æ®µè¢«è°ƒç”¨ã€‚è‡ªå®šä¹‰å…ƒç´ æœ‰ä»¥ä¸‹ 5 ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p><ul><li><code>constructor()</code>ï¼šåœ¨åˆ›å»ºå…ƒç´ å®ä¾‹æˆ–å°†å·²æœ‰ DOM å…ƒç´ å‡çº§ä¸ºè‡ªå®šä¹‰å…ƒç´ æ—¶è°ƒç”¨ã€‚</li><li><code>connectedCallback()</code>ï¼šåœ¨æ¯æ¬¡å°†è¿™ä¸ªè‡ªå®šä¹‰å…ƒç´ å®ä¾‹æ·»åŠ åˆ° DOM ä¸­æ—¶è°ƒç”¨ã€‚</li><li><code>disconnectedCallback()</code>ï¼šåœ¨æ¯æ¬¡å°†è¿™ä¸ªè‡ªå®šä¹‰å…ƒç´ å®ä¾‹ä» DOM ä¸­ç§»é™¤æ—¶è°ƒç”¨ã€‚</li><li><code>attributeChangedCallback()</code>ï¼šåœ¨æ¯æ¬¡<strong>å¯è§‚å¯Ÿå±æ€§</strong>çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨ã€‚åœ¨å…ƒç´ å®ä¾‹åˆå§‹åŒ–æ—¶ï¼Œåˆå§‹å€¼çš„å®šä¹‰ä¹Ÿç®—ä¸€æ¬¡å˜åŒ–ã€‚</li><li><code>adoptedCallback()</code>ï¼šåœ¨é€šè¿‡<code>document.adoptNode()</code>å°†è¿™ä¸ªè‡ªå®šä¹‰å…ƒç´ å®ä¾‹ç§»åŠ¨åˆ°æ–°æ–‡æ¡£å¯¹è±¡æ—¶è°ƒç”¨ã€‚</li></ul><p>ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†è¿™äº›æ„å»ºã€è¿æ¥å’Œæ–­å¼€è¿æ¥çš„å›è°ƒï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">class FooElement extends HTMLElement {
  constructor() {
    super()
    console.log(&#x27;ctor&#x27;)
  }

  connectedCallback() {
    console.log(&#x27;connected&#x27;)
  }

  disconnectedCallback() {
    console.log(&#x27;disconnected&#x27;)
  }
}

customElements.define(&#x27;x-foo&#x27;, FooElement)

const fooElement = document.createElement(&#x27;x-foo&#x27;)
// ctor

document.body.appendChild(fooElement)
// connected

document.body.removeChild(fooElement)
// disconnected</code>
        </deckgo-highlight-code><h3>åå°„è‡ªå®šä¹‰å…ƒç´ å±æ€§</h3><p>è‡ªå®šä¹‰å…ƒç´ æ—¢æ˜¯ DOM å®ä½“åˆæ˜¯ JavaScript å¯¹è±¡ï¼Œå› æ­¤ä¸¤è€…ä¹‹é—´åº”è¯¥åŒæ­¥å˜åŒ–ã€‚æ¢å¥è¯è¯´å¯¹ DOM çš„ä¿®æ”¹åº”è¯¥åæ˜ åˆ° JavaScript å¯¹è±¡ï¼Œåä¹‹äº¦ç„¶ã€‚è¦ä» JavaScript å¯¹è±¡åå°„åˆ° DOMï¼Œå¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨è·å–å‡½æ•°å’Œè®¾ç½®å‡½æ•°ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†åœ¨ JavaScript å¯¹è±¡å’Œ DOM ä¹‹é—´åå°„<code>bar</code>å±æ€§çš„è¿‡ç¨‹ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">document.body.innerHTML = `&lt;x-foo&gt;&lt;/x-foo&gt;`

class FooElement extends HTMLElement {
  constructor() {
    super()
    this.bar = true
  }

  get bar() {
    return this.getAttribute(&#x27;bar&#x27;)
  }

  set bar(value) {
    this.setAttribute(&#x27;bar&#x27;, value)
  }
}
customFields.define(&#x27;x-foo&#x27;, FooElement)

console.log(document.body.innerHTML)
// &lt;x-foo bar=&quot;true&quot;&gt;&lt;/x-foo&gt;</code>
        </deckgo-highlight-code><p>å¦ä¸€ä¸ªæ–¹å‘çš„åå°„ï¼ˆä» DOM åˆ° JavaScript å¯¹è±¡ï¼‰éœ€è¦ç»™ç›¸åº”çš„å±æ€§æ·»åŠ ç›‘å¬å™¨ã€‚ä¸ºæ­¤å¯ä»¥ä½¿ç”¨<code>observedAttributes()</code>è·å–å‡½æ•°è®©è‡ªå®šä¹‰å…ƒç´ çš„å±æ€§å€¼æ¯æ¬¡æ”¹å˜æ—¶éƒ½è°ƒç”¨<code>attributeChangedCallback()</code>ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">class FooElement extends HTMLElement {
  static get observedAttributes() {
    return [&#x27;bar&#x27;]
  }

  get bar() {
    return this.getAttribute(&#x27;bar&#x27;)
  }

  set bar(value) {
    this.setAttribute(&#x27;bar&#x27;, value)
  }

  attributeChangedCallback(name, oldValue, newValue) {
    if (oldValue !== newValue) {
      console.log(`${oldValue} -&gt; ${newValue}`)
      this[name] = newValue
    }
  }
}

customElements.define(&#x27;x-foo&#x27;, FooElement)

document.body.innerHTML = `&lt;x-foo bar=&quot;false&quot;&gt;&lt;/x-foo&gt;`
// null -&gt; false

document.querySelector(&#x27;x-foo&#x27;)
// false -&gt; true</code>
        </deckgo-highlight-code><h3>å‡çº§è‡ªå®šä¹‰å…ƒç´ </h3><p>å¹¶éå§‹ç»ˆå¯ä»¥å…ˆå®šä¹‰è‡ªå®šä¹‰å…ƒç´ ï¼Œç„¶åå†åœ¨ DOM ä¸­ä½¿ç”¨ç›¸åº”çš„å…ƒç´ æ ‡ç­¾ã€‚ä¸ºè§£å†³è¿™ä¸ªå…ˆåæ¬¡åºé—®é¢˜ï¼ŒWeb ç»„ä»¶åœ¨<code>CustomElementRegistry</code>ä¸Šé¢å¤–æš´éœ²äº†ä¸€äº›æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥ç”¨æ¥æ£€æµ‹è‡ªå®šä¹‰å…ƒç´ æ˜¯å¦å®šä¹‰å®Œæˆï¼Œç„¶åå¯ä»¥ç”¨å®ƒæ¥å‡çº§å·²æœ‰å…ƒç´ ã€‚</p><p>å¦‚æœè‡ªå®šä¹‰å…ƒç´ å·²ç»æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆ<code>CustomElementRegistry.get()</code>æ–¹æ³•ä¼šè¿”å›ç›¸åº”è‡ªå®šä¹‰å…ƒç´ çš„ç±»ã€‚ç±»ä¼¼åœ°ï¼Œ<code>CustomElementRegistry.whenDefined()</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæœŸçº¦ï¼Œå½“ç›¸åº”è‡ªå®šä¹‰å…ƒç´ æœ‰å®šä¹‰ä¹‹åè§£å†³ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">customElements.whenDefined(&#x27;x-foo&#x27;).then(() =&gt; console.log(&#x27;defined!&#x27;))

console.log(customElements.get(&#x27;x-foo&#x27;))
// undefined

customElements.define(&#x27;x-foo&#x27;, class {})
// defined!

console.log(customElements.get(&#x27;x-foo&#x27;))
// class FooElement {}</code>
        </deckgo-highlight-code><p>è¿æ¥åˆ° DOM çš„å…ƒç´ åœ¨è‡ªå®šä¹‰å…ƒç´ æœ‰å®šä¹‰æ—¶ä¼š<strong>è‡ªåŠ¨å‡çº§</strong>ã€‚å¦‚æœæƒ³è¦åœ¨å…ƒç´ è¿æ¥åˆ° DOM ä¹‹å‰å¼ºåˆ¶å‡çº§ï¼Œå¯ä»¥ä½¿ç”¨<code>CustomElementRegistry.upgrade()</code>æ–¹æ³•ï¼š</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const fooElement = document.createElement(&#x27;x-foo&#x27;)

class FooElement extends HTMLElement {}
customElements.define(&#x27;x-foo&#x27;, FooElement)

console.log(fooElement instanceof FooElement) // false

customElements.upgrate(fooElement) // å¼ºåˆ¶å‡çº§

console.log(fooElement instanceof FooElement) // true</code>
        </deckgo-highlight-code><h1>å°ç»“</h1><p>é™¤äº†å®šä¹‰æ–°æ ‡ç­¾ï¼ŒHTML5 è¿˜å®šä¹‰äº†ä¸€äº› JavaScript APIã€‚è¿™äº› API å¯ä»¥ä¸ºå¼€å‘è€…æä¾›æ›´ä¾¿æ·çš„ Web æ¥å£ï¼Œæš´éœ²å ªæ¯”æ¡Œé¢åº”ç”¨çš„èƒ½åŠ›ã€‚</p><ul><li>Atomics API ç”¨äºä¿æŠ¤ä»£ç åœ¨å¤šçº¿ç¨‹å†…å­˜è®¿é—®æ¨¡å¼ä¸‹ä¸å‘ç”Ÿèµ„æºäº‰ç”¨ã€‚</li><li><code>postMessage()</code>API æ”¯æŒä»ä¸åŒæºè·¨æ–‡æ¡£å‘é€æ¶ˆæ¯ï¼ŒåŒæ—¶ä¿è¯å®‰å…¨å’Œéµå¾ªåŒæºç­–ç•¥ã€‚</li><li>Encoding API ç”¨äºå®ç°å­—ç¬¦ä¸²ä¸ç¼“å†²åŒºä¹‹é—´çš„æ— ç¼è½¬æ¢ã€‚</li><li>File API æä¾›äº†å‘é€ã€æ¥æ”¶å’Œè¯»å–å¤§å‹äºŒè¿›åˆ¶å¯¹è±¡çš„å¯é å·¥å…·ã€‚</li><li>åª’ä½“å…ƒç´ <code>&lt;audio&gt;</code>å’Œ<code>&lt;video&gt;</code>æ‹¥æœ‰è‡ªå·±çš„ APIï¼Œç”¨äºæ“ä½œéŸ³é¢‘å’Œè§†é¢‘ã€‚å¹¶ä¸æ˜¯æ¯ä¸ªæµè§ˆå™¨éƒ½ä¼šæ”¯æŒæ‰€æœ‰åª’ä½“æ ¼å¼ï¼Œä½¿ç”¨<code>canPlayType()</code>æ–¹æ³•å¯ä»¥æ£€æµ‹æµè§ˆå™¨æ”¯æŒæƒ…å†µã€‚</li><li>æ‹–æ”¾ API æ”¯æŒæ–¹ä¾¿åœ°å°†å…ƒç´ æ ‡è¯†ä¸ºå¯æ‹–åŠ¨ï¼Œå¹¶åœ¨æ“ä½œç³»ç»Ÿå®Œæˆæ”¾ç½®æ—¶ç»™å‡ºå›åº”ã€‚å¯ä»¥åˆ©ç”¨å®ƒåˆ›å»ºè‡ªå®šä¹‰å¯æ‹–åŠ¨å…ƒç´ å’Œæ”¾ç½®ç›®æ ‡</li><li>Notifications API æä¾›äº†ä¸€ç§æµè§ˆå™¨ä¸­ç«‹çš„æ–¹å¼ï¼Œä»¥æ­¤å‘ç”¨æˆ·å±•ç¤ºæ¶ˆæ¯é€šçŸ¥å¼¹å±‚ã€‚</li><li>Streams API æ”¯æŒä»¥å…¨æ–°æ–¹å¼è¯»å–ã€å†™å…¥å’Œå¤„ç†æ•°æ®ã€‚</li><li>Timing API æ”¯æŒä»¥å…¨æ–°æ–¹å¼è¯»å–ã€å†™å…¥å’Œå¤„ç†æ•°æ®ã€‚</li><li>Web Components API ä¸ºå…ƒç´ é‡ç”¨å’Œå°è£…æŠ€æœ¯å‘å‰è¿ˆè¿›æä¾›äº†æœ‰åŠ›æ”¯æ’‘ã€‚</li></ul></div><div class="navigator-switch" style="display:none"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="list" class="svg-inline--fa fa-list " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"></path></svg></div><div class="article-navigator" style="display:block"><div class="article-navigator-toggler"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="xmark" class="svg-inline--fa fa-xmark " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path></svg></div><h4>æ•°æ®ç»“æ„å’Œç®—æ³•</h4><p title="ç®—æ³•ä¸æ•°æ®ç»“æ„â€”â€”æ•°ç»„" class="">ç®—æ³•ä¸æ•°æ®ç»“æ„â€”â€”æ•°ç»„</p><h4>electron</h4><p title="electronä¸­çš„è¿›ç¨‹æ¨¡å‹" class="">electronä¸­çš„è¿›ç¨‹æ¨¡å‹</p><h4>å‰ç«¯æ‚è°ˆ</h4><p title="è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰" class="">è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰</p><p title="å…³äºno-corsçš„è¯¯åŒº" class="">å…³äºno-corsçš„è¯¯åŒº</p><p title="æ¸²æŸ“é¡µé¢ï¼šæµè§ˆå™¨çš„å·¥ä½œåŸç†" class="">æ¸²æŸ“é¡µé¢ï¼šæµè§ˆå™¨çš„å·¥ä½œåŸç†</p><p title="React diffingç®—æ³•" class="">React diffingç®—æ³•</p><p title="Vercelç®€ä»‹ é™æ€åšå®¢éƒ¨ç½²" class="">Vercelç®€ä»‹ é™æ€åšå®¢éƒ¨ç½²</p><h4>æŠ„ä¹¦ç³»åˆ—â€”â€”â€œçº¢å®ä¹¦â€</h4><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆä¸€ï¼‰ä»€ä¹ˆæ˜¯JavaScriptï¼Ÿ" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆä¸€ï¼‰ä»€ä¹ˆæ˜¯JavaScriptï¼Ÿ</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒï¼‰HTMLä¸­çš„JavaScript" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒï¼‰HTMLä¸­çš„JavaScript</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆä¸‰ï¼‰JavaScriptè¯­è¨€åŸºç¡€" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆä¸‰ï¼‰JavaScriptè¯­è¨€åŸºç¡€</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆå››ï¼‰å˜é‡ã€ä½œç”¨åŸŸä¸å†…å­˜" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆå››ï¼‰å˜é‡ã€ä½œç”¨åŸŸä¸å†…å­˜</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆå…­ï¼‰é›†åˆå¼•ç”¨ç±»å‹" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆå…­ï¼‰é›†åˆå¼•ç”¨ç±»å‹</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆä¸ƒï¼‰è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆä¸ƒï¼‰è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆåä¸€ï¼‰æœŸçº¦ä¸å¼‚æ­¥å‡½æ•°" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆåä¸€ï¼‰æœŸçº¦ä¸å¼‚æ­¥å‡½æ•°</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆåå››ï¼‰DOM" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆåå››ï¼‰DOM</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆåäº”ï¼‰DOMæ‰©å±•" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆåäº”ï¼‰DOMæ‰©å±•</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆåä¸ƒï¼‰äº‹ä»¶" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆåä¸ƒï¼‰äº‹ä»¶</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåï¼‰JavaScript API" class="highlighted-navigator-item">çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåï¼‰JavaScript API</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåä¸‰ï¼‰JSON" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåä¸‰ï¼‰JSON</p><p title="çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåå››ï¼‰ç½‘ç»œè¯·æ±‚ä¸è¿œç¨‹èµ„æº" class="">çº¢å®ä¹¦ç³»åˆ—ï¼ˆäºŒåå››ï¼‰ç½‘ç»œè¯·æ±‚ä¸è¿œç¨‹èµ„æº</p></div>0</main><footer class="footer"><div class="wrapper"><p style="font-size:1.3rem"><span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weixin" class="svg-inline--fa fa-weixin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M385.2 167.6c6.4 0 12.6 .3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2 .1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3 .1 10-9.9 19.6-24.4 19.6z"></path></svg></span><span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="qq" class="svg-inline--fa fa-qq " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433.8 420.4c-11.53 1.393-44.86-52.74-44.86-52.74 0 31.34-16.14 72.25-51.05 101.8 16.84 5.192 54.84 19.17 45.8 34.42-7.316 12.34-125.5 7.881-159.6 4.037-34.12 3.844-152.3 8.306-159.6-4.037-9.045-15.25 28.92-29.21 45.78-34.42-34.92-29.54-51.06-70.44-51.06-101.8 0 0-33.33 54.13-44.86 52.74-5.37-.65-12.42-29.64 9.347-99.7 10.26-33.02 21.1-60.48 40.14-105.8C60.68 98.06 108.1 .006 224 0c113.7 .006 163.2 96.13 160.3 214.1 18.12 45.22 29.91 72.85 40.14 105.8 21.77 70.06 14.72 99.05 9.346 99.7z"></path></svg></span><span><a href="mailto:k1664032884@gmail.com"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 352c-16.53 0-33.06-5.422-47.16-16.41L0 173.2V400C0 426.5 21.49 448 48 448h416c26.51 0 48-21.49 48-48V173.2l-208.8 162.5C289.1 346.6 272.5 352 256 352zM16.29 145.3l212.2 165.1c16.19 12.6 38.87 12.6 55.06 0l212.2-165.1C505.1 137.3 512 125 512 112C512 85.49 490.5 64 464 64h-416C21.49 64 0 85.49 0 112C0 125 6.01 137.3 16.29 145.3z"></path></svg></a></span><span><a href="https://github.com/kqhasaki" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></span><span><a href="/static/resume-ef27ab676ea536646634203d2696b372.pdf" download="resume.pdf" title="ç®€å†ä¸‹è½½"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file" class="svg-inline--fa fa-file " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M256 0v128h128L256 0zM224 128L224 0H48C21.49 0 0 21.49 0 48v416C0 490.5 21.49 512 48 512h288c26.51 0 48-21.49 48-48V160h-127.1C238.3 160 224 145.7 224 128z"></path></svg></a></span><span><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"></path></svg></span></p><p>CopyRight Â© 2022 Louis K</p></div><div class="wrapper" style="align-items:flex-end"><h3>Links</h3><ul><li><span><a href="https://reactjs.org/" rel="noreferrer" target="_blank">React</a></span></li><li><span><a href="https://developer.mozilla.org/zh-CN/" rel="noreferrer" target="_blank">MDN</a></span></li><li><span><a href="https://leafletjs.com/reference.html" rel="noreferrer" target="_blank">Leaflet</a></span></li><li><span><a href="https://ant.design/index-cn" rel="noreferrer" target="_blank">Ant Design</a></span></li><li><span><a href="https://webpack.docschina.org/concepts/" rel="noreferrer" target="_blank">webpack</a></span></li></ul></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/redbook-series/redbook-chapter20/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-a6a9e8476add1045c345.js"],"app":["/app-482b53f1cff3eb5f0e6d.js"],"component---src-pages-404-js":["/component---src-pages-404-js-1520702fb447a6f3b302.js"],"component---src-pages-articles-mdx-slug-js":["/component---src-pages-articles-mdx-slug-js-af982b891e4b6138fb23.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b604faad530376710a31.js"],"component---src-pages-non-tech-js":["/component---src-pages-non-tech-js-2727f4120df747b01a70.js"]};/*]]>*/</script><script src="/polyfill-a6a9e8476add1045c345.js" nomodule=""></script><script src="/component---src-pages-articles-mdx-slug-js-af982b891e4b6138fb23.js" async=""></script><script src="/commons-711a425d0badd3d91470.js" async=""></script><script src="/a9a7754c-992c6b2080a7db331a45.js" async=""></script><script src="/cb1608f2-001f1ae553ac1c271243.js" async=""></script><script src="/app-482b53f1cff3eb5f0e6d.js" async=""></script><script src="/framework-f27b074ecebec0f1dbc4.js" async=""></script><script src="/webpack-runtime-7b8a381ab1cc3c6a4c63.js" async=""></script></body></html>